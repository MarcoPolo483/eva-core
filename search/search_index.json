{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"EVA Core","text":"<p>Domain models and business logic for EVA Suite.</p>"},{"location":"#overview","title":"Overview","text":"<p>EVA Core provides production-ready domain entities with strict validation, domain events, and repository patterns for building enterprise RAG applications.</p>"},{"location":"#features","title":"Features","text":"<ul> <li>7 Core Entities: User, Tenant, Space, Document, Query, Conversation with full Pydantic validation</li> <li>3 Value Objects: Email, PhoneNumber, SIN with PII masking</li> <li>6 Domain Events: Space and Query lifecycle events</li> <li>Repository Pattern: Abstract interfaces with in-memory test implementations</li> <li>Type Safety: 100% mypy strict compliance</li> <li>Test Coverage: 100% coverage with 157+ tests</li> <li>Multi-Tenancy: Built-in tenant isolation and access control</li> </ul>"},{"location":"#quick-links","title":"Quick Links","text":"<ul> <li>Installation Guide</li> <li>Quick Start Tutorial</li> <li>API Reference</li> <li>GitHub Repository</li> </ul>"},{"location":"#architecture","title":"Architecture","text":"<p>EVA Core follows Domain-Driven Design principles:</p> <pre><code>eva_core/\n\u251c\u2500\u2500 domain/\n\u2502   \u251c\u2500\u2500 entities/          # Core business entities\n\u2502   \u251c\u2500\u2500 value_objects/     # Immutable value types\n\u2502   \u251c\u2500\u2500 events/            # Domain event system\n\u2502   \u2514\u2500\u2500 repositories/      # Data access interfaces\n</code></pre>"},{"location":"#license","title":"License","text":"<p>MIT License - see LICENSE for details.</p>"},{"location":"SPECIFICATION/","title":"EVA Core Domain Models &amp; Business Logic (eva-core)","text":"<p>Comprehensive Specification for Autonomous Implementation</p>"},{"location":"SPECIFICATION/#1-vision-business-value","title":"1. Vision &amp; Business Value","text":""},{"location":"SPECIFICATION/#what-this-service-delivers","title":"What This Service Delivers","text":"<p>EVA-Core is the domain model foundation for the entire EVA Suite. It provides:</p> <ul> <li>Domain Entities: User, Tenant, Space, Document, Query, Conversation (Pydantic models with validation)</li> <li>Business Logic: Rules for tenant isolation, space permissions, document ownership, query validation</li> <li>Domain Events: SpaceCreated, DocumentAdded, QueryExecuted, ConversationUpdated (event-driven architecture)</li> <li>Repository Patterns: Abstract interfaces for data access (Cosmos DB, Blob Storage, Redis)</li> <li>Value Objects: Email, PhoneNumber, SIN (with PII masking), ContentHash, Citation</li> <li>Aggregate Roots: Space (contains Documents + Conversations), User (contains Preferences + Sessions)</li> </ul>"},{"location":"SPECIFICATION/#success-metrics","title":"Success Metrics","text":"<ul> <li>Reusability: 100% of EVA Suite services use eva-core models (no duplicate entity definitions)</li> <li>Validation: Zero invalid data in Cosmos DB (Pydantic validation at boundaries)</li> <li>Performance: Model serialization &lt; 10ms (p95), validation &lt; 5ms (p95)</li> <li>Type Safety: 100% type coverage (mypy strict mode passing)</li> </ul>"},{"location":"SPECIFICATION/#business-impact","title":"Business Impact","text":"<ul> <li>Consistency: Single source of truth for domain models (no schema drift across services)</li> <li>Maintainability: Change entity once, all services get update (DRY principle)</li> <li>Testing: Mock repositories enable fast unit tests (no database dependencies)</li> <li>Compliance: PII masking built into models (SIN/email/phone automatically masked in logs)</li> </ul>"},{"location":"SPECIFICATION/#2-architecture-overview","title":"2. Architecture Overview","text":""},{"location":"SPECIFICATION/#system-context","title":"System Context","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         EVA Suite Services                          \u2502\n\u2502                                                                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502  \u2502 eva-api  \u2502  \u2502 eva-auth \u2502  \u2502 eva-rag  \u2502  \u2502 eva-ui   \u2502  ...       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502       \u2502             \u2502             \u2502             \u2502                   \u2502\n\u2502       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                   \u2502\n\u2502                           \u2502                                         \u2502\n\u2502                           \u25bc                                         \u2502\n\u2502       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                \u2502\n\u2502       \u2502      eva-core (This Package)              \u2502                \u2502\n\u2502       \u2502  Domain Models \u2502 Business Logic \u2502 Events  \u2502                \u2502\n\u2502       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                \u2502\n\u2502                   \u2502                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                    \u2502\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u25bc                       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Cosmos DB     \u2502     \u2502  Azure Blob Storage\u2502\n\u2502  (Entities)    \u2502     \u2502  (Documents)       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"SPECIFICATION/#domain-model-architecture","title":"Domain Model Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                          eva-core Package                           \u2502\n\u2502                                                                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502                     Domain Entities                           \u2502  \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502  \u2502\n\u2502  \u2502  \u2502   User   \u2502  \u2502  Tenant  \u2502  \u2502  Space   \u2502  \u2502 Document \u2502     \u2502  \u2502\n\u2502  \u2502  \u2502 (Aggr.)  \u2502  \u2502 (Aggr.)  \u2502  \u2502 (Aggr.)  \u2502  \u2502 (Entity) \u2502     \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502  \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                   \u2502  \u2502\n\u2502  \u2502  \u2502  Query   \u2502  \u2502 Convers. \u2502  \u2502 Citation \u2502                   \u2502  \u2502\n\u2502  \u2502  \u2502 (Entity) \u2502  \u2502 (Entity) \u2502  \u2502 (Value)  \u2502                   \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                   \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                           \u2502                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502                   Business Logic                              \u2502  \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502  \u2502\n\u2502  \u2502  \u2502 Validation   \u2502  \u2502 Authorization\u2502  \u2502 PII Masking  \u2502       \u2502  \u2502\n\u2502  \u2502  \u2502 Rules        \u2502  \u2502 Rules        \u2502  \u2502 Rules        \u2502       \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                           \u2502                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502                   Domain Events                               \u2502  \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502  \u2502\n\u2502  \u2502  \u2502SpaceCreated  \u2502  \u2502DocumentAdded \u2502  \u2502QueryExecuted \u2502       \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                           \u2502                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502                Repository Interfaces                          \u2502  \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502  \u2502\n\u2502  \u2502  \u2502UserRepository\u2502  \u2502SpaceRepos.   \u2502  \u2502DocumentRepos.\u2502       \u2502  \u2502\n\u2502  \u2502  \u2502 (Abstract)   \u2502  \u2502 (Abstract)   \u2502  \u2502 (Abstract)   \u2502       \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"SPECIFICATION/#3-technical-stack","title":"3. Technical Stack","text":""},{"location":"SPECIFICATION/#primary-technologies","title":"Primary Technologies","text":"<ul> <li>Language: Python 3.11+ (type hints, dataclasses, async/await)</li> <li>Validation: Pydantic 2.x (data validation, serialization, JSON schema generation)</li> <li>Testing: pytest + pytest-asyncio + hypothesis (property-based testing for validation rules)</li> <li>Type Checking: mypy (strict mode, 100% type coverage)</li> <li>Linting: ruff (fast Python linter/formatter)</li> <li>Documentation: MkDocs + mkdocstrings (auto-generated API docs from docstrings)</li> </ul>"},{"location":"SPECIFICATION/#domain-driven-design-patterns","title":"Domain-Driven Design Patterns","text":"<ul> <li>Entities: Objects with unique identity (User, Space, Document, Query, Conversation)</li> <li>Value Objects: Immutable objects without identity (Email, PhoneNumber, ContentHash, Citation)</li> <li>Aggregate Roots: Consistency boundaries (Space contains Documents, User contains Preferences)</li> <li>Repositories: Abstract data access interfaces (UserRepository, SpaceRepository, DocumentRepository)</li> <li>Domain Events: State change notifications (SpaceCreated, DocumentAdded, QueryExecuted)</li> <li>Domain Services: Stateless operations spanning multiple entities (TenantIsolationService, PermissionService)</li> </ul>"},{"location":"SPECIFICATION/#validation-strategy","title":"Validation Strategy","text":"<ul> <li>Pydantic Validators: Field-level validation (email format, SIN format, phone number format)</li> <li>Model Validators: Cross-field validation (start_date &lt; end_date, document size limits)</li> <li>Invariants: Business rules enforced in aggregate roots (Space must have at least 1 owner)</li> <li>Hypothesis: Property-based testing for validation rules (generate random invalid data, ensure rejection)</li> </ul>"},{"location":"SPECIFICATION/#4-domain-entities","title":"4. Domain Entities","text":""},{"location":"SPECIFICATION/#41-user-aggregate-root","title":"4.1 User (Aggregate Root)","text":"<p>Purpose: Represents a person using EVA (citizen or employee).</p> <p>Schema: <pre><code># src/eva_core/domain/entities/user.py\nfrom datetime import datetime\nfrom enum import Enum\nfrom pydantic import BaseModel, Field, field_validator, EmailStr\nfrom typing import Optional\nimport uuid\n\nclass UserRole(str, Enum):\n    \"\"\"User roles with increasing permissions.\"\"\"\n    VIEWER = \"viewer\"       # Read-only access\n    ANALYST = \"analyst\"     # Can create queries, add documents\n    ADMIN = \"admin\"         # Full control (user management, space management)\n    SYSTEM = \"system\"       # Internal system operations\n\nclass UserStatus(str, Enum):\n    \"\"\"User account status.\"\"\"\n    ACTIVE = \"active\"       # Can use system\n    SUSPENDED = \"suspended\" # Temporarily blocked\n    DELETED = \"deleted\"     # Soft-deleted (retain audit trail)\n\nclass UserPreferences(BaseModel):\n    \"\"\"User preferences (UI settings, notifications).\"\"\"\n    locale: str = \"en-CA\"                    # Language (en-CA, fr-CA)\n    timezone: str = \"America/Toronto\"        # Timezone\n    email_notifications: bool = True         # Email notifications enabled\n    theme: str = \"auto\"                      # UI theme (light, dark, auto)\n    results_per_page: int = 20               # Pagination default\n\nclass User(BaseModel):\n    \"\"\"User entity (aggregate root).\"\"\"\n\n    # Identity\n    id: str = Field(default_factory=lambda: str(uuid.uuid4()))\n    tenant_id: str  # Organization/department ID (tenant isolation)\n\n    # Profile\n    email: EmailStr\n    name: str = Field(min_length=1, max_length=200)\n    role: UserRole = UserRole.VIEWER\n    status: UserStatus = UserStatus.ACTIVE\n\n    # Authentication (references eva-auth)\n    auth_provider: str = \"entra_id\"  # entra_id, b2c\n    auth_sub: str  # Subject claim from JWT (unique per provider)\n\n    # Preferences\n    preferences: UserPreferences = Field(default_factory=UserPreferences)\n\n    # Metadata\n    created_at: datetime = Field(default_factory=datetime.utcnow)\n    updated_at: datetime = Field(default_factory=datetime.utcnow)\n    last_login_at: Optional[datetime] = None\n\n    # Audit\n    created_by: str  # User ID who created this user (for admin actions)\n\n    @field_validator(\"email\")\n    @classmethod\n    def validate_email_domain(cls, v: str) -&gt; str:\n        \"\"\"Validate email belongs to allowed domain (e.g., canada.ca).\"\"\"\n        # Business rule: employees must use @canada.ca emails\n        # Citizens can use any email (validated by Azure AD B2C)\n        return v\n\n    def can_access_space(self, space_owner_id: str, space_tenant_id: str) -&gt; bool:\n        \"\"\"Check if user can access space (business logic).\"\"\"\n        # Tenant isolation: user must be in same tenant\n        if self.tenant_id != space_tenant_id:\n            return False\n\n        # Admins can access all spaces in their tenant\n        if self.role == UserRole.ADMIN:\n            return True\n\n        # Users can only access spaces they own (checked elsewhere)\n        return False\n\n    def mask_pii(self) -&gt; \"User\":\n        \"\"\"Return copy with PII masked (for logging/telemetry).\"\"\"\n        masked = self.model_copy(deep=True)\n        # Mask email: john.doe@example.com \u2192 j***e@e*****e.com\n        email_parts = masked.email.split(\"@\")\n        masked.email = f\"{email_parts[0][0]}***{email_parts[0][-1]}@{email_parts[1][0]}*****{email_parts[1][-1]}\"\n        # Mask name: John Doe \u2192 J*** D**\n        name_parts = masked.name.split()\n        masked.name = \" \".join([f\"{part[0]}***\" for part in name_parts])\n        return masked\n</code></pre></p> <p>Business Rules: - Email must be unique per tenant - Role changes logged as domain events (UserRoleChanged) - Suspended users cannot create queries or add documents - Deleted users retain ID for audit trail (soft delete)</p>"},{"location":"SPECIFICATION/#42-tenant-aggregate-root","title":"4.2 Tenant (Aggregate Root)","text":"<p>Purpose: Represents an organization or department (multi-tenancy boundary).</p> <p>Schema: <pre><code># src/eva_core/domain/entities/tenant.py\nfrom pydantic import BaseModel, Field\nfrom typing import Optional\nfrom datetime import datetime\nimport uuid\n\nclass TenantStatus(str, Enum):\n    ACTIVE = \"active\"\n    SUSPENDED = \"suspended\"\n    ARCHIVED = \"archived\"\n\nclass TenantQuotas(BaseModel):\n    \"\"\"Resource limits per tenant.\"\"\"\n    max_users: int = 100\n    max_spaces: int = 50\n    max_documents_per_space: int = 10000\n    max_storage_gb: int = 100\n    max_queries_per_month: int = 10000\n\nclass Tenant(BaseModel):\n    \"\"\"Tenant entity (aggregate root for multi-tenancy).\"\"\"\n\n    # Identity\n    id: str = Field(default_factory=lambda: str(uuid.uuid4()))\n\n    # Profile\n    name: str = Field(min_length=1, max_length=200)  # e.g., \"Department of Example\"\n    slug: str = Field(pattern=r\"^[a-z0-9-]+$\")  # URL-safe identifier: dept-of-example\n    status: TenantStatus = TenantStatus.ACTIVE\n\n    # Configuration\n    quotas: TenantQuotas = Field(default_factory=TenantQuotas)\n\n    # Metadata\n    created_at: datetime = Field(default_factory=datetime.utcnow)\n    updated_at: datetime = Field(default_factory=datetime.utcnow)\n\n    # Audit\n    created_by: str  # User ID (admin who created tenant)\n\n    def is_quota_exceeded(self, resource: str, current_count: int) -&gt; bool:\n        \"\"\"Check if resource quota is exceeded.\"\"\"\n        quotas_dict = self.quotas.model_dump()\n        max_allowed = quotas_dict.get(f\"max_{resource}\", float(\"inf\"))\n        return current_count &gt;= max_allowed\n</code></pre></p> <p>Business Rules: - Slug must be unique across all tenants - Users can only belong to one tenant - Cross-tenant data access is forbidden (enforced in repositories) - Suspended tenants: users can read but not write</p>"},{"location":"SPECIFICATION/#43-space-aggregate-root","title":"4.3 Space (Aggregate Root)","text":"<p>Purpose: Container for documents and conversations (like a project workspace).</p> <p>Schema: <pre><code># src/eva_core/domain/entities/space.py\nfrom pydantic import BaseModel, Field, field_validator\nfrom typing import List, Optional\nfrom datetime import datetime\nfrom enum import Enum\nimport uuid\n\nclass SpaceVisibility(str, Enum):\n    PRIVATE = \"private\"   # Only owners can access\n    SHARED = \"shared\"     # Owners + explicit members can access\n    PUBLIC = \"public\"     # All users in tenant can access\n\nclass SpaceStatus(str, Enum):\n    ACTIVE = \"active\"\n    ARCHIVED = \"archived\"\n\nclass SpaceMember(BaseModel):\n    \"\"\"Member of a space with specific role.\"\"\"\n    user_id: str\n    role: str = \"viewer\"  # viewer, contributor, owner\n    added_at: datetime = Field(default_factory=datetime.utcnow)\n    added_by: str  # User ID who added this member\n\nclass Space(BaseModel):\n    \"\"\"Space entity (aggregate root for documents + conversations).\"\"\"\n\n    # Identity\n    id: str = Field(default_factory=lambda: str(uuid.uuid4()))\n    tenant_id: str  # Tenant isolation\n\n    # Profile\n    name: str = Field(min_length=1, max_length=200)\n    description: Optional[str] = Field(None, max_length=2000)\n    visibility: SpaceVisibility = SpaceVisibility.PRIVATE\n    status: SpaceStatus = SpaceStatus.ACTIVE\n\n    # Access Control\n    owner_id: str  # Primary owner (user ID)\n    members: List[SpaceMember] = Field(default_factory=list)\n\n    # Content Metadata\n    document_count: int = 0\n    conversation_count: int = 0\n    total_size_bytes: int = 0\n\n    # Metadata\n    created_at: datetime = Field(default_factory=datetime.utcnow)\n    updated_at: datetime = Field(default_factory=datetime.utcnow)\n    last_activity_at: datetime = Field(default_factory=datetime.utcnow)\n\n    # Configuration\n    tags: List[str] = Field(default_factory=list)\n\n    @field_validator(\"members\")\n    @classmethod\n    def validate_members(cls, v: List[SpaceMember]) -&gt; List[SpaceMember]:\n        \"\"\"Ensure no duplicate members.\"\"\"\n        user_ids = [m.user_id for m in v]\n        if len(user_ids) != len(set(user_ids)):\n            raise ValueError(\"Duplicate members not allowed\")\n        return v\n\n    def has_member(self, user_id: str) -&gt; bool:\n        \"\"\"Check if user is a member of this space.\"\"\"\n        return user_id == self.owner_id or any(m.user_id == user_id for m in self.members)\n\n    def get_member_role(self, user_id: str) -&gt; Optional[str]:\n        \"\"\"Get user's role in this space.\"\"\"\n        if user_id == self.owner_id:\n            return \"owner\"\n        for member in self.members:\n            if member.user_id == user_id:\n                return member.role\n        return None\n\n    def can_add_document(self, user_id: str) -&gt; bool:\n        \"\"\"Check if user can add documents to this space.\"\"\"\n        role = self.get_member_role(user_id)\n        return role in [\"owner\", \"contributor\"]\n\n    def add_document(self, document_id: str, size_bytes: int):\n        \"\"\"Add document to space (business logic).\"\"\"\n        self.document_count += 1\n        self.total_size_bytes += size_bytes\n        self.last_activity_at = datetime.utcnow()\n        self.updated_at = datetime.utcnow()\n</code></pre></p> <p>Business Rules: - Space must have at least 1 owner (invariant) - Members cannot be added if visibility is PRIVATE (only owner access) - Archived spaces are read-only (no new documents/queries) - Space size cannot exceed tenant quota</p>"},{"location":"SPECIFICATION/#44-document-entity","title":"4.4 Document (Entity)","text":"<p>Purpose: Represents a file uploaded to a space (policy doc, jurisprudence decision, guide).</p> <p>Schema: <pre><code># src/eva_core/domain/entities/document.py\nfrom pydantic import BaseModel, Field, field_validator\nfrom typing import Optional, List, Dict, Any\nfrom datetime import datetime\nfrom enum import Enum\nimport uuid\nimport hashlib\n\nclass DocumentStatus(str, Enum):\n    PENDING = \"pending\"       # Uploaded, not yet indexed\n    PROCESSING = \"processing\" # Being chunked/embedded\n    INDEXED = \"indexed\"       # Ready for queries\n    FAILED = \"failed\"         # Processing failed\n    DELETED = \"deleted\"       # Soft-deleted\n\nclass DocumentType(str, Enum):\n    POLICY = \"policy\"\n    JURISPRUDENCE = \"jurisprudence\"\n    GUIDANCE = \"guidance\"\n    FAQ = \"faq\"\n    OTHER = \"other\"\n\nclass DocumentMetadata(BaseModel):\n    \"\"\"Document metadata (extracted during indexing).\"\"\"\n    author: Optional[str] = None\n    publication_date: Optional[datetime] = None\n    effective_date: Optional[datetime] = None\n    language: str = \"en\"  # en, fr\n    page_count: Optional[int] = None\n    tags: List[str] = Field(default_factory=list)\n    custom_fields: Dict[str, Any] = Field(default_factory=dict)\n\nclass Document(BaseModel):\n    \"\"\"Document entity (owned by a Space).\"\"\"\n\n    # Identity\n    id: str = Field(default_factory=lambda: str(uuid.uuid4()))\n    space_id: str  # Parent space\n    tenant_id: str  # Tenant isolation\n\n    # Content\n    filename: str = Field(min_length=1, max_length=255)\n    content_type: str = \"application/pdf\"  # MIME type\n    size_bytes: int = Field(gt=0)\n    content_hash: str  # SHA-256 hash (for deduplication)\n\n    # Storage\n    blob_url: str  # Azure Blob Storage URL\n\n    # Classification\n    document_type: DocumentType = DocumentType.OTHER\n    status: DocumentStatus = DocumentStatus.PENDING\n\n    # Metadata\n    metadata: DocumentMetadata = Field(default_factory=DocumentMetadata)\n\n    # Indexing\n    chunk_count: int = 0  # Number of chunks created during indexing\n    indexed_at: Optional[datetime] = None\n\n    # Access\n    uploaded_by: str  # User ID\n    created_at: datetime = Field(default_factory=datetime.utcnow)\n    updated_at: datetime = Field(default_factory=datetime.utcnow)\n\n    @staticmethod\n    def compute_content_hash(content: bytes) -&gt; str:\n        \"\"\"Compute SHA-256 hash of content (for deduplication).\"\"\"\n        return hashlib.sha256(content).hexdigest()\n\n    @field_validator(\"filename\")\n    @classmethod\n    def validate_filename(cls, v: str) -&gt; str:\n        \"\"\"Ensure filename has valid extension.\"\"\"\n        allowed_extensions = [\".pdf\", \".docx\", \".txt\", \".md\"]\n        if not any(v.lower().endswith(ext) for ext in allowed_extensions):\n            raise ValueError(f\"Invalid file extension. Allowed: {allowed_extensions}\")\n        return v\n\n    def is_duplicate(self, other_hash: str) -&gt; bool:\n        \"\"\"Check if document is duplicate based on content hash.\"\"\"\n        return self.content_hash == other_hash\n\n    def mark_as_indexed(self, chunk_count: int):\n        \"\"\"Mark document as successfully indexed.\"\"\"\n        self.status = DocumentStatus.INDEXED\n        self.chunk_count = chunk_count\n        self.indexed_at = datetime.utcnow()\n        self.updated_at = datetime.utcnow()\n</code></pre></p> <p>Business Rules: - Content hash must be unique per space (no duplicate documents) - Document size cannot exceed 50MB (configurable) - Only contributors and owners can upload documents - Deleted documents retain metadata for 90 days (soft delete)</p>"},{"location":"SPECIFICATION/#45-query-entity","title":"4.5 Query (Entity)","text":"<p>Purpose: User question sent to RAG engine (with answer + citations).</p> <p>Schema: <pre><code># src/eva_core/domain/entities/query.py\nfrom pydantic import BaseModel, Field\nfrom typing import List, Optional\nfrom datetime import datetime\nfrom enum import Enum\nimport uuid\n\nclass QueryStatus(str, Enum):\n    PENDING = \"pending\"       # Submitted, not yet processed\n    PROCESSING = \"processing\" # RAG engine working\n    COMPLETED = \"completed\"   # Answer generated\n    FAILED = \"failed\"         # Error occurred\n\nclass Citation(BaseModel):\n    \"\"\"Citation linking answer to source document.\"\"\"\n    document_id: str\n    chunk_id: str\n    document_name: str\n    page_number: Optional[int] = None\n    relevance_score: float = Field(ge=0.0, le=1.0)\n    excerpt: str = Field(max_length=500)  # Text snippet\n\nclass Query(BaseModel):\n    \"\"\"Query entity (user question to RAG engine).\"\"\"\n\n    # Identity\n    id: str = Field(default_factory=lambda: str(uuid.uuid4()))\n    space_id: str  # Space where query was executed\n    tenant_id: str  # Tenant isolation\n    conversation_id: Optional[str] = None  # Optional conversation grouping\n\n    # Question\n    question: str = Field(min_length=1, max_length=2000)\n    language: str = \"en\"  # en, fr\n\n    # Answer\n    answer: Optional[str] = None\n    citations: List[Citation] = Field(default_factory=list)\n\n    # Status\n    status: QueryStatus = QueryStatus.PENDING\n    error_message: Optional[str] = None\n\n    # Performance\n    processing_time_ms: Optional[int] = None\n    tokens_used: Optional[int] = None\n\n    # Audit\n    user_id: str  # User who submitted query\n    created_at: datetime = Field(default_factory=datetime.utcnow)\n    completed_at: Optional[datetime] = None\n\n    def mark_as_completed(self, answer: str, citations: List[Citation], processing_time_ms: int):\n        \"\"\"Mark query as completed (business logic).\"\"\"\n        self.answer = answer\n        self.citations = citations\n        self.status = QueryStatus.COMPLETED\n        self.processing_time_ms = processing_time_ms\n        self.completed_at = datetime.utcnow()\n\n    def mark_as_failed(self, error_message: str):\n        \"\"\"Mark query as failed.\"\"\"\n        self.status = QueryStatus.FAILED\n        self.error_message = error_message\n        self.completed_at = datetime.utcnow()\n</code></pre></p> <p>Business Rules: - Query must belong to a space user has access to - Citations must reference documents in the same space - Failed queries retried max 3 times - Query history retained for 2 years (compliance)</p>"},{"location":"SPECIFICATION/#46-conversation-entity","title":"4.6 Conversation (Entity)","text":"<p>Purpose: Group related queries into a conversation thread.</p> <p>Schema: <pre><code># src/eva_core/domain/entities/conversation.py\nfrom pydantic import BaseModel, Field\nfrom typing import List, Optional\nfrom datetime import datetime\nfrom enum import Enum\nimport uuid\n\nclass ConversationStatus(str, Enum):\n    ACTIVE = \"active\"\n    ARCHIVED = \"archived\"\n\nclass Conversation(BaseModel):\n    \"\"\"Conversation entity (grouping of queries).\"\"\"\n\n    # Identity\n    id: str = Field(default_factory=lambda: str(uuid.uuid4()))\n    space_id: str\n    tenant_id: str\n\n    # Content\n    title: str = Field(min_length=1, max_length=200)\n    description: Optional[str] = Field(None, max_length=1000)\n    status: ConversationStatus = ConversationStatus.ACTIVE\n\n    # Queries\n    query_count: int = 0\n    last_query_at: Optional[datetime] = None\n\n    # Audit\n    user_id: str  # Owner\n    created_at: datetime = Field(default_factory=datetime.utcnow)\n    updated_at: datetime = Field(default_factory=datetime.utcnow)\n\n    def add_query(self, query_id: str):\n        \"\"\"Add query to conversation.\"\"\"\n        self.query_count += 1\n        self.last_query_at = datetime.utcnow()\n        self.updated_at = datetime.utcnow()\n</code></pre></p>"},{"location":"SPECIFICATION/#5-value-objects","title":"5. Value Objects","text":""},{"location":"SPECIFICATION/#51-email-value-object","title":"5.1 Email (Value Object)","text":"<pre><code># src/eva_core/domain/value_objects/email.py\nfrom pydantic import BaseModel, EmailStr, field_validator\n\nclass Email(BaseModel):\n    \"\"\"Email value object with validation.\"\"\"\n    value: EmailStr\n\n    def mask(self) -&gt; str:\n        \"\"\"Mask email for logging: john.doe@example.com \u2192 j***e@e*****e.com\"\"\"\n        parts = self.value.split(\"@\")\n        return f\"{parts[0][0]}***{parts[0][-1]}@{parts[1][0]}*****{parts[1][-1]}\"\n</code></pre>"},{"location":"SPECIFICATION/#52-phonenumber-value-object","title":"5.2 PhoneNumber (Value Object)","text":"<pre><code># src/eva_core/domain/value_objects/phone_number.py\nfrom pydantic import BaseModel, field_validator\nimport re\n\nclass PhoneNumber(BaseModel):\n    \"\"\"Canadian phone number value object.\"\"\"\n    value: str\n\n    @field_validator(\"value\")\n    @classmethod\n    def validate_phone(cls, v: str) -&gt; str:\n        \"\"\"Validate Canadian phone number format.\"\"\"\n        # Remove formatting\n        digits = re.sub(r\"\\D\", \"\", v)\n\n        # Must be 10 digits (Canadian)\n        if len(digits) != 10:\n            raise ValueError(\"Phone number must be 10 digits\")\n\n        # Format: (xxx) xxx-xxxx\n        return f\"({digits[:3]}) {digits[3:6]}-{digits[6:]}\"\n\n    def mask(self) -&gt; str:\n        \"\"\"Mask phone for logging: (613) 555-1234 \u2192 (***) ***-1234\"\"\"\n        return f\"(***) ***{self.value[-5:]}\"\n</code></pre>"},{"location":"SPECIFICATION/#53-sin-value-object-with-pii-masking","title":"5.3 SIN (Value Object with PII Masking)","text":"<pre><code># src/eva_core/domain/value_objects/sin.py\nfrom pydantic import BaseModel, field_validator\nimport re\n\nclass SIN(BaseModel):\n    \"\"\"Canadian Social Insurance Number (Protected B PII).\"\"\"\n    value: str\n\n    @field_validator(\"value\")\n    @classmethod\n    def validate_sin(cls, v: str) -&gt; str:\n        \"\"\"Validate SIN format (9 digits, Luhn checksum).\"\"\"\n        # Remove spaces/dashes\n        digits = re.sub(r\"\\D\", \"\", v)\n\n        # Must be 9 digits\n        if len(digits) != 9:\n            raise ValueError(\"SIN must be 9 digits\")\n\n        # Luhn checksum validation (CRA algorithm)\n        checksum = sum(int(d) if i % 2 == 0 else sum(divmod(int(d) * 2, 10)) for i, d in enumerate(digits))\n        if checksum % 10 != 0:\n            raise ValueError(\"Invalid SIN checksum\")\n\n        # Format: xxx-xxx-xxx\n        return f\"{digits[:3]}-{digits[3:6]}-{digits[6:]}\"\n\n    def mask(self) -&gt; str:\n        \"\"\"Mask SIN for logging: 123-456-789 \u2192 ***-***-789\"\"\"\n        return f\"***-***{self.value[-4:]}\"\n</code></pre>"},{"location":"SPECIFICATION/#6-domain-events","title":"6. Domain Events","text":""},{"location":"SPECIFICATION/#61-event-base-class","title":"6.1 Event Base Class","text":"<pre><code># src/eva_core/domain/events/base.py\nfrom pydantic import BaseModel, Field\nfrom datetime import datetime\nfrom typing import Dict, Any\nimport uuid\n\nclass DomainEvent(BaseModel):\n    \"\"\"Base class for all domain events.\"\"\"\n    event_id: str = Field(default_factory=lambda: str(uuid.uuid4()))\n    event_type: str\n    aggregate_id: str  # ID of entity that triggered event\n    tenant_id: str\n    user_id: str  # User who triggered event\n    timestamp: datetime = Field(default_factory=datetime.utcnow)\n    metadata: Dict[str, Any] = Field(default_factory=dict)\n</code></pre>"},{"location":"SPECIFICATION/#62-space-events","title":"6.2 Space Events","text":"<pre><code># src/eva_core/domain/events/space_events.py\nfrom eva_core.domain.events.base import DomainEvent\n\nclass SpaceCreated(DomainEvent):\n    event_type: str = \"space.created\"\n    space_id: str\n    space_name: str\n    owner_id: str\n\nclass DocumentAdded(DomainEvent):\n    event_type: str = \"space.document.added\"\n    space_id: str\n    document_id: str\n    document_name: str\n    size_bytes: int\n\nclass MemberAdded(DomainEvent):\n    event_type: str = \"space.member.added\"\n    space_id: str\n    member_id: str\n    role: str\n</code></pre>"},{"location":"SPECIFICATION/#63-query-events","title":"6.3 Query Events","text":"<pre><code># src/eva_core/domain/events/query_events.py\nfrom eva_core.domain.events.base import DomainEvent\n\nclass QueryExecuted(DomainEvent):\n    event_type: str = \"query.executed\"\n    query_id: str\n    space_id: str\n    processing_time_ms: int\n    citation_count: int\n\nclass QueryFailed(DomainEvent):\n    event_type: str = \"query.failed\"\n    query_id: str\n    space_id: str\n    error_message: str\n</code></pre>"},{"location":"SPECIFICATION/#7-repository-interfaces","title":"7. Repository Interfaces","text":""},{"location":"SPECIFICATION/#71-base-repository","title":"7.1 Base Repository","text":"<pre><code># src/eva_core/repositories/base.py\nfrom abc import ABC, abstractmethod\nfrom typing import Generic, TypeVar, Optional, List\n\nT = TypeVar(\"T\")\n\nclass Repository(ABC, Generic[T]):\n    \"\"\"Abstract repository interface.\"\"\"\n\n    @abstractmethod\n    async def get_by_id(self, id: str) -&gt; Optional[T]:\n        \"\"\"Get entity by ID.\"\"\"\n        pass\n\n    @abstractmethod\n    async def save(self, entity: T) -&gt; T:\n        \"\"\"Save entity (insert or update).\"\"\"\n        pass\n\n    @abstractmethod\n    async def delete(self, id: str) -&gt; bool:\n        \"\"\"Delete entity.\"\"\"\n        pass\n\n    @abstractmethod\n    async def list(self, offset: int = 0, limit: int = 100) -&gt; List[T]:\n        \"\"\"List entities with pagination.\"\"\"\n        pass\n</code></pre>"},{"location":"SPECIFICATION/#72-user-repository","title":"7.2 User Repository","text":"<pre><code># src/eva_core/repositories/user_repository.py\nfrom eva_core.repositories.base import Repository\nfrom eva_core.domain.entities.user import User\nfrom typing import Optional\n\nclass UserRepository(Repository[User]):\n    \"\"\"User repository interface.\"\"\"\n\n    async def get_by_email(self, email: str, tenant_id: str) -&gt; Optional[User]:\n        \"\"\"Get user by email (within tenant).\"\"\"\n        pass\n\n    async def get_by_auth_sub(self, auth_sub: str, auth_provider: str) -&gt; Optional[User]:\n        \"\"\"Get user by authentication subject (from JWT).\"\"\"\n        pass\n\n    async def list_by_tenant(self, tenant_id: str, offset: int = 0, limit: int = 100) -&gt; List[User]:\n        \"\"\"List users in tenant.\"\"\"\n        pass\n</code></pre>"},{"location":"SPECIFICATION/#73-space-repository","title":"7.3 Space Repository","text":"<pre><code># src/eva_core/repositories/space_repository.py\nfrom eva_core.repositories.base import Repository\nfrom eva_core.domain.entities.space import Space\nfrom typing import List\n\nclass SpaceRepository(Repository[Space]):\n    \"\"\"Space repository interface.\"\"\"\n\n    async def list_by_tenant(self, tenant_id: str, offset: int = 0, limit: int = 100) -&gt; List[Space]:\n        \"\"\"List spaces in tenant.\"\"\"\n        pass\n\n    async def list_by_user(self, user_id: str, tenant_id: str, offset: int = 0, limit: int = 100) -&gt; List[Space]:\n        \"\"\"List spaces user has access to.\"\"\"\n        pass\n</code></pre>"},{"location":"SPECIFICATION/#8-quality-gates-all-must-pass","title":"8. Quality Gates (All Must Pass)","text":""},{"location":"SPECIFICATION/#1-test-coverage-100","title":"1. Test Coverage: 100%","text":"<ul> <li>Tool: pytest + Coverage.py + hypothesis</li> <li>Command: <code>pytest --cov=eva_core --cov-report=html --cov-fail-under=100</code></li> <li>Target: 100% line coverage, 100% branch coverage</li> <li>Property Testing: Hypothesis for validation rules (generate 1000+ invalid inputs, ensure rejection)</li> <li>Evidence: Coverage report + hypothesis test results</li> </ul>"},{"location":"SPECIFICATION/#2-type-safety-100","title":"2. Type Safety: 100%","text":"<ul> <li>Tool: mypy (strict mode)</li> <li>Command: <code>mypy src/eva_core --strict</code></li> <li>Target: Zero type errors</li> <li>Evidence: mypy output showing \"Success: no issues found\"</li> </ul>"},{"location":"SPECIFICATION/#3-data-validation","title":"3. Data Validation","text":"<ul> <li>Invalid Data Rejection: 100% of invalid entities rejected by Pydantic</li> <li>PII Masking: 100% of SIN/email/phone masked in logs</li> <li>Business Rules: All invariants enforced (tested)</li> <li>Evidence: Unit tests for validation, PII masking tests passing</li> </ul>"},{"location":"SPECIFICATION/#4-performance-benchmarks","title":"4. Performance Benchmarks","text":"<ul> <li>Serialization: &lt; 10ms (p95) for entity to JSON</li> <li>Validation: &lt; 5ms (p95) for Pydantic validation</li> <li>Memory: &lt; 10MB per 1000 entities loaded</li> <li>Evidence: pytest-benchmark results</li> </ul>"},{"location":"SPECIFICATION/#5-documentation","title":"5. Documentation","text":"<ul> <li>Docstrings: 100% of public APIs documented</li> <li>API Docs: MkDocs site generated from docstrings</li> <li>Usage Examples: Code snippets for each entity/repository</li> <li>Evidence: Published MkDocs site, usage examples tested</li> </ul>"},{"location":"SPECIFICATION/#6-code-quality","title":"6. Code Quality","text":"<ul> <li>Linting: ruff passing (no warnings)</li> <li>Formatting: ruff format applied consistently</li> <li>Complexity: McCabe complexity &lt; 10 for all functions</li> <li>Evidence: ruff check output, complexity report</li> </ul>"},{"location":"SPECIFICATION/#7-dependency-management","title":"7. Dependency Management","text":"<ul> <li>Minimal Dependencies: Only Pydantic + testing libraries</li> <li>No Database Dependencies: Repositories are abstract (implemented in eva-api/eva-rag)</li> <li>Version Pinning: All dependencies pinned in pyproject.toml</li> <li>Evidence: pyproject.toml review</li> </ul>"},{"location":"SPECIFICATION/#8-internationalization","title":"8. Internationalization","text":"<ul> <li>Bilingual Validation Errors: EN-CA/FR-CA error messages</li> <li>Field Labels: Bilingual field descriptions</li> <li>Evidence: i18n test suite passing</li> </ul>"},{"location":"SPECIFICATION/#9-security","title":"9. Security","text":"<ul> <li>PII Masking: Automatic masking in repr and logs</li> <li>No Secrets in Models: Configuration via environment variables only</li> <li>Input Validation: All user inputs validated by Pydantic</li> <li>Evidence: Security audit checklist, PII masking tests</li> </ul>"},{"location":"SPECIFICATION/#10-packaging","title":"10. Packaging","text":"<ul> <li>Python Package: Installable via <code>pip install eva-core</code></li> <li>Version: Semantic versioning (1.0.0)</li> <li>Type Stubs: py.typed marker for type checkers</li> <li>Evidence: Package installed in test environment, types recognized by mypy</li> </ul>"},{"location":"SPECIFICATION/#11-cicd","title":"11. CI/CD","text":"<ul> <li>GitHub Actions: All checks passing on pull requests</li> <li>Test Matrix: Python 3.11, 3.12 tested</li> <li>Build: Package builds successfully</li> <li>Evidence: CI/CD workflow logs</li> </ul>"},{"location":"SPECIFICATION/#12-developer-experience","title":"12. Developer Experience","text":"<ul> <li>Setup Time: &lt; 3 minutes (poetry install)</li> <li>Type Hints: 100% coverage for IDE autocomplete</li> <li>Clear Error Messages: Pydantic validation errors human-readable</li> <li>Evidence: Developer feedback, onboarding time tracking</li> </ul>"},{"location":"SPECIFICATION/#9-implementation-phases-4-phases-6-weeks","title":"9. Implementation Phases (4 Phases, 6 Weeks)","text":""},{"location":"SPECIFICATION/#phase-1-core-entities-week-1-2","title":"Phase 1: Core Entities (Week 1-2)","text":"<p>Goal: Define and validate all domain entities</p> <p>Tasks: 1. Project setup: Poetry, pytest, mypy, ruff, pre-commit hooks 2. User entity: Pydantic model, validation, PII masking, tests 3. Tenant entity: Pydantic model, quotas, tests 4. Space entity: Pydantic model, members, access control logic, tests 5. Document entity: Pydantic model, content hash, deduplication, tests 6. Query entity: Pydantic model, citations, status management, tests 7. Conversation entity: Pydantic model, tests 8. Value objects: Email, PhoneNumber, SIN (with masking), tests</p> <p>Deliverables: - All entities defined with Pydantic - 100% test coverage for Phase 1 modules - mypy passing (strict mode)</p> <p>Evidence: - <code>pytest --cov=eva_core --cov-report=html</code> passing - <code>mypy src/eva_core --strict</code> passing - Code examples for each entity</p>"},{"location":"SPECIFICATION/#phase-2-domain-events-business-logic-week-3-4","title":"Phase 2: Domain Events &amp; Business Logic (Week 3-4)","text":"<p>Goal: Implement domain events and business rules</p> <p>Tasks: 1. Event base class: DomainEvent with metadata 2. Space events: SpaceCreated, DocumentAdded, MemberAdded 3. Query events: QueryExecuted, QueryFailed 4. Business logic: User.can_access_space(), Space.can_add_document() 5. Validation rules: Hypothesis property tests (1000+ invalid inputs) 6. Aggregate invariants: Space must have owner, Document must be unique 7. Tests: Event serialization, business logic, invariants</p> <p>Deliverables: - Domain events defined - Business logic implemented and tested - Hypothesis tests passing</p> <p>Evidence: - Event JSON schema examples - Business logic tests passing - Hypothesis test report (1000+ cases)</p>"},{"location":"SPECIFICATION/#phase-3-repository-interfaces-week-5","title":"Phase 3: Repository Interfaces (Week 5)","text":"<p>Goal: Define abstract repository interfaces</p> <p>Tasks: 1. Base repository: Generic CRUD operations 2. User repository: get_by_email, get_by_auth_sub, list_by_tenant 3. Tenant repository: get_by_slug 4. Space repository: list_by_user, list_by_tenant 5. Document repository: get_by_hash (deduplication), list_by_space 6. Query repository: list_by_space, list_by_conversation 7. Conversation repository: list_by_space 8. Mock implementations: For unit tests (in-memory)</p> <p>Deliverables: - Repository interfaces defined - Mock implementations for testing - Usage examples</p> <p>Evidence: - Repository interface code - Mock repository tests passing - Usage guide</p>"},{"location":"SPECIFICATION/#phase-4-packaging-documentation-week-6","title":"Phase 4: Packaging &amp; Documentation (Week 6)","text":"<p>Goal: Publish Python package with complete documentation</p> <p>Tasks: 1. pyproject.toml: Package metadata, dependencies, version 2. MkDocs setup: API docs generated from docstrings 3. Usage guide: Code examples for each entity/repository 4. Type stubs: py.typed marker for type checkers 5. CI/CD: GitHub Actions (test, lint, type-check, build) 6. Package build: Build wheel + source distribution 7. Publish: Internal PyPI or GitHub Packages</p> <p>Deliverables: - Python package published (v1.0.0) - MkDocs documentation site - CI/CD pipeline working - All 12 quality gates passed</p> <p>Evidence: - <code>pip install eva-core</code> working - MkDocs site published - CI/CD logs showing all checks passed - Quality gates report</p>"},{"location":"SPECIFICATION/#10-references","title":"10. References","text":""},{"location":"SPECIFICATION/#domain-driven-design","title":"Domain-Driven Design","text":"<ul> <li>DDD Patterns: https://martinfowler.com/bliki/DomainDrivenDesign.html</li> <li>Aggregate Pattern: https://martinfowler.com/bliki/DDD_Aggregate.html</li> <li>Repository Pattern: https://martinfowler.com/eaaCatalog/repository.html</li> <li>Domain Events: https://martinfowler.com/eaaDev/DomainEvent.html</li> </ul>"},{"location":"SPECIFICATION/#reference-implementations","title":"Reference Implementations","text":"<ul> <li>OpenWebUI Models: <code>OpenWebUI/backend/open_webui/models/</code> (User, Chat, File, Knowledge)</li> <li>Pydantic Patterns: https://docs.pydantic.dev/latest/</li> </ul>"},{"location":"SPECIFICATION/#eva-orchestrator-docs","title":"EVA Orchestrator Docs","text":"<ul> <li>P02 Domain Core Requirement: <code>archive/2025-11-25-intake/eva-2.0-raw/EVA-2.0/intake/P02-REQ-PREQ-DOMAIN-CORE.md</code></li> <li>eva-core Brief: <code>docs/EVA-2.0/ESDC/eva2_fastlane_repo_v5_full/eva2_fastlane_repo_v5_full/copilot_briefs/eva-core.md</code></li> </ul>"},{"location":"SPECIFICATION/#python-libraries","title":"Python Libraries","text":"<ul> <li>Pydantic: https://docs.pydantic.dev/latest/</li> <li>pytest: https://docs.pytest.org/en/stable/</li> <li>Hypothesis: https://hypothesis.readthedocs.io/en/latest/</li> <li>mypy: https://mypy.readthedocs.io/en/stable/</li> <li>ruff: https://docs.astral.sh/ruff/</li> </ul>"},{"location":"SPECIFICATION/#11-autonomous-implementation-model","title":"11. Autonomous Implementation Model","text":""},{"location":"SPECIFICATION/#context-engineering-principles","title":"Context Engineering Principles","text":"<p>This specification follows the Three Concepts Pattern:</p> <ol> <li>Context Engineering: Complete specification (no gaps), reference implementations analyzed (OpenWebUI models), DDD patterns documented</li> <li>Complete SDLC: TDD (property-based testing with Hypothesis), type-safe (mypy strict), CI/CD (GitHub Actions), documentation (MkDocs)</li> <li>Execution Evidence Rule: All deliverables must include evidence (test reports, type-check output, package installation proof, API docs)</li> </ol>"},{"location":"SPECIFICATION/#implementation-approach","title":"Implementation Approach","text":"<p>Marco will NOT be available for incremental approvals during the 6-week implementation. The agent must:</p> <ol> <li>Follow Requirements TO THE LETTER: No shortcuts, no approximations, no \"close enough\"</li> <li>Use Reference Implementations: OpenWebUI model patterns (SQLAlchemy + Pydantic)</li> <li>Apply All 12 Quality Gates: 100% coverage, 100% type safety, Hypothesis property tests, packaging</li> <li>Test Continuously: TDD approach (write tests first), property-based testing (Hypothesis), run tests after every change</li> <li>Document Everything: Docstrings for all public APIs, usage examples, MkDocs generated site</li> <li>Generate Evidence: Test reports, type-check output, package build logs, API docs screenshots</li> </ol>"},{"location":"SPECIFICATION/#binary-final-review","title":"Binary Final Review","text":"<p>After 6 weeks, Marco will perform a binary review:</p> <ul> <li>\u2705 All 12 quality gates PASS \u2192 Ship to production (publish package)</li> <li>\u274c Any gate FAILS \u2192 List specific failures, agent fixes, resubmit for review</li> </ul> <p>There is NO partial credit. All gates must pass.</p>"},{"location":"SPECIFICATION/#success-criteria","title":"Success Criteria","text":"<p>IF this specification is followed completely AND all reference patterns are applied AND all 12 quality gates pass THEN eva-core will be production-ready without Marco's incremental involvement.</p> <p>This is the proven model from EVA-API and EVA-AUTH (comprehensive spec \u2192 autonomous implementation \u2192 all gates passed).</p>"},{"location":"SPECIFICATION/#12-next-steps","title":"12. Next Steps","text":"<ol> <li> <p>Marco Opens eva-core Workspace:    <pre><code>cd \"C:\\Users\\marco\\Documents\\_AI Dev\\EVA Suite\"\ncode eva-core\n</code></pre></p> </li> <li> <p>Run Startup Script:    <pre><code>.\\_MARCO-use-this-to-tell_copilot-to-read-repo-specific-instructions.ps1\n</code></pre></p> </li> <li> <p>Copy Output to Copilot:</p> </li> <li>Copy green text (5 bullet points)</li> <li>Paste as FIRST message to GitHub Copilot</li> <li> <p>Wait for Copilot to confirm it read <code>docs/SPECIFICATION.md</code></p> </li> <li> <p>Give Task:    <pre><code>Implement Phase 1: Core Entities (User, Tenant, Space, Document, Query, Conversation, value objects).\nFollow specification TO THE LETTER.\nUse OpenWebUI model patterns (SQLAlchemy + Pydantic).\nUse Hypothesis for property-based testing (1000+ invalid inputs).\nAchieve 100% test coverage + 100% type safety (mypy strict).\nShow test report + type-check output when done.\n</code></pre></p> </li> <li> <p>Check In Biweekly (NOT Weekly):</p> </li> <li>Week 2: Phase 1 complete? (All entities defined, tests passing, mypy passing)</li> <li>Week 4: Phase 2 complete? (Domain events, business logic, Hypothesis tests)</li> <li>Week 5: Phase 3 complete? (Repository interfaces, mock implementations)</li> <li> <p>Week 6: Phase 4 complete? (Package published, MkDocs site, all gates PASSED)</p> </li> <li> <p>Final Review (Week 7):</p> </li> <li>Marco validates all 12 quality gates</li> <li>Binary decision: Ship OR Fix</li> </ol> <p>END OF SPECIFICATION</p> <p>This document contains ALL requirements for autonomous eva-core implementation. No additional context needed. Follow TO THE LETTER. Good luck! \ud83d\ude80</p>"},{"location":"api/entities/","title":"API Reference: Entities","text":""},{"location":"api/entities/#eva_core.domain.entities.user","title":"<code>eva_core.domain.entities.user</code>","text":"<p>User entity (aggregate root) - represents a person using EVA.</p> Example <p>from eva_core.domain.entities.user import User, UserRole user = User( ...     tenant_id=\"tenant-123\", ...     email=\"john.doe@canada.ca\", ...     name=\"John Doe\", ...     role=UserRole.ANALYST, ...     auth_provider=\"entra_id\", ...     auth_sub=\"sub-123\", ...     created_by=\"admin-456\" ... )</p>"},{"location":"api/entities/#eva_core.domain.entities.user-classes","title":"Classes","text":""},{"location":"api/entities/#eva_core.domain.entities.user.User","title":"<code>User</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>User entity (aggregate root).</p> <p>Represents a person using EVA (citizen or employee).</p> <p>Attributes:</p> Name Type Description <code>id</code> <code>str</code> <p>Unique identifier.</p> <code>tenant_id</code> <code>str</code> <p>Organization/department ID (tenant isolation).</p> <code>email</code> <code>EmailStr</code> <p>Email address.</p> <code>name</code> <code>str</code> <p>Full name.</p> <code>role</code> <code>UserRole</code> <p>User role (viewer, analyst, admin, system).</p> <code>status</code> <code>UserStatus</code> <p>Account status (active, suspended, deleted).</p> <code>auth_provider</code> <code>str</code> <p>Authentication provider (entra_id, b2c).</p> <code>auth_sub</code> <code>str</code> <p>Subject claim from JWT (unique per provider).</p> <code>preferences</code> <code>UserPreferences</code> <p>User preferences.</p> <code>created_at</code> <code>datetime</code> <p>Creation timestamp.</p> <code>updated_at</code> <code>datetime</code> <p>Last update timestamp.</p> <code>last_login_at</code> <code>datetime | None</code> <p>Last login timestamp (optional).</p> <code>created_by</code> <code>str</code> <p>User ID who created this user.</p> Source code in <code>src\\eva_core\\domain\\entities\\user.py</code> <pre><code>class User(BaseModel):\n    \"\"\"User entity (aggregate root).\n\n    Represents a person using EVA (citizen or employee).\n\n    Attributes:\n        id: Unique identifier.\n        tenant_id: Organization/department ID (tenant isolation).\n        email: Email address.\n        name: Full name.\n        role: User role (viewer, analyst, admin, system).\n        status: Account status (active, suspended, deleted).\n        auth_provider: Authentication provider (entra_id, b2c).\n        auth_sub: Subject claim from JWT (unique per provider).\n        preferences: User preferences.\n        created_at: Creation timestamp.\n        updated_at: Last update timestamp.\n        last_login_at: Last login timestamp (optional).\n        created_by: User ID who created this user.\n    \"\"\"\n\n    # Identity\n    id: str = Field(default_factory=lambda: str(uuid.uuid4()))\n    tenant_id: str\n\n    # Profile\n    email: EmailStr\n    name: str = Field(min_length=1, max_length=200)\n    role: UserRole = UserRole.VIEWER\n    status: UserStatus = UserStatus.ACTIVE\n\n    # Authentication (references eva-auth)\n    auth_provider: str = \"entra_id\"  # entra_id, b2c\n    auth_sub: str  # Subject claim from JWT (unique per provider)\n\n    # Preferences\n    preferences: UserPreferences = Field(default_factory=UserPreferences)\n\n    # Metadata\n    created_at: datetime = Field(default_factory=datetime.utcnow)\n    updated_at: datetime = Field(default_factory=datetime.utcnow)\n    last_login_at: datetime | None = None\n\n    # Audit\n    created_by: str  # User ID who created this user (for admin actions)\n\n    def can_access_space(self, space_owner_id: str, space_tenant_id: str) -&gt; bool:\n        \"\"\"Check if user can access space (business logic).\n\n        Args:\n            space_owner_id: Owner ID of the space.\n            space_tenant_id: Tenant ID of the space.\n\n        Returns:\n            True if user can access the space, False otherwise.\n\n        Business Rules:\n            - Tenant isolation: user must be in same tenant.\n            - Admins can access all spaces in their tenant.\n            - Users can only access spaces they own (checked elsewhere).\n        \"\"\"\n        # Tenant isolation: user must be in same tenant\n        if self.tenant_id != space_tenant_id:\n            return False\n\n        # Admins can access all spaces in their tenant\n        if self.role == UserRole.ADMIN:\n            return True\n\n        # Users can only access spaces they own (checked elsewhere)\n        return False\n\n    def ensure_same_tenant(self, other_tenant_id: str) -&gt; None:\n        \"\"\"Ensure user belongs to specified tenant.\n\n        Raises:\n            ValueError: If tenant_id doesn't match.\n        \"\"\"\n        if self.tenant_id != other_tenant_id:\n            raise ValueError(\n                f\"Tenant isolation violation: user tenant {self.tenant_id} \"\n                f\"does not match {other_tenant_id}\"\n            )\n\n    def mask_pii(self) -&gt; \"User\":\n        \"\"\"Return copy with PII masked (for logging/telemetry).\n\n        Returns:\n            User instance with email and name masked.\n\n        Example:\n            &gt;&gt;&gt; user = User(\n            ...     tenant_id=\"t1\",\n            ...     email=\"john.doe@canada.ca\",\n            ...     name=\"John Doe\",\n            ...     auth_provider=\"entra_id\",\n            ...     auth_sub=\"sub-123\",\n            ...     created_by=\"admin\"\n            ... )\n            &gt;&gt;&gt; masked = user.mask_pii()\n            &gt;&gt;&gt; masked.email  # doctest: +ELLIPSIS\n            'j***e@c*****a'\n            &gt;&gt;&gt; masked.name\n            'J*** D***'\n        \"\"\"\n        masked = self.model_copy(deep=True)\n\n        # Mask email: john.doe@example.com \u2192 j***e@e*****e.com\n        email_parts = str(masked.email).split(\"@\")\n        if len(email_parts) == 2:\n            local = email_parts[0]\n            domain = email_parts[1]\n            masked_local = f\"{local[0]}***{local[-1]}\" if len(local) &gt; 1 else f\"{local}***\"\n            masked_domain = f\"{domain[0]}*****{domain[-1]}\" if len(domain) &gt; 1 else f\"{domain}***\"\n            # Assign string directly using object.__setattr__ for immutable model\n            object.__setattr__(masked, \"email\", f\"{masked_local}@{masked_domain}\")\n\n        # Mask name: John Doe \u2192 J*** D***\n        name_parts = masked.name.split()\n        masked.name = \" \".join([f\"{part[0]}***\" if part else \"***\" for part in name_parts])\n\n        return masked\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.user.User-functions","title":"Functions","text":""},{"location":"api/entities/#eva_core.domain.entities.user.User.can_access_space","title":"<code>can_access_space(space_owner_id, space_tenant_id)</code>","text":"<p>Check if user can access space (business logic).</p> <p>Parameters:</p> Name Type Description Default <code>space_owner_id</code> <code>str</code> <p>Owner ID of the space.</p> required <code>space_tenant_id</code> <code>str</code> <p>Tenant ID of the space.</p> required <p>Returns:</p> Type Description <code>bool</code> <p>True if user can access the space, False otherwise.</p> Business Rules <ul> <li>Tenant isolation: user must be in same tenant.</li> <li>Admins can access all spaces in their tenant.</li> <li>Users can only access spaces they own (checked elsewhere).</li> </ul> Source code in <code>src\\eva_core\\domain\\entities\\user.py</code> <pre><code>def can_access_space(self, space_owner_id: str, space_tenant_id: str) -&gt; bool:\n    \"\"\"Check if user can access space (business logic).\n\n    Args:\n        space_owner_id: Owner ID of the space.\n        space_tenant_id: Tenant ID of the space.\n\n    Returns:\n        True if user can access the space, False otherwise.\n\n    Business Rules:\n        - Tenant isolation: user must be in same tenant.\n        - Admins can access all spaces in their tenant.\n        - Users can only access spaces they own (checked elsewhere).\n    \"\"\"\n    # Tenant isolation: user must be in same tenant\n    if self.tenant_id != space_tenant_id:\n        return False\n\n    # Admins can access all spaces in their tenant\n    if self.role == UserRole.ADMIN:\n        return True\n\n    # Users can only access spaces they own (checked elsewhere)\n    return False\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.user.User.ensure_same_tenant","title":"<code>ensure_same_tenant(other_tenant_id)</code>","text":"<p>Ensure user belongs to specified tenant.</p> <p>Raises:</p> Type Description <code>ValueError</code> <p>If tenant_id doesn't match.</p> Source code in <code>src\\eva_core\\domain\\entities\\user.py</code> <pre><code>def ensure_same_tenant(self, other_tenant_id: str) -&gt; None:\n    \"\"\"Ensure user belongs to specified tenant.\n\n    Raises:\n        ValueError: If tenant_id doesn't match.\n    \"\"\"\n    if self.tenant_id != other_tenant_id:\n        raise ValueError(\n            f\"Tenant isolation violation: user tenant {self.tenant_id} \"\n            f\"does not match {other_tenant_id}\"\n        )\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.user.User.mask_pii","title":"<code>mask_pii()</code>","text":"<p>Return copy with PII masked (for logging/telemetry).</p> <p>Returns:</p> Type Description <code>User</code> <p>User instance with email and name masked.</p> Example <p>user = User( ...     tenant_id=\"t1\", ...     email=\"john.doe@canada.ca\", ...     name=\"John Doe\", ...     auth_provider=\"entra_id\", ...     auth_sub=\"sub-123\", ...     created_by=\"admin\" ... ) masked = user.mask_pii() masked.email  # doctest: +ELLIPSIS 'je@ca' masked.name 'J D**'</p> Source code in <code>src\\eva_core\\domain\\entities\\user.py</code> <pre><code>def mask_pii(self) -&gt; \"User\":\n    \"\"\"Return copy with PII masked (for logging/telemetry).\n\n    Returns:\n        User instance with email and name masked.\n\n    Example:\n        &gt;&gt;&gt; user = User(\n        ...     tenant_id=\"t1\",\n        ...     email=\"john.doe@canada.ca\",\n        ...     name=\"John Doe\",\n        ...     auth_provider=\"entra_id\",\n        ...     auth_sub=\"sub-123\",\n        ...     created_by=\"admin\"\n        ... )\n        &gt;&gt;&gt; masked = user.mask_pii()\n        &gt;&gt;&gt; masked.email  # doctest: +ELLIPSIS\n        'j***e@c*****a'\n        &gt;&gt;&gt; masked.name\n        'J*** D***'\n    \"\"\"\n    masked = self.model_copy(deep=True)\n\n    # Mask email: john.doe@example.com \u2192 j***e@e*****e.com\n    email_parts = str(masked.email).split(\"@\")\n    if len(email_parts) == 2:\n        local = email_parts[0]\n        domain = email_parts[1]\n        masked_local = f\"{local[0]}***{local[-1]}\" if len(local) &gt; 1 else f\"{local}***\"\n        masked_domain = f\"{domain[0]}*****{domain[-1]}\" if len(domain) &gt; 1 else f\"{domain}***\"\n        # Assign string directly using object.__setattr__ for immutable model\n        object.__setattr__(masked, \"email\", f\"{masked_local}@{masked_domain}\")\n\n    # Mask name: John Doe \u2192 J*** D***\n    name_parts = masked.name.split()\n    masked.name = \" \".join([f\"{part[0]}***\" if part else \"***\" for part in name_parts])\n\n    return masked\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.user.UserRole","title":"<code>UserRole</code>","text":"<p>               Bases: <code>str</code>, <code>Enum</code></p> <p>User roles with increasing permissions.</p> Source code in <code>src\\eva_core\\domain\\entities\\user.py</code> <pre><code>class UserRole(str, Enum):\n    \"\"\"User roles with increasing permissions.\"\"\"\n\n    VIEWER = \"viewer\"  # Read-only access\n    ANALYST = \"analyst\"  # Can create queries, add documents\n    ADMIN = \"admin\"  # Full control (user management, space management)\n    SYSTEM = \"system\"  # Internal system operations\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.user.UserStatus","title":"<code>UserStatus</code>","text":"<p>               Bases: <code>str</code>, <code>Enum</code></p> <p>User account status.</p> Source code in <code>src\\eva_core\\domain\\entities\\user.py</code> <pre><code>class UserStatus(str, Enum):\n    \"\"\"User account status.\"\"\"\n\n    ACTIVE = \"active\"  # Can use system\n    SUSPENDED = \"suspended\"  # Temporarily blocked\n    DELETED = \"deleted\"  # Soft-deleted (retain audit trail)\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.user.UserPreferences","title":"<code>UserPreferences</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>User preferences (UI settings, notifications).</p> <p>Attributes:</p> Name Type Description <code>locale</code> <code>str</code> <p>Language (en-CA, fr-CA).</p> <code>timezone</code> <code>str</code> <p>Timezone string (e.g., America/Toronto).</p> <code>email_notifications</code> <code>bool</code> <p>Email notifications enabled.</p> <code>theme</code> <code>str</code> <p>UI theme (light, dark, auto).</p> <code>results_per_page</code> <code>int</code> <p>Pagination default.</p> Source code in <code>src\\eva_core\\domain\\entities\\user.py</code> <pre><code>class UserPreferences(BaseModel):\n    \"\"\"User preferences (UI settings, notifications).\n\n    Attributes:\n        locale: Language (en-CA, fr-CA).\n        timezone: Timezone string (e.g., America/Toronto).\n        email_notifications: Email notifications enabled.\n        theme: UI theme (light, dark, auto).\n        results_per_page: Pagination default.\n    \"\"\"\n\n    locale: str = \"en-CA\"\n    timezone: str = \"America/Toronto\"\n    email_notifications: bool = True\n    theme: str = \"auto\"\n    results_per_page: int = 20\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.tenant","title":"<code>eva_core.domain.entities.tenant</code>","text":"<p>Tenant entity (aggregate root) - represents an organization or department.</p> Example <p>from eva_core.domain.entities.tenant import Tenant, TenantQuotas tenant = Tenant( ...     name=\"Department of Example\", ...     slug=\"dept-of-example\", ...     created_by=\"admin-123\" ... )</p>"},{"location":"api/entities/#eva_core.domain.entities.tenant-classes","title":"Classes","text":""},{"location":"api/entities/#eva_core.domain.entities.tenant.Tenant","title":"<code>Tenant</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Tenant entity (aggregate root for multi-tenancy).</p> <p>Represents an organization or department (multi-tenancy boundary).</p> <p>Attributes:</p> Name Type Description <code>id</code> <code>str</code> <p>Unique identifier.</p> <code>name</code> <code>str</code> <p>Organization name (e.g., \"Department of Example\").</p> <code>slug</code> <code>str</code> <p>URL-safe identifier (e.g., \"dept-of-example\").</p> <code>status</code> <code>TenantStatus</code> <p>Tenant status (active, suspended, archived).</p> <code>quotas</code> <code>TenantQuotas</code> <p>Resource limits.</p> <code>created_at</code> <code>datetime</code> <p>Creation timestamp.</p> <code>updated_at</code> <code>datetime</code> <p>Last update timestamp.</p> <code>created_by</code> <code>str</code> <p>User ID (admin who created tenant).</p> Source code in <code>src\\eva_core\\domain\\entities\\tenant.py</code> <pre><code>class Tenant(BaseModel):\n    \"\"\"Tenant entity (aggregate root for multi-tenancy).\n\n    Represents an organization or department (multi-tenancy boundary).\n\n    Attributes:\n        id: Unique identifier.\n        name: Organization name (e.g., \"Department of Example\").\n        slug: URL-safe identifier (e.g., \"dept-of-example\").\n        status: Tenant status (active, suspended, archived).\n        quotas: Resource limits.\n        created_at: Creation timestamp.\n        updated_at: Last update timestamp.\n        created_by: User ID (admin who created tenant).\n    \"\"\"\n\n    # Identity\n    id: str = Field(default_factory=lambda: str(uuid.uuid4()))\n\n    # Profile\n    name: str = Field(min_length=1, max_length=200)\n    slug: str = Field(pattern=r\"^[a-z0-9-]+$\")  # URL-safe identifier\n    status: TenantStatus = TenantStatus.ACTIVE\n\n    # Configuration\n    quotas: TenantQuotas = Field(default_factory=TenantQuotas)\n\n    # Metadata\n    created_at: datetime = Field(default_factory=datetime.utcnow)\n    updated_at: datetime = Field(default_factory=datetime.utcnow)\n\n    # Audit\n    created_by: str  # User ID (admin who created tenant)\n\n    def is_quota_exceeded(self, resource: str, current_count: int) -&gt; bool:\n        \"\"\"Check if resource quota is exceeded.\n\n        Args:\n            resource: Resource name (users, spaces, documents_per_space,\n                storage_gb, queries_per_month).\n            current_count: Current count of the resource.\n\n        Returns:\n            True if quota is exceeded, False otherwise.\n\n        Example:\n            &gt;&gt;&gt; tenant = Tenant(name=\"Dept\", slug=\"dept\", created_by=\"admin\")\n            &gt;&gt;&gt; tenant.is_quota_exceeded(\"users\", 150)\n            True\n            &gt;&gt;&gt; tenant.is_quota_exceeded(\"users\", 50)\n            False\n        \"\"\"\n        quotas_dict = self.quotas.model_dump()\n        max_allowed = int(quotas_dict.get(f\"max_{resource}\", float(\"inf\")))\n        return bool(current_count &gt;= max_allowed)\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.tenant.Tenant-functions","title":"Functions","text":""},{"location":"api/entities/#eva_core.domain.entities.tenant.Tenant.is_quota_exceeded","title":"<code>is_quota_exceeded(resource, current_count)</code>","text":"<p>Check if resource quota is exceeded.</p> <p>Parameters:</p> Name Type Description Default <code>resource</code> <code>str</code> <p>Resource name (users, spaces, documents_per_space, storage_gb, queries_per_month).</p> required <code>current_count</code> <code>int</code> <p>Current count of the resource.</p> required <p>Returns:</p> Type Description <code>bool</code> <p>True if quota is exceeded, False otherwise.</p> Example <p>tenant = Tenant(name=\"Dept\", slug=\"dept\", created_by=\"admin\") tenant.is_quota_exceeded(\"users\", 150) True tenant.is_quota_exceeded(\"users\", 50) False</p> Source code in <code>src\\eva_core\\domain\\entities\\tenant.py</code> <pre><code>def is_quota_exceeded(self, resource: str, current_count: int) -&gt; bool:\n    \"\"\"Check if resource quota is exceeded.\n\n    Args:\n        resource: Resource name (users, spaces, documents_per_space,\n            storage_gb, queries_per_month).\n        current_count: Current count of the resource.\n\n    Returns:\n        True if quota is exceeded, False otherwise.\n\n    Example:\n        &gt;&gt;&gt; tenant = Tenant(name=\"Dept\", slug=\"dept\", created_by=\"admin\")\n        &gt;&gt;&gt; tenant.is_quota_exceeded(\"users\", 150)\n        True\n        &gt;&gt;&gt; tenant.is_quota_exceeded(\"users\", 50)\n        False\n    \"\"\"\n    quotas_dict = self.quotas.model_dump()\n    max_allowed = int(quotas_dict.get(f\"max_{resource}\", float(\"inf\")))\n    return bool(current_count &gt;= max_allowed)\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.tenant.TenantStatus","title":"<code>TenantStatus</code>","text":"<p>               Bases: <code>str</code>, <code>Enum</code></p> <p>Tenant status.</p> Source code in <code>src\\eva_core\\domain\\entities\\tenant.py</code> <pre><code>class TenantStatus(str, Enum):\n    \"\"\"Tenant status.\"\"\"\n\n    ACTIVE = \"active\"\n    SUSPENDED = \"suspended\"\n    ARCHIVED = \"archived\"\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.tenant.TenantQuotas","title":"<code>TenantQuotas</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Resource limits per tenant.</p> <p>Attributes:</p> Name Type Description <code>max_users</code> <code>int</code> <p>Maximum number of users.</p> <code>max_spaces</code> <code>int</code> <p>Maximum number of spaces.</p> <code>max_documents_per_space</code> <code>int</code> <p>Maximum documents per space.</p> <code>max_storage_gb</code> <code>int</code> <p>Maximum storage in GB.</p> <code>max_queries_per_month</code> <code>int</code> <p>Maximum queries per month.</p> Source code in <code>src\\eva_core\\domain\\entities\\tenant.py</code> <pre><code>class TenantQuotas(BaseModel):\n    \"\"\"Resource limits per tenant.\n\n    Attributes:\n        max_users: Maximum number of users.\n        max_spaces: Maximum number of spaces.\n        max_documents_per_space: Maximum documents per space.\n        max_storage_gb: Maximum storage in GB.\n        max_queries_per_month: Maximum queries per month.\n    \"\"\"\n\n    max_users: int = 100\n    max_spaces: int = 50\n    max_documents_per_space: int = 10000\n    max_storage_gb: int = 100\n    max_queries_per_month: int = 10000\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.space","title":"<code>eva_core.domain.entities.space</code>","text":"<p>Space entity (aggregate root) - container for documents and conversations.</p> Example <p>from eva_core.domain.entities.space import Space, SpaceVisibility space = Space( ...     tenant_id=\"tenant-123\", ...     name=\"Policy Research\", ...     owner_id=\"user-456\", ...     visibility=SpaceVisibility.PRIVATE ... )</p>"},{"location":"api/entities/#eva_core.domain.entities.space-classes","title":"Classes","text":""},{"location":"api/entities/#eva_core.domain.entities.space.Space","title":"<code>Space</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Space entity (aggregate root for documents + conversations).</p> <p>Container for documents and conversations (like a project workspace).</p> <p>Attributes:</p> Name Type Description <code>id</code> <code>str</code> <p>Unique identifier.</p> <code>tenant_id</code> <code>str</code> <p>Tenant isolation.</p> <code>name</code> <code>str</code> <p>Space name.</p> <code>description</code> <code>str | None</code> <p>Space description (optional).</p> <code>visibility</code> <code>SpaceVisibility</code> <p>Access level (private, shared, public).</p> <code>status</code> <code>SpaceStatus</code> <p>Space status (active, archived).</p> <code>owner_id</code> <code>str</code> <p>Primary owner (user ID).</p> <code>members</code> <code>list[SpaceMember]</code> <p>Space members.</p> <code>document_count</code> <code>int</code> <p>Number of documents.</p> <code>conversation_count</code> <code>int</code> <p>Number of conversations.</p> <code>total_size_bytes</code> <code>int</code> <p>Total size in bytes.</p> <code>created_at</code> <code>datetime</code> <p>Creation timestamp.</p> <code>updated_at</code> <code>datetime</code> <p>Last update timestamp.</p> <code>last_activity_at</code> <code>datetime</code> <p>Last activity timestamp.</p> <code>tags</code> <code>list[str]</code> <p>Space tags.</p> Source code in <code>src\\eva_core\\domain\\entities\\space.py</code> <pre><code>class Space(BaseModel):\n    \"\"\"Space entity (aggregate root for documents + conversations).\n\n    Container for documents and conversations (like a project workspace).\n\n    Attributes:\n        id: Unique identifier.\n        tenant_id: Tenant isolation.\n        name: Space name.\n        description: Space description (optional).\n        visibility: Access level (private, shared, public).\n        status: Space status (active, archived).\n        owner_id: Primary owner (user ID).\n        members: Space members.\n        document_count: Number of documents.\n        conversation_count: Number of conversations.\n        total_size_bytes: Total size in bytes.\n        created_at: Creation timestamp.\n        updated_at: Last update timestamp.\n        last_activity_at: Last activity timestamp.\n        tags: Space tags.\n    \"\"\"\n\n    # Identity\n    id: str = Field(default_factory=lambda: str(uuid.uuid4()))\n    tenant_id: str  # Tenant isolation\n\n    # Profile\n    name: str = Field(min_length=1, max_length=200)\n    description: str | None = Field(None, max_length=2000)\n    visibility: SpaceVisibility = SpaceVisibility.PRIVATE\n    status: SpaceStatus = SpaceStatus.ACTIVE\n\n    # Access Control\n    owner_id: str  # Primary owner (user ID)\n    members: list[SpaceMember] = Field(default_factory=list)\n\n    # Content Metadata\n    document_count: int = 0\n    conversation_count: int = 0\n    total_size_bytes: int = 0\n\n    # Metadata\n    created_at: datetime = Field(default_factory=datetime.utcnow)\n    updated_at: datetime = Field(default_factory=datetime.utcnow)\n    last_activity_at: datetime = Field(default_factory=datetime.utcnow)\n\n    # Configuration\n    tags: list[str] = Field(default_factory=list)\n\n    # Domain Events (not persisted)\n    _events: list[Any] = PrivateAttr(default_factory=list)\n\n    @field_validator(\"members\")\n    @classmethod\n    def validate_members(cls, v: list[SpaceMember]) -&gt; list[SpaceMember]:\n        \"\"\"Ensure no duplicate members.\n\n        Args:\n            v: List of space members.\n\n        Returns:\n            Validated list of members.\n\n        Raises:\n            ValueError: If duplicate members exist.\n        \"\"\"\n        user_ids = [m.user_id for m in v]\n        if len(user_ids) != len(set(user_ids)):\n            raise ValueError(\"Duplicate members not allowed\")\n        return v\n\n    def has_member(self, user_id: str) -&gt; bool:\n        \"\"\"Check if user is a member of this space.\n\n        Args:\n            user_id: User ID to check.\n\n        Returns:\n            True if user is owner or member, False otherwise.\n        \"\"\"\n        return user_id == self.owner_id or any(m.user_id == user_id for m in self.members)\n\n    def get_member_role(self, user_id: str) -&gt; str | None:\n        \"\"\"Get user's role in this space.\n\n        Args:\n            user_id: User ID to check.\n\n        Returns:\n            Role string (owner, contributor, viewer) or None if not a member.\n        \"\"\"\n        if user_id == self.owner_id:\n            return \"owner\"\n        for member in self.members:\n            if member.user_id == user_id:\n                return member.role\n        return None\n\n    def can_add_document(self, user_id: str) -&gt; bool:\n        \"\"\"Check if user can add documents to this space.\n\n        Args:\n            user_id: User ID to check.\n\n        Returns:\n            True if user has owner or contributor role, False otherwise.\n        \"\"\"\n        role = self.get_member_role(user_id)\n        return role in [\"owner\", \"contributor\"]\n\n    def add_document(self, document_id: str, size_bytes: int) -&gt; None:\n        \"\"\"Add document to space (business logic).\n\n        Args:\n            document_id: Document ID being added.\n            size_bytes: Size of document in bytes.\n\n        Side Effects:\n            - Increments document_count\n            - Adds size_bytes to total_size_bytes\n            - Updates last_activity_at and updated_at\n        \"\"\"\n        self.document_count += 1\n        self.total_size_bytes += size_bytes\n        self.last_activity_at = datetime.now(UTC)\n        self.updated_at = datetime.now(UTC)\n\n    def emit_space_created(self) -&gt; None:\n        \"\"\"Emit SpaceCreated event (for event sourcing/integration).\"\"\"\n        from eva_core.domain.events.space_events import SpaceCreated\n\n        event = SpaceCreated(\n            space_id=self.id,\n            aggregate_id=self.id,\n            tenant_id=self.tenant_id,\n            space_name=self.name,\n            owner_id=self.owner_id,\n            visibility=self.visibility.value,\n        )\n        self._events.append(event)\n\n    def emit_document_added(\n        self,\n        document_id: str,\n        document_name: str,\n        document_type: str,\n        size_bytes: int,\n        uploaded_by: str,\n    ) -&gt; None:\n        \"\"\"Emit DocumentAdded event.\"\"\"\n        from eva_core.domain.events.space_events import DocumentAdded\n\n        event = DocumentAdded(\n            space_id=self.id,\n            aggregate_id=self.id,\n            tenant_id=self.tenant_id,\n            document_id=document_id,\n            document_name=document_name,\n            document_type=document_type,\n            size_bytes=size_bytes,\n            uploaded_by=uploaded_by,\n        )\n        self._events.append(event)\n\n    def emit_member_added(self, user_id: str, role: str, added_by: str) -&gt; None:\n        \"\"\"Emit MemberAdded event.\"\"\"\n        from eva_core.domain.events.space_events import MemberAdded\n\n        event = MemberAdded(\n            space_id=self.id,\n            aggregate_id=self.id,\n            tenant_id=self.tenant_id,\n            user_id=user_id,\n            role=role,\n            added_by=added_by,\n        )\n        self._events.append(event)\n\n    def collect_events(self) -&gt; list[Any]:\n        \"\"\"Collect and clear domain events.\"\"\"\n        events = self._events.copy()\n        self._events.clear()\n        return events\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.space.Space-functions","title":"Functions","text":""},{"location":"api/entities/#eva_core.domain.entities.space.Space.validate_members","title":"<code>validate_members(v)</code>  <code>classmethod</code>","text":"<p>Ensure no duplicate members.</p> <p>Parameters:</p> Name Type Description Default <code>v</code> <code>list[SpaceMember]</code> <p>List of space members.</p> required <p>Returns:</p> Type Description <code>list[SpaceMember]</code> <p>Validated list of members.</p> <p>Raises:</p> Type Description <code>ValueError</code> <p>If duplicate members exist.</p> Source code in <code>src\\eva_core\\domain\\entities\\space.py</code> <pre><code>@field_validator(\"members\")\n@classmethod\ndef validate_members(cls, v: list[SpaceMember]) -&gt; list[SpaceMember]:\n    \"\"\"Ensure no duplicate members.\n\n    Args:\n        v: List of space members.\n\n    Returns:\n        Validated list of members.\n\n    Raises:\n        ValueError: If duplicate members exist.\n    \"\"\"\n    user_ids = [m.user_id for m in v]\n    if len(user_ids) != len(set(user_ids)):\n        raise ValueError(\"Duplicate members not allowed\")\n    return v\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.space.Space.has_member","title":"<code>has_member(user_id)</code>","text":"<p>Check if user is a member of this space.</p> <p>Parameters:</p> Name Type Description Default <code>user_id</code> <code>str</code> <p>User ID to check.</p> required <p>Returns:</p> Type Description <code>bool</code> <p>True if user is owner or member, False otherwise.</p> Source code in <code>src\\eva_core\\domain\\entities\\space.py</code> <pre><code>def has_member(self, user_id: str) -&gt; bool:\n    \"\"\"Check if user is a member of this space.\n\n    Args:\n        user_id: User ID to check.\n\n    Returns:\n        True if user is owner or member, False otherwise.\n    \"\"\"\n    return user_id == self.owner_id or any(m.user_id == user_id for m in self.members)\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.space.Space.get_member_role","title":"<code>get_member_role(user_id)</code>","text":"<p>Get user's role in this space.</p> <p>Parameters:</p> Name Type Description Default <code>user_id</code> <code>str</code> <p>User ID to check.</p> required <p>Returns:</p> Type Description <code>str | None</code> <p>Role string (owner, contributor, viewer) or None if not a member.</p> Source code in <code>src\\eva_core\\domain\\entities\\space.py</code> <pre><code>def get_member_role(self, user_id: str) -&gt; str | None:\n    \"\"\"Get user's role in this space.\n\n    Args:\n        user_id: User ID to check.\n\n    Returns:\n        Role string (owner, contributor, viewer) or None if not a member.\n    \"\"\"\n    if user_id == self.owner_id:\n        return \"owner\"\n    for member in self.members:\n        if member.user_id == user_id:\n            return member.role\n    return None\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.space.Space.can_add_document","title":"<code>can_add_document(user_id)</code>","text":"<p>Check if user can add documents to this space.</p> <p>Parameters:</p> Name Type Description Default <code>user_id</code> <code>str</code> <p>User ID to check.</p> required <p>Returns:</p> Type Description <code>bool</code> <p>True if user has owner or contributor role, False otherwise.</p> Source code in <code>src\\eva_core\\domain\\entities\\space.py</code> <pre><code>def can_add_document(self, user_id: str) -&gt; bool:\n    \"\"\"Check if user can add documents to this space.\n\n    Args:\n        user_id: User ID to check.\n\n    Returns:\n        True if user has owner or contributor role, False otherwise.\n    \"\"\"\n    role = self.get_member_role(user_id)\n    return role in [\"owner\", \"contributor\"]\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.space.Space.add_document","title":"<code>add_document(document_id, size_bytes)</code>","text":"<p>Add document to space (business logic).</p> <p>Parameters:</p> Name Type Description Default <code>document_id</code> <code>str</code> <p>Document ID being added.</p> required <code>size_bytes</code> <code>int</code> <p>Size of document in bytes.</p> required Side Effects <ul> <li>Increments document_count</li> <li>Adds size_bytes to total_size_bytes</li> <li>Updates last_activity_at and updated_at</li> </ul> Source code in <code>src\\eva_core\\domain\\entities\\space.py</code> <pre><code>def add_document(self, document_id: str, size_bytes: int) -&gt; None:\n    \"\"\"Add document to space (business logic).\n\n    Args:\n        document_id: Document ID being added.\n        size_bytes: Size of document in bytes.\n\n    Side Effects:\n        - Increments document_count\n        - Adds size_bytes to total_size_bytes\n        - Updates last_activity_at and updated_at\n    \"\"\"\n    self.document_count += 1\n    self.total_size_bytes += size_bytes\n    self.last_activity_at = datetime.now(UTC)\n    self.updated_at = datetime.now(UTC)\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.space.Space.emit_space_created","title":"<code>emit_space_created()</code>","text":"<p>Emit SpaceCreated event (for event sourcing/integration).</p> Source code in <code>src\\eva_core\\domain\\entities\\space.py</code> <pre><code>def emit_space_created(self) -&gt; None:\n    \"\"\"Emit SpaceCreated event (for event sourcing/integration).\"\"\"\n    from eva_core.domain.events.space_events import SpaceCreated\n\n    event = SpaceCreated(\n        space_id=self.id,\n        aggregate_id=self.id,\n        tenant_id=self.tenant_id,\n        space_name=self.name,\n        owner_id=self.owner_id,\n        visibility=self.visibility.value,\n    )\n    self._events.append(event)\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.space.Space.emit_document_added","title":"<code>emit_document_added(document_id, document_name, document_type, size_bytes, uploaded_by)</code>","text":"<p>Emit DocumentAdded event.</p> Source code in <code>src\\eva_core\\domain\\entities\\space.py</code> <pre><code>def emit_document_added(\n    self,\n    document_id: str,\n    document_name: str,\n    document_type: str,\n    size_bytes: int,\n    uploaded_by: str,\n) -&gt; None:\n    \"\"\"Emit DocumentAdded event.\"\"\"\n    from eva_core.domain.events.space_events import DocumentAdded\n\n    event = DocumentAdded(\n        space_id=self.id,\n        aggregate_id=self.id,\n        tenant_id=self.tenant_id,\n        document_id=document_id,\n        document_name=document_name,\n        document_type=document_type,\n        size_bytes=size_bytes,\n        uploaded_by=uploaded_by,\n    )\n    self._events.append(event)\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.space.Space.emit_member_added","title":"<code>emit_member_added(user_id, role, added_by)</code>","text":"<p>Emit MemberAdded event.</p> Source code in <code>src\\eva_core\\domain\\entities\\space.py</code> <pre><code>def emit_member_added(self, user_id: str, role: str, added_by: str) -&gt; None:\n    \"\"\"Emit MemberAdded event.\"\"\"\n    from eva_core.domain.events.space_events import MemberAdded\n\n    event = MemberAdded(\n        space_id=self.id,\n        aggregate_id=self.id,\n        tenant_id=self.tenant_id,\n        user_id=user_id,\n        role=role,\n        added_by=added_by,\n    )\n    self._events.append(event)\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.space.Space.collect_events","title":"<code>collect_events()</code>","text":"<p>Collect and clear domain events.</p> Source code in <code>src\\eva_core\\domain\\entities\\space.py</code> <pre><code>def collect_events(self) -&gt; list[Any]:\n    \"\"\"Collect and clear domain events.\"\"\"\n    events = self._events.copy()\n    self._events.clear()\n    return events\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.space.SpaceMember","title":"<code>SpaceMember</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Member of a space with specific role.</p> <p>Attributes:</p> Name Type Description <code>user_id</code> <code>str</code> <p>User ID.</p> <code>role</code> <code>str</code> <p>Member role (viewer, contributor, owner).</p> <code>added_at</code> <code>datetime</code> <p>Timestamp when member was added.</p> <code>added_by</code> <code>str</code> <p>User ID who added this member.</p> Source code in <code>src\\eva_core\\domain\\entities\\space.py</code> <pre><code>class SpaceMember(BaseModel):\n    \"\"\"Member of a space with specific role.\n\n    Attributes:\n        user_id: User ID.\n        role: Member role (viewer, contributor, owner).\n        added_at: Timestamp when member was added.\n        added_by: User ID who added this member.\n    \"\"\"\n\n    user_id: str\n    role: str = \"viewer\"  # viewer, contributor, owner\n    added_at: datetime = Field(default_factory=datetime.utcnow)\n    added_by: str  # User ID who added this member\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.space.SpaceVisibility","title":"<code>SpaceVisibility</code>","text":"<p>               Bases: <code>str</code>, <code>Enum</code></p> <p>Space visibility level.</p> Source code in <code>src\\eva_core\\domain\\entities\\space.py</code> <pre><code>class SpaceVisibility(str, Enum):\n    \"\"\"Space visibility level.\"\"\"\n\n    PRIVATE = \"private\"  # Only owners can access\n    SHARED = \"shared\"  # Owners + explicit members can access\n    PUBLIC = \"public\"  # All users in tenant can access\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.space.SpaceStatus","title":"<code>SpaceStatus</code>","text":"<p>               Bases: <code>str</code>, <code>Enum</code></p> <p>Space status.</p> Source code in <code>src\\eva_core\\domain\\entities\\space.py</code> <pre><code>class SpaceStatus(str, Enum):\n    \"\"\"Space status.\"\"\"\n\n    ACTIVE = \"active\"\n    ARCHIVED = \"archived\"\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.document","title":"<code>eva_core.domain.entities.document</code>","text":"<p>Document entity - represents a file uploaded to a space.</p> Example <p>from eva_core.domain.entities.document import Document, DocumentType doc = Document( ...     space_id=\"space-123\", ...     tenant_id=\"tenant-456\", ...     filename=\"policy.pdf\", ...     size_bytes=1024000, ...     content_hash=\"abc123...\", ...     blob_url=\"https://storage.example.com/doc1\", ...     document_type=DocumentType.POLICY, ...     uploaded_by=\"user-789\" ... )</p>"},{"location":"api/entities/#eva_core.domain.entities.document-classes","title":"Classes","text":""},{"location":"api/entities/#eva_core.domain.entities.document.Document","title":"<code>Document</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Document entity (owned by a Space).</p> <p>Represents a file uploaded to a space (policy doc, jurisprudence, guide).</p> <p>Attributes:</p> Name Type Description <code>id</code> <code>str</code> <p>Unique identifier.</p> <code>space_id</code> <code>str</code> <p>Parent space ID.</p> <code>tenant_id</code> <code>str</code> <p>Tenant isolation.</p> <code>filename</code> <code>str</code> <p>Original filename.</p> <code>content_type</code> <code>str</code> <p>MIME type.</p> <code>size_bytes</code> <code>int</code> <p>File size in bytes.</p> <code>content_hash</code> <code>str</code> <p>SHA-256 hash (for deduplication).</p> <code>blob_url</code> <code>str</code> <p>Azure Blob Storage URL.</p> <code>document_type</code> <code>DocumentType</code> <p>Document classification.</p> <code>status</code> <code>DocumentStatus</code> <p>Processing status.</p> <code>metadata</code> <code>DocumentMetadata</code> <p>Document metadata.</p> <code>chunk_count</code> <code>int</code> <p>Number of chunks created during indexing.</p> <code>indexed_at</code> <code>datetime | None</code> <p>Indexing completion timestamp (optional).</p> <code>uploaded_by</code> <code>str</code> <p>User ID who uploaded.</p> <code>created_at</code> <code>datetime</code> <p>Creation timestamp.</p> <code>updated_at</code> <code>datetime</code> <p>Last update timestamp.</p> Source code in <code>src\\eva_core\\domain\\entities\\document.py</code> <pre><code>class Document(BaseModel):\n    \"\"\"Document entity (owned by a Space).\n\n    Represents a file uploaded to a space (policy doc, jurisprudence, guide).\n\n    Attributes:\n        id: Unique identifier.\n        space_id: Parent space ID.\n        tenant_id: Tenant isolation.\n        filename: Original filename.\n        content_type: MIME type.\n        size_bytes: File size in bytes.\n        content_hash: SHA-256 hash (for deduplication).\n        blob_url: Azure Blob Storage URL.\n        document_type: Document classification.\n        status: Processing status.\n        metadata: Document metadata.\n        chunk_count: Number of chunks created during indexing.\n        indexed_at: Indexing completion timestamp (optional).\n        uploaded_by: User ID who uploaded.\n        created_at: Creation timestamp.\n        updated_at: Last update timestamp.\n    \"\"\"\n\n    # Identity\n    id: str = Field(default_factory=lambda: str(uuid.uuid4()))\n    space_id: str  # Parent space\n    tenant_id: str  # Tenant isolation\n\n    # Content\n    filename: str = Field(min_length=1, max_length=255)\n    content_type: str = \"application/pdf\"  # MIME type\n    size_bytes: int = Field(gt=0)\n    content_hash: str  # SHA-256 hash (for deduplication)\n\n    # Storage\n    blob_url: str  # Azure Blob Storage URL\n\n    # Classification\n    document_type: DocumentType = DocumentType.OTHER\n    status: DocumentStatus = DocumentStatus.PENDING\n\n    # Metadata\n    metadata: DocumentMetadata = Field(default_factory=DocumentMetadata)\n\n    # Indexing\n    chunk_count: int = 0  # Number of chunks created during indexing\n    indexed_at: datetime | None = None\n\n    # Access\n    uploaded_by: str  # User ID\n    created_at: datetime = Field(default_factory=datetime.utcnow)\n    updated_at: datetime = Field(default_factory=datetime.utcnow)\n\n    @staticmethod\n    def compute_content_hash(content: bytes) -&gt; str:\n        \"\"\"Compute SHA-256 hash of content (for deduplication).\n\n        Args:\n            content: File content as bytes.\n\n        Returns:\n            SHA-256 hash as hex string.\n\n        Example:\n            &gt;&gt;&gt; Document.compute_content_hash(b\"test content\")\n            '6ae8a75555209fd6c44157c0aed8016e763ff435a19cf186f76863140143ff72'\n        \"\"\"\n        return hashlib.sha256(content).hexdigest()\n\n    @field_validator(\"filename\")\n    @classmethod\n    def validate_filename(cls, v: str) -&gt; str:\n        \"\"\"Ensure filename has valid extension.\n\n        Args:\n            v: Filename string.\n\n        Returns:\n            Validated filename.\n\n        Raises:\n            ValueError: If filename extension is not allowed.\n        \"\"\"\n        allowed_extensions = [\".pdf\", \".docx\", \".txt\", \".md\"]\n        if not any(v.lower().endswith(ext) for ext in allowed_extensions):\n            raise ValueError(f\"Invalid file extension. Allowed: {allowed_extensions}\")\n        return v\n\n    def is_duplicate(self, other_hash: str) -&gt; bool:\n        \"\"\"Check if document is duplicate based on content hash.\n\n        Args:\n            other_hash: Content hash to compare against.\n\n        Returns:\n            True if hashes match, False otherwise.\n        \"\"\"\n        return self.content_hash == other_hash\n\n    def mark_as_indexed(self, chunk_count: int) -&gt; None:\n        \"\"\"Mark document as successfully indexed.\n\n        Args:\n            chunk_count: Number of chunks created.\n\n        Side Effects:\n            - Sets status to INDEXED\n            - Sets chunk_count\n            - Sets indexed_at to current time\n            - Updates updated_at\n        \"\"\"\n        self.status = DocumentStatus.INDEXED\n        self.chunk_count = chunk_count\n        self.indexed_at = datetime.now(UTC)\n        self.updated_at = datetime.now(UTC)\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.document.Document-functions","title":"Functions","text":""},{"location":"api/entities/#eva_core.domain.entities.document.Document.compute_content_hash","title":"<code>compute_content_hash(content)</code>  <code>staticmethod</code>","text":"<p>Compute SHA-256 hash of content (for deduplication).</p> <p>Parameters:</p> Name Type Description Default <code>content</code> <code>bytes</code> <p>File content as bytes.</p> required <p>Returns:</p> Type Description <code>str</code> <p>SHA-256 hash as hex string.</p> Example <p>Document.compute_content_hash(b\"test content\") '6ae8a75555209fd6c44157c0aed8016e763ff435a19cf186f76863140143ff72'</p> Source code in <code>src\\eva_core\\domain\\entities\\document.py</code> <pre><code>@staticmethod\ndef compute_content_hash(content: bytes) -&gt; str:\n    \"\"\"Compute SHA-256 hash of content (for deduplication).\n\n    Args:\n        content: File content as bytes.\n\n    Returns:\n        SHA-256 hash as hex string.\n\n    Example:\n        &gt;&gt;&gt; Document.compute_content_hash(b\"test content\")\n        '6ae8a75555209fd6c44157c0aed8016e763ff435a19cf186f76863140143ff72'\n    \"\"\"\n    return hashlib.sha256(content).hexdigest()\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.document.Document.validate_filename","title":"<code>validate_filename(v)</code>  <code>classmethod</code>","text":"<p>Ensure filename has valid extension.</p> <p>Parameters:</p> Name Type Description Default <code>v</code> <code>str</code> <p>Filename string.</p> required <p>Returns:</p> Type Description <code>str</code> <p>Validated filename.</p> <p>Raises:</p> Type Description <code>ValueError</code> <p>If filename extension is not allowed.</p> Source code in <code>src\\eva_core\\domain\\entities\\document.py</code> <pre><code>@field_validator(\"filename\")\n@classmethod\ndef validate_filename(cls, v: str) -&gt; str:\n    \"\"\"Ensure filename has valid extension.\n\n    Args:\n        v: Filename string.\n\n    Returns:\n        Validated filename.\n\n    Raises:\n        ValueError: If filename extension is not allowed.\n    \"\"\"\n    allowed_extensions = [\".pdf\", \".docx\", \".txt\", \".md\"]\n    if not any(v.lower().endswith(ext) for ext in allowed_extensions):\n        raise ValueError(f\"Invalid file extension. Allowed: {allowed_extensions}\")\n    return v\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.document.Document.is_duplicate","title":"<code>is_duplicate(other_hash)</code>","text":"<p>Check if document is duplicate based on content hash.</p> <p>Parameters:</p> Name Type Description Default <code>other_hash</code> <code>str</code> <p>Content hash to compare against.</p> required <p>Returns:</p> Type Description <code>bool</code> <p>True if hashes match, False otherwise.</p> Source code in <code>src\\eva_core\\domain\\entities\\document.py</code> <pre><code>def is_duplicate(self, other_hash: str) -&gt; bool:\n    \"\"\"Check if document is duplicate based on content hash.\n\n    Args:\n        other_hash: Content hash to compare against.\n\n    Returns:\n        True if hashes match, False otherwise.\n    \"\"\"\n    return self.content_hash == other_hash\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.document.Document.mark_as_indexed","title":"<code>mark_as_indexed(chunk_count)</code>","text":"<p>Mark document as successfully indexed.</p> <p>Parameters:</p> Name Type Description Default <code>chunk_count</code> <code>int</code> <p>Number of chunks created.</p> required Side Effects <ul> <li>Sets status to INDEXED</li> <li>Sets chunk_count</li> <li>Sets indexed_at to current time</li> <li>Updates updated_at</li> </ul> Source code in <code>src\\eva_core\\domain\\entities\\document.py</code> <pre><code>def mark_as_indexed(self, chunk_count: int) -&gt; None:\n    \"\"\"Mark document as successfully indexed.\n\n    Args:\n        chunk_count: Number of chunks created.\n\n    Side Effects:\n        - Sets status to INDEXED\n        - Sets chunk_count\n        - Sets indexed_at to current time\n        - Updates updated_at\n    \"\"\"\n    self.status = DocumentStatus.INDEXED\n    self.chunk_count = chunk_count\n    self.indexed_at = datetime.now(UTC)\n    self.updated_at = datetime.now(UTC)\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.document.DocumentStatus","title":"<code>DocumentStatus</code>","text":"<p>               Bases: <code>str</code>, <code>Enum</code></p> <p>Document processing status.</p> Source code in <code>src\\eva_core\\domain\\entities\\document.py</code> <pre><code>class DocumentStatus(str, Enum):\n    \"\"\"Document processing status.\"\"\"\n\n    PENDING = \"pending\"  # Uploaded, not yet indexed\n    PROCESSING = \"processing\"  # Being chunked/embedded\n    INDEXED = \"indexed\"  # Ready for queries\n    FAILED = \"failed\"  # Processing failed\n    DELETED = \"deleted\"  # Soft-deleted\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.document.DocumentType","title":"<code>DocumentType</code>","text":"<p>               Bases: <code>str</code>, <code>Enum</code></p> <p>Document classification type.</p> Source code in <code>src\\eva_core\\domain\\entities\\document.py</code> <pre><code>class DocumentType(str, Enum):\n    \"\"\"Document classification type.\"\"\"\n\n    POLICY = \"policy\"\n    JURISPRUDENCE = \"jurisprudence\"\n    GUIDANCE = \"guidance\"\n    FAQ = \"faq\"\n    OTHER = \"other\"\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.query","title":"<code>eva_core.domain.entities.query</code>","text":"<p>Query entity - user question sent to RAG engine with answer and citations.</p> Example <p>from eva_core.domain.entities.query import Query, Citation query = Query( ...     space_id=\"space-123\", ...     tenant_id=\"tenant-456\", ...     question=\"What is the policy on remote work?\", ...     user_id=\"user-789\" ... )</p>"},{"location":"api/entities/#eva_core.domain.entities.query-classes","title":"Classes","text":""},{"location":"api/entities/#eva_core.domain.entities.query.Query","title":"<code>Query</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Query entity (user question to RAG engine).</p> <p>User question sent to RAG engine (with answer + citations).</p> <p>Attributes:</p> Name Type Description <code>id</code> <code>str</code> <p>Unique identifier.</p> <code>space_id</code> <code>str</code> <p>Space where query was executed.</p> <code>tenant_id</code> <code>str</code> <p>Tenant isolation.</p> <code>conversation_id</code> <code>str | None</code> <p>Optional conversation grouping.</p> <code>question</code> <code>str</code> <p>User question text.</p> <code>language</code> <code>str</code> <p>Question language (en, fr).</p> <code>answer</code> <code>str | None</code> <p>Generated answer (optional).</p> <code>citations</code> <code>list[Citation]</code> <p>Source citations.</p> <code>status</code> <code>QueryStatus</code> <p>Processing status.</p> <code>error_message</code> <code>str | None</code> <p>Error message if failed (optional).</p> <code>processing_time_ms</code> <code>int | None</code> <p>Processing time in milliseconds (optional).</p> <code>tokens_used</code> <code>int | None</code> <p>Number of tokens used (optional).</p> <code>user_id</code> <code>str</code> <p>User who submitted query.</p> <code>created_at</code> <code>datetime</code> <p>Creation timestamp.</p> <code>completed_at</code> <code>datetime | None</code> <p>Completion timestamp (optional).</p> Source code in <code>src\\eva_core\\domain\\entities\\query.py</code> <pre><code>class Query(BaseModel):\n    \"\"\"Query entity (user question to RAG engine).\n\n    User question sent to RAG engine (with answer + citations).\n\n    Attributes:\n        id: Unique identifier.\n        space_id: Space where query was executed.\n        tenant_id: Tenant isolation.\n        conversation_id: Optional conversation grouping.\n        question: User question text.\n        language: Question language (en, fr).\n        answer: Generated answer (optional).\n        citations: Source citations.\n        status: Processing status.\n        error_message: Error message if failed (optional).\n        processing_time_ms: Processing time in milliseconds (optional).\n        tokens_used: Number of tokens used (optional).\n        user_id: User who submitted query.\n        created_at: Creation timestamp.\n        completed_at: Completion timestamp (optional).\n    \"\"\"\n\n    # Identity\n    id: str = Field(default_factory=lambda: str(uuid.uuid4()))\n    space_id: str  # Space where query was executed\n    tenant_id: str  # Tenant isolation\n    conversation_id: str | None = None  # Optional conversation grouping\n\n    # Question\n    question: str = Field(min_length=1, max_length=2000)\n    language: str = \"en\"  # en, fr\n\n    # Answer\n    answer: str | None = None\n    citations: list[Citation] = Field(default_factory=list)\n\n    # Status\n    status: QueryStatus = QueryStatus.PENDING\n    error_message: str | None = None\n\n    # Performance\n    processing_time_ms: int | None = None\n    tokens_used: int | None = None\n\n    # Audit\n    user_id: str  # User who submitted query\n    created_at: datetime = Field(default_factory=datetime.utcnow)\n    completed_at: datetime | None = None\n\n    # Domain Events (not persisted)\n    _events: list[Any] = PrivateAttr(default_factory=list)\n\n    def mark_as_completed(\n        self, answer: str, citations: list[Citation], processing_time_ms: int\n    ) -&gt; None:\n        \"\"\"Mark query as completed (business logic).\n\n        Args:\n            answer: Generated answer text.\n            citations: List of source citations.\n            processing_time_ms: Processing time in milliseconds.\n\n        Side Effects:\n            - Sets answer\n            - Sets citations\n            - Sets status to COMPLETED\n            - Sets processing_time_ms\n            - Sets completed_at to current time\n        \"\"\"\n        self.answer = answer\n        self.citations = citations\n        self.status = QueryStatus.COMPLETED\n        self.processing_time_ms = processing_time_ms\n        self.completed_at = datetime.now(UTC)\n\n    def mark_as_failed(self, error_message: str) -&gt; None:\n        \"\"\"Mark query as failed.\n\n        Args:\n            error_message: Error description.\n\n        Side Effects:\n            - Sets status to FAILED\n            - Sets error_message\n            - Sets completed_at to current time\n        \"\"\"\n        self.status = QueryStatus.FAILED\n        self.error_message = error_message\n        self.completed_at = datetime.now(UTC)\n\n    def emit_query_executed(self) -&gt; None:\n        \"\"\"Emit QueryExecuted event.\"\"\"\n        from eva_core.domain.events.query_events import QueryExecuted\n\n        event = QueryExecuted(\n            query_id=self.id,\n            aggregate_id=self.id,\n            tenant_id=self.tenant_id,\n            space_id=self.space_id,\n            question=self.question,\n            user_id=self.user_id,\n        )\n        self._events.append(event)\n\n    def emit_query_completed(self) -&gt; None:\n        \"\"\"Emit QueryCompleted event.\"\"\"\n        from eva_core.domain.events.query_events import QueryCompleted\n\n        if self.status != QueryStatus.COMPLETED or not self.answer:\n            raise ValueError(\"Cannot emit QueryCompleted: query not completed\")\n\n        event = QueryCompleted(\n            query_id=self.id,\n            aggregate_id=self.id,\n            tenant_id=self.tenant_id,\n            answer_length=len(self.answer),\n            citation_count=len(self.citations),\n            processing_time_ms=self.processing_time_ms or 0,\n            tokens_used=self.tokens_used or 0,\n        )\n        self._events.append(event)\n\n    def emit_query_failed(self) -&gt; None:\n        \"\"\"Emit QueryFailed event.\"\"\"\n        from eva_core.domain.events.query_events import QueryFailed\n\n        if self.status != QueryStatus.FAILED or not self.error_message:\n            raise ValueError(\"Cannot emit QueryFailed: query not in failed state\")\n\n        event = QueryFailed(\n            query_id=self.id,\n            aggregate_id=self.id,\n            tenant_id=self.tenant_id,\n            error_type=\"processing_error\",\n            error_message=self.error_message,\n        )\n        self._events.append(event)\n\n    def collect_events(self) -&gt; list[Any]:\n        \"\"\"Collect and clear domain events.\"\"\"\n        events = self._events.copy()\n        self._events.clear()\n        return events\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.query.Query-functions","title":"Functions","text":""},{"location":"api/entities/#eva_core.domain.entities.query.Query.mark_as_completed","title":"<code>mark_as_completed(answer, citations, processing_time_ms)</code>","text":"<p>Mark query as completed (business logic).</p> <p>Parameters:</p> Name Type Description Default <code>answer</code> <code>str</code> <p>Generated answer text.</p> required <code>citations</code> <code>list[Citation]</code> <p>List of source citations.</p> required <code>processing_time_ms</code> <code>int</code> <p>Processing time in milliseconds.</p> required Side Effects <ul> <li>Sets answer</li> <li>Sets citations</li> <li>Sets status to COMPLETED</li> <li>Sets processing_time_ms</li> <li>Sets completed_at to current time</li> </ul> Source code in <code>src\\eva_core\\domain\\entities\\query.py</code> <pre><code>def mark_as_completed(\n    self, answer: str, citations: list[Citation], processing_time_ms: int\n) -&gt; None:\n    \"\"\"Mark query as completed (business logic).\n\n    Args:\n        answer: Generated answer text.\n        citations: List of source citations.\n        processing_time_ms: Processing time in milliseconds.\n\n    Side Effects:\n        - Sets answer\n        - Sets citations\n        - Sets status to COMPLETED\n        - Sets processing_time_ms\n        - Sets completed_at to current time\n    \"\"\"\n    self.answer = answer\n    self.citations = citations\n    self.status = QueryStatus.COMPLETED\n    self.processing_time_ms = processing_time_ms\n    self.completed_at = datetime.now(UTC)\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.query.Query.mark_as_failed","title":"<code>mark_as_failed(error_message)</code>","text":"<p>Mark query as failed.</p> <p>Parameters:</p> Name Type Description Default <code>error_message</code> <code>str</code> <p>Error description.</p> required Side Effects <ul> <li>Sets status to FAILED</li> <li>Sets error_message</li> <li>Sets completed_at to current time</li> </ul> Source code in <code>src\\eva_core\\domain\\entities\\query.py</code> <pre><code>def mark_as_failed(self, error_message: str) -&gt; None:\n    \"\"\"Mark query as failed.\n\n    Args:\n        error_message: Error description.\n\n    Side Effects:\n        - Sets status to FAILED\n        - Sets error_message\n        - Sets completed_at to current time\n    \"\"\"\n    self.status = QueryStatus.FAILED\n    self.error_message = error_message\n    self.completed_at = datetime.now(UTC)\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.query.Query.emit_query_executed","title":"<code>emit_query_executed()</code>","text":"<p>Emit QueryExecuted event.</p> Source code in <code>src\\eva_core\\domain\\entities\\query.py</code> <pre><code>def emit_query_executed(self) -&gt; None:\n    \"\"\"Emit QueryExecuted event.\"\"\"\n    from eva_core.domain.events.query_events import QueryExecuted\n\n    event = QueryExecuted(\n        query_id=self.id,\n        aggregate_id=self.id,\n        tenant_id=self.tenant_id,\n        space_id=self.space_id,\n        question=self.question,\n        user_id=self.user_id,\n    )\n    self._events.append(event)\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.query.Query.emit_query_completed","title":"<code>emit_query_completed()</code>","text":"<p>Emit QueryCompleted event.</p> Source code in <code>src\\eva_core\\domain\\entities\\query.py</code> <pre><code>def emit_query_completed(self) -&gt; None:\n    \"\"\"Emit QueryCompleted event.\"\"\"\n    from eva_core.domain.events.query_events import QueryCompleted\n\n    if self.status != QueryStatus.COMPLETED or not self.answer:\n        raise ValueError(\"Cannot emit QueryCompleted: query not completed\")\n\n    event = QueryCompleted(\n        query_id=self.id,\n        aggregate_id=self.id,\n        tenant_id=self.tenant_id,\n        answer_length=len(self.answer),\n        citation_count=len(self.citations),\n        processing_time_ms=self.processing_time_ms or 0,\n        tokens_used=self.tokens_used or 0,\n    )\n    self._events.append(event)\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.query.Query.emit_query_failed","title":"<code>emit_query_failed()</code>","text":"<p>Emit QueryFailed event.</p> Source code in <code>src\\eva_core\\domain\\entities\\query.py</code> <pre><code>def emit_query_failed(self) -&gt; None:\n    \"\"\"Emit QueryFailed event.\"\"\"\n    from eva_core.domain.events.query_events import QueryFailed\n\n    if self.status != QueryStatus.FAILED or not self.error_message:\n        raise ValueError(\"Cannot emit QueryFailed: query not in failed state\")\n\n    event = QueryFailed(\n        query_id=self.id,\n        aggregate_id=self.id,\n        tenant_id=self.tenant_id,\n        error_type=\"processing_error\",\n        error_message=self.error_message,\n    )\n    self._events.append(event)\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.query.Query.collect_events","title":"<code>collect_events()</code>","text":"<p>Collect and clear domain events.</p> Source code in <code>src\\eva_core\\domain\\entities\\query.py</code> <pre><code>def collect_events(self) -&gt; list[Any]:\n    \"\"\"Collect and clear domain events.\"\"\"\n    events = self._events.copy()\n    self._events.clear()\n    return events\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.query.Citation","title":"<code>Citation</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Citation linking answer to source document.</p> <p>Attributes:</p> Name Type Description <code>document_id</code> <code>str</code> <p>Source document ID.</p> <code>chunk_id</code> <code>str</code> <p>Source chunk ID.</p> <code>document_name</code> <code>str</code> <p>Source document name.</p> <code>page_number</code> <code>int | None</code> <p>Page number (optional).</p> <code>relevance_score</code> <code>float</code> <p>Relevance score (0.0-1.0).</p> <code>excerpt</code> <code>str</code> <p>Text snippet from source.</p> Source code in <code>src\\eva_core\\domain\\entities\\query.py</code> <pre><code>class Citation(BaseModel):\n    \"\"\"Citation linking answer to source document.\n\n    Attributes:\n        document_id: Source document ID.\n        chunk_id: Source chunk ID.\n        document_name: Source document name.\n        page_number: Page number (optional).\n        relevance_score: Relevance score (0.0-1.0).\n        excerpt: Text snippet from source.\n    \"\"\"\n\n    document_id: str\n    chunk_id: str\n    document_name: str\n    page_number: int | None = None\n    relevance_score: float = Field(ge=0.0, le=1.0)\n    excerpt: str = Field(max_length=500)  # Text snippet\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.query.QueryStatus","title":"<code>QueryStatus</code>","text":"<p>               Bases: <code>str</code>, <code>Enum</code></p> <p>Query processing status.</p> Source code in <code>src\\eva_core\\domain\\entities\\query.py</code> <pre><code>class QueryStatus(str, Enum):\n    \"\"\"Query processing status.\"\"\"\n\n    PENDING = \"pending\"  # Submitted, not yet processed\n    PROCESSING = \"processing\"  # RAG engine working\n    COMPLETED = \"completed\"  # Answer generated\n    FAILED = \"failed\"  # Error occurred\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.conversation","title":"<code>eva_core.domain.entities.conversation</code>","text":"<p>Conversation entity - groups related queries into a conversation thread.</p> Example <p>from eva_core.domain.entities.conversation import Conversation conv = Conversation( ...     space_id=\"space-123\", ...     tenant_id=\"tenant-456\", ...     title=\"Remote Work Policy Discussion\", ...     user_id=\"user-789\" ... )</p>"},{"location":"api/entities/#eva_core.domain.entities.conversation-classes","title":"Classes","text":""},{"location":"api/entities/#eva_core.domain.entities.conversation.Conversation","title":"<code>Conversation</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Conversation entity (grouping of queries).</p> <p>Groups related queries into a conversation thread.</p> <p>Attributes:</p> Name Type Description <code>id</code> <code>str</code> <p>Unique identifier.</p> <code>space_id</code> <code>str</code> <p>Parent space ID.</p> <code>tenant_id</code> <code>str</code> <p>Tenant isolation.</p> <code>title</code> <code>str</code> <p>Conversation title.</p> <code>description</code> <code>str | None</code> <p>Conversation description (optional).</p> <code>status</code> <code>ConversationStatus</code> <p>Conversation status (active, archived).</p> <code>query_count</code> <code>int</code> <p>Number of queries in conversation.</p> <code>last_query_at</code> <code>datetime | None</code> <p>Last query timestamp (optional).</p> <code>user_id</code> <code>str</code> <p>Owner user ID.</p> <code>created_at</code> <code>datetime</code> <p>Creation timestamp.</p> <code>updated_at</code> <code>datetime</code> <p>Last update timestamp.</p> Source code in <code>src\\eva_core\\domain\\entities\\conversation.py</code> <pre><code>class Conversation(BaseModel):\n    \"\"\"Conversation entity (grouping of queries).\n\n    Groups related queries into a conversation thread.\n\n    Attributes:\n        id: Unique identifier.\n        space_id: Parent space ID.\n        tenant_id: Tenant isolation.\n        title: Conversation title.\n        description: Conversation description (optional).\n        status: Conversation status (active, archived).\n        query_count: Number of queries in conversation.\n        last_query_at: Last query timestamp (optional).\n        user_id: Owner user ID.\n        created_at: Creation timestamp.\n        updated_at: Last update timestamp.\n    \"\"\"\n\n    # Identity\n    id: str = Field(default_factory=lambda: str(uuid.uuid4()))\n    space_id: str\n    tenant_id: str\n\n    # Content\n    title: str = Field(min_length=1, max_length=200)\n    description: str | None = Field(None, max_length=1000)\n    status: ConversationStatus = ConversationStatus.ACTIVE\n\n    # Queries\n    query_count: int = 0\n    last_query_at: datetime | None = None\n\n    # Audit\n    user_id: str  # Owner\n    created_at: datetime = Field(default_factory=datetime.utcnow)\n    updated_at: datetime = Field(default_factory=datetime.utcnow)\n\n    def add_query(self, query_id: str) -&gt; None:\n        \"\"\"Add query to conversation.\n\n        Args:\n            query_id: Query ID being added.\n\n        Side Effects:\n            - Increments query_count\n            - Sets last_query_at to current time\n            - Updates updated_at\n        \"\"\"\n        self.query_count += 1\n        self.last_query_at = datetime.now(UTC)\n        self.updated_at = datetime.now(UTC)\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.conversation.Conversation-functions","title":"Functions","text":""},{"location":"api/entities/#eva_core.domain.entities.conversation.Conversation.add_query","title":"<code>add_query(query_id)</code>","text":"<p>Add query to conversation.</p> <p>Parameters:</p> Name Type Description Default <code>query_id</code> <code>str</code> <p>Query ID being added.</p> required Side Effects <ul> <li>Increments query_count</li> <li>Sets last_query_at to current time</li> <li>Updates updated_at</li> </ul> Source code in <code>src\\eva_core\\domain\\entities\\conversation.py</code> <pre><code>def add_query(self, query_id: str) -&gt; None:\n    \"\"\"Add query to conversation.\n\n    Args:\n        query_id: Query ID being added.\n\n    Side Effects:\n        - Increments query_count\n        - Sets last_query_at to current time\n        - Updates updated_at\n    \"\"\"\n    self.query_count += 1\n    self.last_query_at = datetime.now(UTC)\n    self.updated_at = datetime.now(UTC)\n</code></pre>"},{"location":"api/entities/#eva_core.domain.entities.conversation.ConversationStatus","title":"<code>ConversationStatus</code>","text":"<p>               Bases: <code>str</code>, <code>Enum</code></p> <p>Conversation status.</p> Source code in <code>src\\eva_core\\domain\\entities\\conversation.py</code> <pre><code>class ConversationStatus(str, Enum):\n    \"\"\"Conversation status.\"\"\"\n\n    ACTIVE = \"active\"\n    ARCHIVED = \"archived\"\n</code></pre>"},{"location":"api/events/","title":"API Reference: Events","text":""},{"location":"api/events/#eva_core.domain.events.base","title":"<code>eva_core.domain.events.base</code>","text":"<p>Base domain event class.</p> <p>All domain events in EVA Core inherit from DomainEvent. Events are immutable and represent something that has already happened.</p>"},{"location":"api/events/#eva_core.domain.events.base-classes","title":"Classes","text":""},{"location":"api/events/#eva_core.domain.events.base.DomainEvent","title":"<code>DomainEvent</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Base class for all domain events.</p> <p>Domain events represent business-significant occurrences in the system. They are immutable, auditable, and can be used for event sourcing, integration with other systems, or triggering side effects.</p> <p>Attributes:</p> Name Type Description <code>event_id</code> <code>str</code> <p>Unique identifier for this event occurrence.</p> <code>event_type</code> <code>str</code> <p>Type of event (e.g., \"SpaceCreated\", \"QueryExecuted\").</p> <code>aggregate_id</code> <code>str</code> <p>ID of the aggregate root that generated this event.</p> <code>tenant_id</code> <code>str</code> <p>Tenant isolation boundary (all events belong to a tenant).</p> <code>timestamp</code> <code>datetime</code> <p>When the event occurred (UTC).</p> <code>metadata</code> <code>dict[str, Any]</code> <p>Additional contextual information (user_id, IP, etc.).</p> Example <p>event = DomainEvent( ...     event_type=\"UserRegistered\", ...     aggregate_id=\"user-123\", ...     tenant_id=\"tenant-456\" ... )</p> Source code in <code>src\\eva_core\\domain\\events\\base.py</code> <pre><code>class DomainEvent(BaseModel):\n    \"\"\"Base class for all domain events.\n\n    Domain events represent business-significant occurrences in the system.\n    They are immutable, auditable, and can be used for event sourcing,\n    integration with other systems, or triggering side effects.\n\n    Attributes:\n        event_id: Unique identifier for this event occurrence.\n        event_type: Type of event (e.g., \"SpaceCreated\", \"QueryExecuted\").\n        aggregate_id: ID of the aggregate root that generated this event.\n        tenant_id: Tenant isolation boundary (all events belong to a tenant).\n        timestamp: When the event occurred (UTC).\n        metadata: Additional contextual information (user_id, IP, etc.).\n\n    Example:\n        &gt;&gt;&gt; event = DomainEvent(\n        ...     event_type=\"UserRegistered\",\n        ...     aggregate_id=\"user-123\",\n        ...     tenant_id=\"tenant-456\"\n        ... )\n    \"\"\"\n\n    # Event Identity\n    event_id: str = Field(default_factory=lambda: str(uuid.uuid4()))\n    event_type: str = Field(min_length=1, max_length=100)\n\n    # Aggregate Root\n    aggregate_id: str = Field(min_length=1)\n\n    # Tenant Isolation\n    tenant_id: str = Field(min_length=1)\n\n    # Timestamp\n    timestamp: datetime = Field(default_factory=lambda: datetime.now(UTC))\n\n    # Context\n    metadata: dict[str, Any] = Field(default_factory=dict)\n\n    class Config:\n        \"\"\"Pydantic config.\"\"\"\n\n        frozen = True  # Events are immutable\n        str_strip_whitespace = True\n</code></pre>"},{"location":"api/events/#eva_core.domain.events.base.DomainEvent-classes","title":"Classes","text":""},{"location":"api/events/#eva_core.domain.events.base.DomainEvent.Config","title":"<code>Config</code>","text":"<p>Pydantic config.</p> Source code in <code>src\\eva_core\\domain\\events\\base.py</code> <pre><code>class Config:\n    \"\"\"Pydantic config.\"\"\"\n\n    frozen = True  # Events are immutable\n    str_strip_whitespace = True\n</code></pre>"},{"location":"api/events/#eva_core.domain.events.space_events","title":"<code>eva_core.domain.events.space_events</code>","text":"<p>Space-related domain events.</p> <p>Events related to space lifecycle and operations.</p>"},{"location":"api/events/#eva_core.domain.events.space_events-classes","title":"Classes","text":""},{"location":"api/events/#eva_core.domain.events.space_events.SpaceCreated","title":"<code>SpaceCreated</code>","text":"<p>               Bases: <code>DomainEvent</code></p> <p>Event emitted when a new space is created.</p> <p>Attributes:</p> Name Type Description <code>space_id</code> <code>str</code> <p>ID of the newly created space.</p> <code>space_name</code> <code>str</code> <p>Name of the space.</p> <code>owner_id</code> <code>str</code> <p>User who created the space.</p> <code>visibility</code> <code>str</code> <p>Space visibility setting.</p> Example <p>event = SpaceCreated( ...     space_id=\"space-123\", ...     aggregate_id=\"space-123\", ...     tenant_id=\"tenant-456\", ...     space_name=\"Policy Research\", ...     owner_id=\"user-789\", ...     visibility=\"private\" ... )</p> Source code in <code>src\\eva_core\\domain\\events\\space_events.py</code> <pre><code>class SpaceCreated(DomainEvent):\n    \"\"\"Event emitted when a new space is created.\n\n    Attributes:\n        space_id: ID of the newly created space.\n        space_name: Name of the space.\n        owner_id: User who created the space.\n        visibility: Space visibility setting.\n\n    Example:\n        &gt;&gt;&gt; event = SpaceCreated(\n        ...     space_id=\"space-123\",\n        ...     aggregate_id=\"space-123\",\n        ...     tenant_id=\"tenant-456\",\n        ...     space_name=\"Policy Research\",\n        ...     owner_id=\"user-789\",\n        ...     visibility=\"private\"\n        ... )\n    \"\"\"\n\n    event_type: str = Field(default=\"SpaceCreated\", frozen=True)\n    space_id: str = Field(min_length=1)\n    space_name: str = Field(min_length=1, max_length=200)\n    owner_id: str = Field(min_length=1)\n    visibility: str = Field(min_length=1)\n</code></pre>"},{"location":"api/events/#eva_core.domain.events.space_events.DocumentAdded","title":"<code>DocumentAdded</code>","text":"<p>               Bases: <code>DomainEvent</code></p> <p>Event emitted when a document is added to a space.</p> <p>Attributes:</p> Name Type Description <code>space_id</code> <code>str</code> <p>ID of the space.</p> <code>document_id</code> <code>str</code> <p>ID of the document.</p> <code>document_name</code> <code>str</code> <p>Name of the document.</p> <code>document_type</code> <code>str</code> <p>Type of document (policy, report, etc.).</p> <code>size_bytes</code> <code>int</code> <p>Document size in bytes.</p> <code>uploaded_by</code> <code>str</code> <p>User who uploaded the document.</p> Example <p>event = DocumentAdded( ...     space_id=\"space-123\", ...     aggregate_id=\"space-123\", ...     tenant_id=\"tenant-456\", ...     document_id=\"doc-abc\", ...     document_name=\"policy.pdf\", ...     document_type=\"policy\", ...     size_bytes=1024000, ...     uploaded_by=\"user-789\" ... )</p> Source code in <code>src\\eva_core\\domain\\events\\space_events.py</code> <pre><code>class DocumentAdded(DomainEvent):\n    \"\"\"Event emitted when a document is added to a space.\n\n    Attributes:\n        space_id: ID of the space.\n        document_id: ID of the document.\n        document_name: Name of the document.\n        document_type: Type of document (policy, report, etc.).\n        size_bytes: Document size in bytes.\n        uploaded_by: User who uploaded the document.\n\n    Example:\n        &gt;&gt;&gt; event = DocumentAdded(\n        ...     space_id=\"space-123\",\n        ...     aggregate_id=\"space-123\",\n        ...     tenant_id=\"tenant-456\",\n        ...     document_id=\"doc-abc\",\n        ...     document_name=\"policy.pdf\",\n        ...     document_type=\"policy\",\n        ...     size_bytes=1024000,\n        ...     uploaded_by=\"user-789\"\n        ... )\n    \"\"\"\n\n    event_type: str = Field(default=\"DocumentAdded\", frozen=True)\n    space_id: str = Field(min_length=1)\n    document_id: str = Field(min_length=1)\n    document_name: str = Field(min_length=1, max_length=255)\n    document_type: str = Field(min_length=1)\n    size_bytes: int = Field(gt=0)\n    uploaded_by: str = Field(min_length=1)\n</code></pre>"},{"location":"api/events/#eva_core.domain.events.space_events.MemberAdded","title":"<code>MemberAdded</code>","text":"<p>               Bases: <code>DomainEvent</code></p> <p>Event emitted when a member is added to a space.</p> <p>Attributes:</p> Name Type Description <code>space_id</code> <code>str</code> <p>ID of the space.</p> <code>user_id</code> <code>str</code> <p>User being added as member.</p> <code>role</code> <code>str</code> <p>Role assigned to the member.</p> <code>added_by</code> <code>str</code> <p>User who added this member.</p> Example <p>event = MemberAdded( ...     space_id=\"space-123\", ...     aggregate_id=\"space-123\", ...     tenant_id=\"tenant-456\", ...     user_id=\"user-999\", ...     role=\"viewer\", ...     added_by=\"user-789\" ... )</p> Source code in <code>src\\eva_core\\domain\\events\\space_events.py</code> <pre><code>class MemberAdded(DomainEvent):\n    \"\"\"Event emitted when a member is added to a space.\n\n    Attributes:\n        space_id: ID of the space.\n        user_id: User being added as member.\n        role: Role assigned to the member.\n        added_by: User who added this member.\n\n    Example:\n        &gt;&gt;&gt; event = MemberAdded(\n        ...     space_id=\"space-123\",\n        ...     aggregate_id=\"space-123\",\n        ...     tenant_id=\"tenant-456\",\n        ...     user_id=\"user-999\",\n        ...     role=\"viewer\",\n        ...     added_by=\"user-789\"\n        ... )\n    \"\"\"\n\n    event_type: str = Field(default=\"MemberAdded\", frozen=True)\n    space_id: str = Field(min_length=1)\n    user_id: str = Field(min_length=1)\n    role: str = Field(min_length=1)\n    added_by: str = Field(min_length=1)\n</code></pre>"},{"location":"api/events/#eva_core.domain.events.query_events","title":"<code>eva_core.domain.events.query_events</code>","text":"<p>Query-related domain events.</p> <p>Events related to query lifecycle and processing.</p>"},{"location":"api/events/#eva_core.domain.events.query_events-classes","title":"Classes","text":""},{"location":"api/events/#eva_core.domain.events.query_events.QueryExecuted","title":"<code>QueryExecuted</code>","text":"<p>               Bases: <code>DomainEvent</code></p> <p>Event emitted when a query is executed (submitted to RAG engine).</p> <p>Attributes:</p> Name Type Description <code>query_id</code> <code>str</code> <p>ID of the query.</p> <code>space_id</code> <code>str</code> <p>Space where query was executed.</p> <code>question</code> <code>str</code> <p>The question asked.</p> <code>user_id</code> <code>str</code> <p>User who submitted the query.</p> Example <p>event = QueryExecuted( ...     query_id=\"query-123\", ...     aggregate_id=\"query-123\", ...     tenant_id=\"tenant-456\", ...     space_id=\"space-789\", ...     question=\"What is the remote work policy?\", ...     user_id=\"user-999\" ... )</p> Source code in <code>src\\eva_core\\domain\\events\\query_events.py</code> <pre><code>class QueryExecuted(DomainEvent):\n    \"\"\"Event emitted when a query is executed (submitted to RAG engine).\n\n    Attributes:\n        query_id: ID of the query.\n        space_id: Space where query was executed.\n        question: The question asked.\n        user_id: User who submitted the query.\n\n    Example:\n        &gt;&gt;&gt; event = QueryExecuted(\n        ...     query_id=\"query-123\",\n        ...     aggregate_id=\"query-123\",\n        ...     tenant_id=\"tenant-456\",\n        ...     space_id=\"space-789\",\n        ...     question=\"What is the remote work policy?\",\n        ...     user_id=\"user-999\"\n        ... )\n    \"\"\"\n\n    event_type: str = Field(default=\"QueryExecuted\", frozen=True)\n    query_id: str = Field(min_length=1)\n    space_id: str = Field(min_length=1)\n    question: str = Field(min_length=1, max_length=1000)\n    user_id: str = Field(min_length=1)\n</code></pre>"},{"location":"api/events/#eva_core.domain.events.query_events.QueryCompleted","title":"<code>QueryCompleted</code>","text":"<p>               Bases: <code>DomainEvent</code></p> <p>Event emitted when a query processing completes successfully.</p> <p>Attributes:</p> Name Type Description <code>query_id</code> <code>str</code> <p>ID of the query.</p> <code>answer_length</code> <code>int</code> <p>Length of the generated answer.</p> <code>citation_count</code> <code>int</code> <p>Number of citations.</p> <code>processing_time_ms</code> <code>int</code> <p>Time taken to process (milliseconds).</p> <code>tokens_used</code> <code>int</code> <p>Number of tokens consumed.</p> Example <p>event = QueryCompleted( ...     query_id=\"query-123\", ...     aggregate_id=\"query-123\", ...     tenant_id=\"tenant-456\", ...     answer_length=500, ...     citation_count=3, ...     processing_time_ms=2500, ...     tokens_used=1500 ... )</p> Source code in <code>src\\eva_core\\domain\\events\\query_events.py</code> <pre><code>class QueryCompleted(DomainEvent):\n    \"\"\"Event emitted when a query processing completes successfully.\n\n    Attributes:\n        query_id: ID of the query.\n        answer_length: Length of the generated answer.\n        citation_count: Number of citations.\n        processing_time_ms: Time taken to process (milliseconds).\n        tokens_used: Number of tokens consumed.\n\n    Example:\n        &gt;&gt;&gt; event = QueryCompleted(\n        ...     query_id=\"query-123\",\n        ...     aggregate_id=\"query-123\",\n        ...     tenant_id=\"tenant-456\",\n        ...     answer_length=500,\n        ...     citation_count=3,\n        ...     processing_time_ms=2500,\n        ...     tokens_used=1500\n        ... )\n    \"\"\"\n\n    event_type: str = Field(default=\"QueryCompleted\", frozen=True)\n    query_id: str = Field(min_length=1)\n    answer_length: int = Field(ge=0)\n    citation_count: int = Field(ge=0)\n    processing_time_ms: int = Field(gt=0)\n    tokens_used: int = Field(ge=0)\n</code></pre>"},{"location":"api/events/#eva_core.domain.events.query_events.QueryFailed","title":"<code>QueryFailed</code>","text":"<p>               Bases: <code>DomainEvent</code></p> <p>Event emitted when query processing fails.</p> <p>Attributes:</p> Name Type Description <code>query_id</code> <code>str</code> <p>ID of the query.</p> <code>error_type</code> <code>str</code> <p>Classification of error (e.g., \"timeout\", \"llm_error\").</p> <code>error_message</code> <code>str</code> <p>Human-readable error message.</p> Example <p>event = QueryFailed( ...     query_id=\"query-123\", ...     aggregate_id=\"query-123\", ...     tenant_id=\"tenant-456\", ...     error_type=\"timeout\", ...     error_message=\"RAG engine timeout after 30s\" ... )</p> Source code in <code>src\\eva_core\\domain\\events\\query_events.py</code> <pre><code>class QueryFailed(DomainEvent):\n    \"\"\"Event emitted when query processing fails.\n\n    Attributes:\n        query_id: ID of the query.\n        error_type: Classification of error (e.g., \"timeout\", \"llm_error\").\n        error_message: Human-readable error message.\n\n    Example:\n        &gt;&gt;&gt; event = QueryFailed(\n        ...     query_id=\"query-123\",\n        ...     aggregate_id=\"query-123\",\n        ...     tenant_id=\"tenant-456\",\n        ...     error_type=\"timeout\",\n        ...     error_message=\"RAG engine timeout after 30s\"\n        ... )\n    \"\"\"\n\n    event_type: str = Field(default=\"QueryFailed\", frozen=True)\n    query_id: str = Field(min_length=1)\n    error_type: str = Field(min_length=1, max_length=50)\n    error_message: str = Field(min_length=1, max_length=500)\n</code></pre>"},{"location":"api/repositories/","title":"API Reference: Repositories","text":""},{"location":"api/repositories/#eva_core.domain.repositories.base","title":"<code>eva_core.domain.repositories.base</code>","text":"<p>Base repository interface.</p> <p>Defines the contract for all repositories in the domain layer. Repositories abstract persistence concerns from domain logic.</p>"},{"location":"api/repositories/#eva_core.domain.repositories.base-classes","title":"Classes","text":""},{"location":"api/repositories/#eva_core.domain.repositories.base.Repository","title":"<code>Repository</code>","text":"<p>               Bases: <code>ABC</code>, <code>Generic[T]</code></p> <p>Abstract base repository for domain entities.</p> <p>Provides standard CRUD operations that all repositories must implement. Uses generic type T to ensure type safety across implementations.</p> <p>          Class Type Parameters:        </p> Name Bound or Constraints Description Default <code>T</code> <p>The entity type this repository manages (must be Pydantic BaseModel).</p> required Example <p>class UserRepository(Repository[User]): ...     async def get(self, id: str) -&gt; User | None: ...         # Implementation ...         pass</p> Source code in <code>src\\eva_core\\domain\\repositories\\base.py</code> <pre><code>class Repository(ABC, Generic[T]):\n    \"\"\"Abstract base repository for domain entities.\n\n    Provides standard CRUD operations that all repositories must implement.\n    Uses generic type T to ensure type safety across implementations.\n\n    Type Parameters:\n        T: The entity type this repository manages (must be Pydantic BaseModel).\n\n    Example:\n        &gt;&gt;&gt; class UserRepository(Repository[User]):\n        ...     async def get(self, id: str) -&gt; User | None:\n        ...         # Implementation\n        ...         pass\n    \"\"\"\n\n    @abstractmethod\n    async def get(self, id: str) -&gt; T | None:\n        \"\"\"Retrieve entity by ID.\n\n        Args:\n            id: Entity identifier.\n\n        Returns:\n            Entity if found, None otherwise.\n        \"\"\"\n        ...\n\n    @abstractmethod\n    async def list(self, skip: int = 0, limit: int = 100) -&gt; list[T]:\n        \"\"\"List entities with pagination.\n\n        Args:\n            skip: Number of entities to skip.\n            limit: Maximum number of entities to return.\n\n        Returns:\n            List of entities.\n        \"\"\"\n        ...\n\n    @abstractmethod\n    async def save(self, entity: T) -&gt; T:\n        \"\"\"Save (create or update) entity.\n\n        Args:\n            entity: Entity to save.\n\n        Returns:\n            Saved entity (may include generated fields).\n        \"\"\"\n        ...\n\n    @abstractmethod\n    async def delete(self, id: str) -&gt; bool:\n        \"\"\"Delete entity by ID.\n\n        Args:\n            id: Entity identifier.\n\n        Returns:\n            True if entity was deleted, False if not found.\n        \"\"\"\n        ...\n</code></pre>"},{"location":"api/repositories/#eva_core.domain.repositories.base.Repository-functions","title":"Functions","text":""},{"location":"api/repositories/#eva_core.domain.repositories.base.Repository.get","title":"<code>get(id)</code>  <code>abstractmethod</code> <code>async</code>","text":"<p>Retrieve entity by ID.</p> <p>Parameters:</p> Name Type Description Default <code>id</code> <code>str</code> <p>Entity identifier.</p> required <p>Returns:</p> Type Description <code>T | None</code> <p>Entity if found, None otherwise.</p> Source code in <code>src\\eva_core\\domain\\repositories\\base.py</code> <pre><code>@abstractmethod\nasync def get(self, id: str) -&gt; T | None:\n    \"\"\"Retrieve entity by ID.\n\n    Args:\n        id: Entity identifier.\n\n    Returns:\n        Entity if found, None otherwise.\n    \"\"\"\n    ...\n</code></pre>"},{"location":"api/repositories/#eva_core.domain.repositories.base.Repository.list","title":"<code>list(skip=0, limit=100)</code>  <code>abstractmethod</code> <code>async</code>","text":"<p>List entities with pagination.</p> <p>Parameters:</p> Name Type Description Default <code>skip</code> <code>int</code> <p>Number of entities to skip.</p> <code>0</code> <code>limit</code> <code>int</code> <p>Maximum number of entities to return.</p> <code>100</code> <p>Returns:</p> Type Description <code>list[T]</code> <p>List of entities.</p> Source code in <code>src\\eva_core\\domain\\repositories\\base.py</code> <pre><code>@abstractmethod\nasync def list(self, skip: int = 0, limit: int = 100) -&gt; list[T]:\n    \"\"\"List entities with pagination.\n\n    Args:\n        skip: Number of entities to skip.\n        limit: Maximum number of entities to return.\n\n    Returns:\n        List of entities.\n    \"\"\"\n    ...\n</code></pre>"},{"location":"api/repositories/#eva_core.domain.repositories.base.Repository.save","title":"<code>save(entity)</code>  <code>abstractmethod</code> <code>async</code>","text":"<p>Save (create or update) entity.</p> <p>Parameters:</p> Name Type Description Default <code>entity</code> <code>T</code> <p>Entity to save.</p> required <p>Returns:</p> Type Description <code>T</code> <p>Saved entity (may include generated fields).</p> Source code in <code>src\\eva_core\\domain\\repositories\\base.py</code> <pre><code>@abstractmethod\nasync def save(self, entity: T) -&gt; T:\n    \"\"\"Save (create or update) entity.\n\n    Args:\n        entity: Entity to save.\n\n    Returns:\n        Saved entity (may include generated fields).\n    \"\"\"\n    ...\n</code></pre>"},{"location":"api/repositories/#eva_core.domain.repositories.base.Repository.delete","title":"<code>delete(id)</code>  <code>abstractmethod</code> <code>async</code>","text":"<p>Delete entity by ID.</p> <p>Parameters:</p> Name Type Description Default <code>id</code> <code>str</code> <p>Entity identifier.</p> required <p>Returns:</p> Type Description <code>bool</code> <p>True if entity was deleted, False if not found.</p> Source code in <code>src\\eva_core\\domain\\repositories\\base.py</code> <pre><code>@abstractmethod\nasync def delete(self, id: str) -&gt; bool:\n    \"\"\"Delete entity by ID.\n\n    Args:\n        id: Entity identifier.\n\n    Returns:\n        True if entity was deleted, False if not found.\n    \"\"\"\n    ...\n</code></pre>"},{"location":"api/repositories/#eva_core.domain.repositories.user_repository","title":"<code>eva_core.domain.repositories.user_repository</code>","text":"<p>User repository interface.</p>"},{"location":"api/repositories/#eva_core.domain.repositories.user_repository-classes","title":"Classes","text":""},{"location":"api/repositories/#eva_core.domain.repositories.user_repository.UserRepository","title":"<code>UserRepository</code>","text":"<p>               Bases: <code>Repository[User]</code></p> <p>Repository for User aggregate root.</p> <p>Extends base repository with user-specific query methods.</p> Source code in <code>src\\eva_core\\domain\\repositories\\user_repository.py</code> <pre><code>class UserRepository(Repository[User]):\n    \"\"\"Repository for User aggregate root.\n\n    Extends base repository with user-specific query methods.\n    \"\"\"\n\n    @abstractmethod\n    async def get_by_email(self, email: str, tenant_id: str) -&gt; User | None:\n        \"\"\"Find user by email within tenant.\n\n        Args:\n            email: User email address.\n            tenant_id: Tenant ID for isolation.\n\n        Returns:\n            User if found, None otherwise.\n        \"\"\"\n        ...\n\n    @abstractmethod\n    async def get_by_auth_sub(self, auth_sub: str, auth_provider: str) -&gt; User | None:\n        \"\"\"Find user by authentication subject ID.\n\n        Args:\n            auth_sub: Authentication provider subject ID.\n            auth_provider: Authentication provider name.\n\n        Returns:\n            User if found, None otherwise.\n        \"\"\"\n        ...\n\n    @abstractmethod\n    async def list_by_tenant(\n        self, tenant_id: str, skip: int = 0, limit: int = 100\n    ) -&gt; list[User]:\n        \"\"\"List users in tenant with pagination.\n\n        Args:\n            tenant_id: Tenant ID.\n            skip: Number of users to skip.\n            limit: Maximum number of users to return.\n\n        Returns:\n            List of users in tenant.\n        \"\"\"\n        ...\n</code></pre>"},{"location":"api/repositories/#eva_core.domain.repositories.user_repository.UserRepository-functions","title":"Functions","text":""},{"location":"api/repositories/#eva_core.domain.repositories.user_repository.UserRepository.get_by_email","title":"<code>get_by_email(email, tenant_id)</code>  <code>abstractmethod</code> <code>async</code>","text":"<p>Find user by email within tenant.</p> <p>Parameters:</p> Name Type Description Default <code>email</code> <code>str</code> <p>User email address.</p> required <code>tenant_id</code> <code>str</code> <p>Tenant ID for isolation.</p> required <p>Returns:</p> Type Description <code>User | None</code> <p>User if found, None otherwise.</p> Source code in <code>src\\eva_core\\domain\\repositories\\user_repository.py</code> <pre><code>@abstractmethod\nasync def get_by_email(self, email: str, tenant_id: str) -&gt; User | None:\n    \"\"\"Find user by email within tenant.\n\n    Args:\n        email: User email address.\n        tenant_id: Tenant ID for isolation.\n\n    Returns:\n        User if found, None otherwise.\n    \"\"\"\n    ...\n</code></pre>"},{"location":"api/repositories/#eva_core.domain.repositories.user_repository.UserRepository.get_by_auth_sub","title":"<code>get_by_auth_sub(auth_sub, auth_provider)</code>  <code>abstractmethod</code> <code>async</code>","text":"<p>Find user by authentication subject ID.</p> <p>Parameters:</p> Name Type Description Default <code>auth_sub</code> <code>str</code> <p>Authentication provider subject ID.</p> required <code>auth_provider</code> <code>str</code> <p>Authentication provider name.</p> required <p>Returns:</p> Type Description <code>User | None</code> <p>User if found, None otherwise.</p> Source code in <code>src\\eva_core\\domain\\repositories\\user_repository.py</code> <pre><code>@abstractmethod\nasync def get_by_auth_sub(self, auth_sub: str, auth_provider: str) -&gt; User | None:\n    \"\"\"Find user by authentication subject ID.\n\n    Args:\n        auth_sub: Authentication provider subject ID.\n        auth_provider: Authentication provider name.\n\n    Returns:\n        User if found, None otherwise.\n    \"\"\"\n    ...\n</code></pre>"},{"location":"api/repositories/#eva_core.domain.repositories.user_repository.UserRepository.list_by_tenant","title":"<code>list_by_tenant(tenant_id, skip=0, limit=100)</code>  <code>abstractmethod</code> <code>async</code>","text":"<p>List users in tenant with pagination.</p> <p>Parameters:</p> Name Type Description Default <code>tenant_id</code> <code>str</code> <p>Tenant ID.</p> required <code>skip</code> <code>int</code> <p>Number of users to skip.</p> <code>0</code> <code>limit</code> <code>int</code> <p>Maximum number of users to return.</p> <code>100</code> <p>Returns:</p> Type Description <code>list[User]</code> <p>List of users in tenant.</p> Source code in <code>src\\eva_core\\domain\\repositories\\user_repository.py</code> <pre><code>@abstractmethod\nasync def list_by_tenant(\n    self, tenant_id: str, skip: int = 0, limit: int = 100\n) -&gt; list[User]:\n    \"\"\"List users in tenant with pagination.\n\n    Args:\n        tenant_id: Tenant ID.\n        skip: Number of users to skip.\n        limit: Maximum number of users to return.\n\n    Returns:\n        List of users in tenant.\n    \"\"\"\n    ...\n</code></pre>"},{"location":"api/repositories/#eva_core.domain.repositories.tenant_repository","title":"<code>eva_core.domain.repositories.tenant_repository</code>","text":"<p>Tenant repository interface.</p>"},{"location":"api/repositories/#eva_core.domain.repositories.tenant_repository-classes","title":"Classes","text":""},{"location":"api/repositories/#eva_core.domain.repositories.tenant_repository.TenantRepository","title":"<code>TenantRepository</code>","text":"<p>               Bases: <code>Repository[Tenant]</code></p> <p>Repository for Tenant aggregate root.</p> <p>Extends base repository with tenant-specific query methods.</p> Source code in <code>src\\eva_core\\domain\\repositories\\tenant_repository.py</code> <pre><code>class TenantRepository(Repository[Tenant]):\n    \"\"\"Repository for Tenant aggregate root.\n\n    Extends base repository with tenant-specific query methods.\n    \"\"\"\n\n    @abstractmethod\n    async def get_by_slug(self, slug: str) -&gt; Tenant | None:\n        \"\"\"Find tenant by URL-safe slug.\n\n        Args:\n            slug: Tenant slug (e.g., \"example-org\").\n\n        Returns:\n            Tenant if found, None otherwise.\n        \"\"\"\n        ...\n\n    @abstractmethod\n    async def list_active(self, skip: int = 0, limit: int = 100) -&gt; list[Tenant]:\n        \"\"\"List active tenants with pagination.\n\n        Args:\n            skip: Number of tenants to skip.\n            limit: Maximum number of tenants to return.\n\n        Returns:\n            List of active tenants.\n        \"\"\"\n        ...\n</code></pre>"},{"location":"api/repositories/#eva_core.domain.repositories.tenant_repository.TenantRepository-functions","title":"Functions","text":""},{"location":"api/repositories/#eva_core.domain.repositories.tenant_repository.TenantRepository.get_by_slug","title":"<code>get_by_slug(slug)</code>  <code>abstractmethod</code> <code>async</code>","text":"<p>Find tenant by URL-safe slug.</p> <p>Parameters:</p> Name Type Description Default <code>slug</code> <code>str</code> <p>Tenant slug (e.g., \"example-org\").</p> required <p>Returns:</p> Type Description <code>Tenant | None</code> <p>Tenant if found, None otherwise.</p> Source code in <code>src\\eva_core\\domain\\repositories\\tenant_repository.py</code> <pre><code>@abstractmethod\nasync def get_by_slug(self, slug: str) -&gt; Tenant | None:\n    \"\"\"Find tenant by URL-safe slug.\n\n    Args:\n        slug: Tenant slug (e.g., \"example-org\").\n\n    Returns:\n        Tenant if found, None otherwise.\n    \"\"\"\n    ...\n</code></pre>"},{"location":"api/repositories/#eva_core.domain.repositories.tenant_repository.TenantRepository.list_active","title":"<code>list_active(skip=0, limit=100)</code>  <code>abstractmethod</code> <code>async</code>","text":"<p>List active tenants with pagination.</p> <p>Parameters:</p> Name Type Description Default <code>skip</code> <code>int</code> <p>Number of tenants to skip.</p> <code>0</code> <code>limit</code> <code>int</code> <p>Maximum number of tenants to return.</p> <code>100</code> <p>Returns:</p> Type Description <code>list[Tenant]</code> <p>List of active tenants.</p> Source code in <code>src\\eva_core\\domain\\repositories\\tenant_repository.py</code> <pre><code>@abstractmethod\nasync def list_active(self, skip: int = 0, limit: int = 100) -&gt; list[Tenant]:\n    \"\"\"List active tenants with pagination.\n\n    Args:\n        skip: Number of tenants to skip.\n        limit: Maximum number of tenants to return.\n\n    Returns:\n        List of active tenants.\n    \"\"\"\n    ...\n</code></pre>"},{"location":"api/repositories/#eva_core.domain.repositories.space_repository","title":"<code>eva_core.domain.repositories.space_repository</code>","text":"<p>Space repository interface.</p>"},{"location":"api/repositories/#eva_core.domain.repositories.space_repository-classes","title":"Classes","text":""},{"location":"api/repositories/#eva_core.domain.repositories.space_repository.SpaceRepository","title":"<code>SpaceRepository</code>","text":"<p>               Bases: <code>Repository[Space]</code></p> <p>Repository for Space aggregate root.</p> <p>Extends base repository with space-specific query methods.</p> Source code in <code>src\\eva_core\\domain\\repositories\\space_repository.py</code> <pre><code>class SpaceRepository(Repository[Space]):\n    \"\"\"Repository for Space aggregate root.\n\n    Extends base repository with space-specific query methods.\n    \"\"\"\n\n    @abstractmethod\n    async def list_by_tenant(\n        self, tenant_id: str, skip: int = 0, limit: int = 100\n    ) -&gt; list[Space]:\n        \"\"\"List spaces in tenant with pagination.\n\n        Args:\n            tenant_id: Tenant ID.\n            skip: Number of spaces to skip.\n            limit: Maximum number of spaces to return.\n\n        Returns:\n            List of spaces in tenant.\n        \"\"\"\n        ...\n\n    @abstractmethod\n    async def list_by_owner(\n        self, owner_id: str, tenant_id: str, skip: int = 0, limit: int = 100\n    ) -&gt; list[Space]:\n        \"\"\"List spaces owned by user.\n\n        Args:\n            owner_id: Owner user ID.\n            tenant_id: Tenant ID for isolation.\n            skip: Number of spaces to skip.\n            limit: Maximum number of spaces to return.\n\n        Returns:\n            List of spaces owned by user.\n        \"\"\"\n        ...\n\n    @abstractmethod\n    async def list_by_member(\n        self, user_id: str, tenant_id: str, skip: int = 0, limit: int = 100\n    ) -&gt; list[Space]:\n        \"\"\"List spaces where user is a member.\n\n        Args:\n            user_id: User ID.\n            tenant_id: Tenant ID for isolation.\n            skip: Number of spaces to skip.\n            limit: Maximum number of spaces to return.\n\n        Returns:\n            List of spaces where user is member.\n        \"\"\"\n        ...\n</code></pre>"},{"location":"api/repositories/#eva_core.domain.repositories.space_repository.SpaceRepository-functions","title":"Functions","text":""},{"location":"api/repositories/#eva_core.domain.repositories.space_repository.SpaceRepository.list_by_tenant","title":"<code>list_by_tenant(tenant_id, skip=0, limit=100)</code>  <code>abstractmethod</code> <code>async</code>","text":"<p>List spaces in tenant with pagination.</p> <p>Parameters:</p> Name Type Description Default <code>tenant_id</code> <code>str</code> <p>Tenant ID.</p> required <code>skip</code> <code>int</code> <p>Number of spaces to skip.</p> <code>0</code> <code>limit</code> <code>int</code> <p>Maximum number of spaces to return.</p> <code>100</code> <p>Returns:</p> Type Description <code>list[Space]</code> <p>List of spaces in tenant.</p> Source code in <code>src\\eva_core\\domain\\repositories\\space_repository.py</code> <pre><code>@abstractmethod\nasync def list_by_tenant(\n    self, tenant_id: str, skip: int = 0, limit: int = 100\n) -&gt; list[Space]:\n    \"\"\"List spaces in tenant with pagination.\n\n    Args:\n        tenant_id: Tenant ID.\n        skip: Number of spaces to skip.\n        limit: Maximum number of spaces to return.\n\n    Returns:\n        List of spaces in tenant.\n    \"\"\"\n    ...\n</code></pre>"},{"location":"api/repositories/#eva_core.domain.repositories.space_repository.SpaceRepository.list_by_owner","title":"<code>list_by_owner(owner_id, tenant_id, skip=0, limit=100)</code>  <code>abstractmethod</code> <code>async</code>","text":"<p>List spaces owned by user.</p> <p>Parameters:</p> Name Type Description Default <code>owner_id</code> <code>str</code> <p>Owner user ID.</p> required <code>tenant_id</code> <code>str</code> <p>Tenant ID for isolation.</p> required <code>skip</code> <code>int</code> <p>Number of spaces to skip.</p> <code>0</code> <code>limit</code> <code>int</code> <p>Maximum number of spaces to return.</p> <code>100</code> <p>Returns:</p> Type Description <code>list[Space]</code> <p>List of spaces owned by user.</p> Source code in <code>src\\eva_core\\domain\\repositories\\space_repository.py</code> <pre><code>@abstractmethod\nasync def list_by_owner(\n    self, owner_id: str, tenant_id: str, skip: int = 0, limit: int = 100\n) -&gt; list[Space]:\n    \"\"\"List spaces owned by user.\n\n    Args:\n        owner_id: Owner user ID.\n        tenant_id: Tenant ID for isolation.\n        skip: Number of spaces to skip.\n        limit: Maximum number of spaces to return.\n\n    Returns:\n        List of spaces owned by user.\n    \"\"\"\n    ...\n</code></pre>"},{"location":"api/repositories/#eva_core.domain.repositories.space_repository.SpaceRepository.list_by_member","title":"<code>list_by_member(user_id, tenant_id, skip=0, limit=100)</code>  <code>abstractmethod</code> <code>async</code>","text":"<p>List spaces where user is a member.</p> <p>Parameters:</p> Name Type Description Default <code>user_id</code> <code>str</code> <p>User ID.</p> required <code>tenant_id</code> <code>str</code> <p>Tenant ID for isolation.</p> required <code>skip</code> <code>int</code> <p>Number of spaces to skip.</p> <code>0</code> <code>limit</code> <code>int</code> <p>Maximum number of spaces to return.</p> <code>100</code> <p>Returns:</p> Type Description <code>list[Space]</code> <p>List of spaces where user is member.</p> Source code in <code>src\\eva_core\\domain\\repositories\\space_repository.py</code> <pre><code>@abstractmethod\nasync def list_by_member(\n    self, user_id: str, tenant_id: str, skip: int = 0, limit: int = 100\n) -&gt; list[Space]:\n    \"\"\"List spaces where user is a member.\n\n    Args:\n        user_id: User ID.\n        tenant_id: Tenant ID for isolation.\n        skip: Number of spaces to skip.\n        limit: Maximum number of spaces to return.\n\n    Returns:\n        List of spaces where user is member.\n    \"\"\"\n    ...\n</code></pre>"},{"location":"api/repositories/#eva_core.domain.repositories.document_repository","title":"<code>eva_core.domain.repositories.document_repository</code>","text":"<p>Document repository interface.</p>"},{"location":"api/repositories/#eva_core.domain.repositories.document_repository-classes","title":"Classes","text":""},{"location":"api/repositories/#eva_core.domain.repositories.document_repository.DocumentRepository","title":"<code>DocumentRepository</code>","text":"<p>               Bases: <code>Repository[Document]</code></p> <p>Repository for Document entity.</p> <p>Extends base repository with document-specific query methods.</p> Source code in <code>src\\eva_core\\domain\\repositories\\document_repository.py</code> <pre><code>class DocumentRepository(Repository[Document]):\n    \"\"\"Repository for Document entity.\n\n    Extends base repository with document-specific query methods.\n    \"\"\"\n\n    @abstractmethod\n    async def list_by_space(\n        self, space_id: str, tenant_id: str, skip: int = 0, limit: int = 100\n    ) -&gt; list[Document]:\n        \"\"\"List documents in space with pagination.\n\n        Args:\n            space_id: Space ID.\n            tenant_id: Tenant ID for isolation.\n            skip: Number of documents to skip.\n            limit: Maximum number of documents to return.\n\n        Returns:\n            List of documents in space.\n        \"\"\"\n        ...\n\n    @abstractmethod\n    async def get_by_content_hash(\n        self, content_hash: str, tenant_id: str\n    ) -&gt; Document | None:\n        \"\"\"Find document by content hash (for deduplication).\n\n        Args:\n            content_hash: SHA-256 content hash.\n            tenant_id: Tenant ID for isolation.\n\n        Returns:\n            Document if found, None otherwise.\n        \"\"\"\n        ...\n\n    @abstractmethod\n    async def list_pending_indexing(\n        self, tenant_id: str, limit: int = 100\n    ) -&gt; list[Document]:\n        \"\"\"List documents pending indexing.\n\n        Args:\n            tenant_id: Tenant ID for isolation.\n            limit: Maximum number of documents to return.\n\n        Returns:\n            List of documents with status UPLOADED (not yet indexed).\n        \"\"\"\n        ...\n</code></pre>"},{"location":"api/repositories/#eva_core.domain.repositories.document_repository.DocumentRepository-functions","title":"Functions","text":""},{"location":"api/repositories/#eva_core.domain.repositories.document_repository.DocumentRepository.list_by_space","title":"<code>list_by_space(space_id, tenant_id, skip=0, limit=100)</code>  <code>abstractmethod</code> <code>async</code>","text":"<p>List documents in space with pagination.</p> <p>Parameters:</p> Name Type Description Default <code>space_id</code> <code>str</code> <p>Space ID.</p> required <code>tenant_id</code> <code>str</code> <p>Tenant ID for isolation.</p> required <code>skip</code> <code>int</code> <p>Number of documents to skip.</p> <code>0</code> <code>limit</code> <code>int</code> <p>Maximum number of documents to return.</p> <code>100</code> <p>Returns:</p> Type Description <code>list[Document]</code> <p>List of documents in space.</p> Source code in <code>src\\eva_core\\domain\\repositories\\document_repository.py</code> <pre><code>@abstractmethod\nasync def list_by_space(\n    self, space_id: str, tenant_id: str, skip: int = 0, limit: int = 100\n) -&gt; list[Document]:\n    \"\"\"List documents in space with pagination.\n\n    Args:\n        space_id: Space ID.\n        tenant_id: Tenant ID for isolation.\n        skip: Number of documents to skip.\n        limit: Maximum number of documents to return.\n\n    Returns:\n        List of documents in space.\n    \"\"\"\n    ...\n</code></pre>"},{"location":"api/repositories/#eva_core.domain.repositories.document_repository.DocumentRepository.get_by_content_hash","title":"<code>get_by_content_hash(content_hash, tenant_id)</code>  <code>abstractmethod</code> <code>async</code>","text":"<p>Find document by content hash (for deduplication).</p> <p>Parameters:</p> Name Type Description Default <code>content_hash</code> <code>str</code> <p>SHA-256 content hash.</p> required <code>tenant_id</code> <code>str</code> <p>Tenant ID for isolation.</p> required <p>Returns:</p> Type Description <code>Document | None</code> <p>Document if found, None otherwise.</p> Source code in <code>src\\eva_core\\domain\\repositories\\document_repository.py</code> <pre><code>@abstractmethod\nasync def get_by_content_hash(\n    self, content_hash: str, tenant_id: str\n) -&gt; Document | None:\n    \"\"\"Find document by content hash (for deduplication).\n\n    Args:\n        content_hash: SHA-256 content hash.\n        tenant_id: Tenant ID for isolation.\n\n    Returns:\n        Document if found, None otherwise.\n    \"\"\"\n    ...\n</code></pre>"},{"location":"api/repositories/#eva_core.domain.repositories.document_repository.DocumentRepository.list_pending_indexing","title":"<code>list_pending_indexing(tenant_id, limit=100)</code>  <code>abstractmethod</code> <code>async</code>","text":"<p>List documents pending indexing.</p> <p>Parameters:</p> Name Type Description Default <code>tenant_id</code> <code>str</code> <p>Tenant ID for isolation.</p> required <code>limit</code> <code>int</code> <p>Maximum number of documents to return.</p> <code>100</code> <p>Returns:</p> Type Description <code>list[Document]</code> <p>List of documents with status UPLOADED (not yet indexed).</p> Source code in <code>src\\eva_core\\domain\\repositories\\document_repository.py</code> <pre><code>@abstractmethod\nasync def list_pending_indexing(\n    self, tenant_id: str, limit: int = 100\n) -&gt; list[Document]:\n    \"\"\"List documents pending indexing.\n\n    Args:\n        tenant_id: Tenant ID for isolation.\n        limit: Maximum number of documents to return.\n\n    Returns:\n        List of documents with status UPLOADED (not yet indexed).\n    \"\"\"\n    ...\n</code></pre>"},{"location":"api/repositories/#eva_core.domain.repositories.query_repository","title":"<code>eva_core.domain.repositories.query_repository</code>","text":"<p>Query repository interface.</p>"},{"location":"api/repositories/#eva_core.domain.repositories.query_repository-classes","title":"Classes","text":""},{"location":"api/repositories/#eva_core.domain.repositories.query_repository.QueryRepository","title":"<code>QueryRepository</code>","text":"<p>               Bases: <code>Repository[Query]</code></p> <p>Repository for Query entity.</p> <p>Extends base repository with query-specific query methods.</p> Source code in <code>src\\eva_core\\domain\\repositories\\query_repository.py</code> <pre><code>class QueryRepository(Repository[Query]):\n    \"\"\"Repository for Query entity.\n\n    Extends base repository with query-specific query methods.\n    \"\"\"\n\n    @abstractmethod\n    async def list_by_space(\n        self, space_id: str, tenant_id: str, skip: int = 0, limit: int = 100\n    ) -&gt; list[Query]:\n        \"\"\"List queries in space with pagination.\n\n        Args:\n            space_id: Space ID.\n            tenant_id: Tenant ID for isolation.\n            skip: Number of queries to skip.\n            limit: Maximum number of queries to return.\n\n        Returns:\n            List of queries in space.\n        \"\"\"\n        ...\n\n    @abstractmethod\n    async def list_by_user(\n        self, user_id: str, tenant_id: str, skip: int = 0, limit: int = 100\n    ) -&gt; list[Query]:\n        \"\"\"List queries by user with pagination.\n\n        Args:\n            user_id: User ID.\n            tenant_id: Tenant ID for isolation.\n            skip: Number of queries to skip.\n            limit: Maximum number of queries to return.\n\n        Returns:\n            List of queries by user.\n        \"\"\"\n        ...\n\n    @abstractmethod\n    async def list_by_conversation(\n        self, conversation_id: str, tenant_id: str, skip: int = 0, limit: int = 100\n    ) -&gt; list[Query]:\n        \"\"\"List queries in conversation with pagination.\n\n        Args:\n            conversation_id: Conversation ID.\n            tenant_id: Tenant ID for isolation.\n            skip: Number of queries to skip.\n            limit: Maximum number of queries to return.\n\n        Returns:\n            List of queries in conversation.\n        \"\"\"\n        ...\n</code></pre>"},{"location":"api/repositories/#eva_core.domain.repositories.query_repository.QueryRepository-functions","title":"Functions","text":""},{"location":"api/repositories/#eva_core.domain.repositories.query_repository.QueryRepository.list_by_space","title":"<code>list_by_space(space_id, tenant_id, skip=0, limit=100)</code>  <code>abstractmethod</code> <code>async</code>","text":"<p>List queries in space with pagination.</p> <p>Parameters:</p> Name Type Description Default <code>space_id</code> <code>str</code> <p>Space ID.</p> required <code>tenant_id</code> <code>str</code> <p>Tenant ID for isolation.</p> required <code>skip</code> <code>int</code> <p>Number of queries to skip.</p> <code>0</code> <code>limit</code> <code>int</code> <p>Maximum number of queries to return.</p> <code>100</code> <p>Returns:</p> Type Description <code>list[Query]</code> <p>List of queries in space.</p> Source code in <code>src\\eva_core\\domain\\repositories\\query_repository.py</code> <pre><code>@abstractmethod\nasync def list_by_space(\n    self, space_id: str, tenant_id: str, skip: int = 0, limit: int = 100\n) -&gt; list[Query]:\n    \"\"\"List queries in space with pagination.\n\n    Args:\n        space_id: Space ID.\n        tenant_id: Tenant ID for isolation.\n        skip: Number of queries to skip.\n        limit: Maximum number of queries to return.\n\n    Returns:\n        List of queries in space.\n    \"\"\"\n    ...\n</code></pre>"},{"location":"api/repositories/#eva_core.domain.repositories.query_repository.QueryRepository.list_by_user","title":"<code>list_by_user(user_id, tenant_id, skip=0, limit=100)</code>  <code>abstractmethod</code> <code>async</code>","text":"<p>List queries by user with pagination.</p> <p>Parameters:</p> Name Type Description Default <code>user_id</code> <code>str</code> <p>User ID.</p> required <code>tenant_id</code> <code>str</code> <p>Tenant ID for isolation.</p> required <code>skip</code> <code>int</code> <p>Number of queries to skip.</p> <code>0</code> <code>limit</code> <code>int</code> <p>Maximum number of queries to return.</p> <code>100</code> <p>Returns:</p> Type Description <code>list[Query]</code> <p>List of queries by user.</p> Source code in <code>src\\eva_core\\domain\\repositories\\query_repository.py</code> <pre><code>@abstractmethod\nasync def list_by_user(\n    self, user_id: str, tenant_id: str, skip: int = 0, limit: int = 100\n) -&gt; list[Query]:\n    \"\"\"List queries by user with pagination.\n\n    Args:\n        user_id: User ID.\n        tenant_id: Tenant ID for isolation.\n        skip: Number of queries to skip.\n        limit: Maximum number of queries to return.\n\n    Returns:\n        List of queries by user.\n    \"\"\"\n    ...\n</code></pre>"},{"location":"api/repositories/#eva_core.domain.repositories.query_repository.QueryRepository.list_by_conversation","title":"<code>list_by_conversation(conversation_id, tenant_id, skip=0, limit=100)</code>  <code>abstractmethod</code> <code>async</code>","text":"<p>List queries in conversation with pagination.</p> <p>Parameters:</p> Name Type Description Default <code>conversation_id</code> <code>str</code> <p>Conversation ID.</p> required <code>tenant_id</code> <code>str</code> <p>Tenant ID for isolation.</p> required <code>skip</code> <code>int</code> <p>Number of queries to skip.</p> <code>0</code> <code>limit</code> <code>int</code> <p>Maximum number of queries to return.</p> <code>100</code> <p>Returns:</p> Type Description <code>list[Query]</code> <p>List of queries in conversation.</p> Source code in <code>src\\eva_core\\domain\\repositories\\query_repository.py</code> <pre><code>@abstractmethod\nasync def list_by_conversation(\n    self, conversation_id: str, tenant_id: str, skip: int = 0, limit: int = 100\n) -&gt; list[Query]:\n    \"\"\"List queries in conversation with pagination.\n\n    Args:\n        conversation_id: Conversation ID.\n        tenant_id: Tenant ID for isolation.\n        skip: Number of queries to skip.\n        limit: Maximum number of queries to return.\n\n    Returns:\n        List of queries in conversation.\n    \"\"\"\n    ...\n</code></pre>"},{"location":"api/value-objects/","title":"API Reference: Value Objects","text":""},{"location":"api/value-objects/#eva_core.domain.value_objects.email","title":"<code>eva_core.domain.value_objects.email</code>","text":"<p>Email value object with validation and PII masking.</p> Example <p>from eva_core.domain.value_objects.email import Email email = Email(value=\"john.doe@canada.ca\") email.mask() 'je@c**a'</p>"},{"location":"api/value-objects/#eva_core.domain.value_objects.email-classes","title":"Classes","text":""},{"location":"api/value-objects/#eva_core.domain.value_objects.email.Email","title":"<code>Email</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Email value object with validation.</p> <p>Attributes:</p> Name Type Description <code>value</code> <code>EmailStr</code> <p>Email address (validated by Pydantic EmailStr).</p> Source code in <code>src\\eva_core\\domain\\value_objects\\email.py</code> <pre><code>class Email(BaseModel):\n    \"\"\"Email value object with validation.\n\n    Attributes:\n        value: Email address (validated by Pydantic EmailStr).\n    \"\"\"\n\n    value: EmailStr\n\n    def mask(self) -&gt; str:\n        \"\"\"Mask email for logging: john.doe@example.com \u2192 j***e@e*****e.com.\n\n        Returns:\n            Masked email string with first and last characters visible.\n\n        Example:\n            &gt;&gt;&gt; Email(value=\"john.doe@canada.ca\").mask()\n            'j***e@c*****a'\n        \"\"\"\n        parts = self.value.split(\"@\")\n        if len(parts) != 2:\n            return \"***@***\"\n\n        local = parts[0]\n        domain = parts[1]\n\n        # Mask local part: first + *** + last\n        masked_local = f\"{local[0]}***{local[-1]}\" if len(local) &gt; 1 else f\"{local}***\"\n\n        # Mask domain: first + ***** + last\n        masked_domain = f\"{domain[0]}*****{domain[-1]}\" if len(domain) &gt; 1 else f\"{domain}***\"\n\n        return f\"{masked_local}@{masked_domain}\"\n</code></pre>"},{"location":"api/value-objects/#eva_core.domain.value_objects.email.Email-functions","title":"Functions","text":""},{"location":"api/value-objects/#eva_core.domain.value_objects.email.Email.mask","title":"<code>mask()</code>","text":"<p>Mask email for logging: john.doe@example.com \u2192 je@e**e.com.</p> <p>Returns:</p> Type Description <code>str</code> <p>Masked email string with first and last characters visible.</p> Example <p>Email(value=\"john.doe@canada.ca\").mask() 'je@c**a'</p> Source code in <code>src\\eva_core\\domain\\value_objects\\email.py</code> <pre><code>def mask(self) -&gt; str:\n    \"\"\"Mask email for logging: john.doe@example.com \u2192 j***e@e*****e.com.\n\n    Returns:\n        Masked email string with first and last characters visible.\n\n    Example:\n        &gt;&gt;&gt; Email(value=\"john.doe@canada.ca\").mask()\n        'j***e@c*****a'\n    \"\"\"\n    parts = self.value.split(\"@\")\n    if len(parts) != 2:\n        return \"***@***\"\n\n    local = parts[0]\n    domain = parts[1]\n\n    # Mask local part: first + *** + last\n    masked_local = f\"{local[0]}***{local[-1]}\" if len(local) &gt; 1 else f\"{local}***\"\n\n    # Mask domain: first + ***** + last\n    masked_domain = f\"{domain[0]}*****{domain[-1]}\" if len(domain) &gt; 1 else f\"{domain}***\"\n\n    return f\"{masked_local}@{masked_domain}\"\n</code></pre>"},{"location":"api/value-objects/#eva_core.domain.value_objects.phone_number","title":"<code>eva_core.domain.value_objects.phone_number</code>","text":"<p>Canadian phone number value object with validation and PII masking.</p> Example <p>from eva_core.domain.value_objects.phone_number import PhoneNumber phone = PhoneNumber(value=\"6135551234\") phone.value '(613) 555-1234' phone.mask() '() -1234'</p>"},{"location":"api/value-objects/#eva_core.domain.value_objects.phone_number-classes","title":"Classes","text":""},{"location":"api/value-objects/#eva_core.domain.value_objects.phone_number.PhoneNumber","title":"<code>PhoneNumber</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Canadian phone number value object.</p> <p>Validates 10-digit Canadian phone numbers and formats them consistently.</p> <p>Attributes:</p> Name Type Description <code>value</code> <code>str</code> <p>Phone number in format (xxx) xxx-xxxx.</p> Source code in <code>src\\eva_core\\domain\\value_objects\\phone_number.py</code> <pre><code>class PhoneNumber(BaseModel):\n    \"\"\"Canadian phone number value object.\n\n    Validates 10-digit Canadian phone numbers and formats them consistently.\n\n    Attributes:\n        value: Phone number in format (xxx) xxx-xxxx.\n    \"\"\"\n\n    value: str\n\n    @field_validator(\"value\")\n    @classmethod\n    def validate_phone(cls, v: str) -&gt; str:\n        \"\"\"Validate Canadian phone number format.\n\n        Args:\n            v: Phone number string (can include formatting).\n\n        Returns:\n            Formatted phone number: (xxx) xxx-xxxx.\n\n        Raises:\n            ValueError: If phone number is not 10 digits.\n\n        Example:\n            &gt;&gt;&gt; PhoneNumber(value=\"6135551234\").value\n            '(613) 555-1234'\n        \"\"\"\n        # Remove all non-digit characters\n        digits = re.sub(r\"\\D\", \"\", v)\n\n        # Must be exactly 10 digits (Canadian format)\n        if len(digits) != 10:\n            raise ValueError(\"Phone number must be 10 digits\")\n\n        # Format: (xxx) xxx-xxxx\n        return f\"({digits[:3]}) {digits[3:6]}-{digits[6:]}\"\n\n    def mask(self) -&gt; str:\n        \"\"\"Mask phone for logging: (613) 555-1234 \u2192 (***) ***-1234.\n\n        Returns:\n            Masked phone string with last 4 digits visible.\n\n        Example:\n            &gt;&gt;&gt; PhoneNumber(value=\"6135551234\").mask()\n            '(***) ***-1234'\n        \"\"\"\n        return f\"(***) ***{self.value[-5:]}\"\n</code></pre>"},{"location":"api/value-objects/#eva_core.domain.value_objects.phone_number.PhoneNumber-functions","title":"Functions","text":""},{"location":"api/value-objects/#eva_core.domain.value_objects.phone_number.PhoneNumber.validate_phone","title":"<code>validate_phone(v)</code>  <code>classmethod</code>","text":"<p>Validate Canadian phone number format.</p> <p>Parameters:</p> Name Type Description Default <code>v</code> <code>str</code> <p>Phone number string (can include formatting).</p> required <p>Returns:</p> Type Description <code>str</code> <p>Formatted phone number: (xxx) xxx-xxxx.</p> <p>Raises:</p> Type Description <code>ValueError</code> <p>If phone number is not 10 digits.</p> Example <p>PhoneNumber(value=\"6135551234\").value '(613) 555-1234'</p> Source code in <code>src\\eva_core\\domain\\value_objects\\phone_number.py</code> <pre><code>@field_validator(\"value\")\n@classmethod\ndef validate_phone(cls, v: str) -&gt; str:\n    \"\"\"Validate Canadian phone number format.\n\n    Args:\n        v: Phone number string (can include formatting).\n\n    Returns:\n        Formatted phone number: (xxx) xxx-xxxx.\n\n    Raises:\n        ValueError: If phone number is not 10 digits.\n\n    Example:\n        &gt;&gt;&gt; PhoneNumber(value=\"6135551234\").value\n        '(613) 555-1234'\n    \"\"\"\n    # Remove all non-digit characters\n    digits = re.sub(r\"\\D\", \"\", v)\n\n    # Must be exactly 10 digits (Canadian format)\n    if len(digits) != 10:\n        raise ValueError(\"Phone number must be 10 digits\")\n\n    # Format: (xxx) xxx-xxxx\n    return f\"({digits[:3]}) {digits[3:6]}-{digits[6:]}\"\n</code></pre>"},{"location":"api/value-objects/#eva_core.domain.value_objects.phone_number.PhoneNumber.mask","title":"<code>mask()</code>","text":"<p>Mask phone for logging: (613) 555-1234 \u2192 () -1234.</p> <p>Returns:</p> Type Description <code>str</code> <p>Masked phone string with last 4 digits visible.</p> Example <p>PhoneNumber(value=\"6135551234\").mask() '() -1234'</p> Source code in <code>src\\eva_core\\domain\\value_objects\\phone_number.py</code> <pre><code>def mask(self) -&gt; str:\n    \"\"\"Mask phone for logging: (613) 555-1234 \u2192 (***) ***-1234.\n\n    Returns:\n        Masked phone string with last 4 digits visible.\n\n    Example:\n        &gt;&gt;&gt; PhoneNumber(value=\"6135551234\").mask()\n        '(***) ***-1234'\n    \"\"\"\n    return f\"(***) ***{self.value[-5:]}\"\n</code></pre>"},{"location":"api/value-objects/#eva_core.domain.value_objects.sin","title":"<code>eva_core.domain.value_objects.sin</code>","text":"<p>Canadian Social Insurance Number (SIN) value object with validation and PII masking.</p> <p>Protected B PII - must be masked in all logs and telemetry.</p> Example <p>from eva_core.domain.value_objects.sin import SIN sin = SIN(value=\"046454286\") sin.value '046-454-286' sin.mask() '--286'</p>"},{"location":"api/value-objects/#eva_core.domain.value_objects.sin-classes","title":"Classes","text":""},{"location":"api/value-objects/#eva_core.domain.value_objects.sin.SIN","title":"<code>SIN</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Canadian Social Insurance Number (Protected B PII).</p> <p>Validates 9-digit SINs using Luhn checksum algorithm (CRA standard).</p> <p>Attributes:</p> Name Type Description <code>value</code> <code>str</code> <p>SIN in format xxx-xxx-xxx.</p> Source code in <code>src\\eva_core\\domain\\value_objects\\sin.py</code> <pre><code>class SIN(BaseModel):\n    \"\"\"Canadian Social Insurance Number (Protected B PII).\n\n    Validates 9-digit SINs using Luhn checksum algorithm (CRA standard).\n\n    Attributes:\n        value: SIN in format xxx-xxx-xxx.\n    \"\"\"\n\n    value: str\n\n    @field_validator(\"value\")\n    @classmethod\n    def validate_sin(cls, v: str) -&gt; str:\n        \"\"\"Validate SIN format (9 digits, Luhn checksum).\n\n        Args:\n            v: SIN string (can include dashes/spaces).\n\n        Returns:\n            Formatted SIN: xxx-xxx-xxx.\n\n        Raises:\n            ValueError: If SIN is not 9 digits or fails Luhn checksum.\n\n        Example:\n            &gt;&gt;&gt; SIN(value=\"046454286\").value\n            '046-454-286'\n        \"\"\"\n        # Remove all non-digit characters\n        digits = re.sub(r\"\\D\", \"\", v)\n\n        # Must be exactly 9 digits\n        if len(digits) != 9:\n            raise ValueError(\"SIN must be 9 digits\")\n\n        # Luhn checksum validation (CRA algorithm)\n        # Multiply every other digit by 2, sum all digits\n        checksum = 0\n        for i, d in enumerate(digits):\n            digit = int(d)\n            if i % 2 == 0:\n                # Even position (0-indexed): use digit as-is\n                checksum += digit\n            else:\n                # Odd position: multiply by 2, then sum digits of result\n                doubled = digit * 2\n                checksum += doubled // 10 + doubled % 10\n\n        # Checksum must be divisible by 10\n        if checksum % 10 != 0:\n            raise ValueError(\"Invalid SIN checksum\")\n\n        return f\"{digits[:3]}-{digits[3:6]}-{digits[6:]}\"\n\n    def mask(self) -&gt; str:\n        \"\"\"Mask SIN for logging: 046-454-286 \u2192 ***-***-286.\n\n        Returns:\n            Masked SIN string with last 3 digits visible.\n\n        Example:\n            &gt;&gt;&gt; SIN(value=\"046454286\").mask()\n            '***-***-286'\n        \"\"\"\n        return f\"***-***{self.value[-4:]}\"\n</code></pre>"},{"location":"api/value-objects/#eva_core.domain.value_objects.sin.SIN-functions","title":"Functions","text":""},{"location":"api/value-objects/#eva_core.domain.value_objects.sin.SIN.validate_sin","title":"<code>validate_sin(v)</code>  <code>classmethod</code>","text":"<p>Validate SIN format (9 digits, Luhn checksum).</p> <p>Parameters:</p> Name Type Description Default <code>v</code> <code>str</code> <p>SIN string (can include dashes/spaces).</p> required <p>Returns:</p> Type Description <code>str</code> <p>Formatted SIN: xxx-xxx-xxx.</p> <p>Raises:</p> Type Description <code>ValueError</code> <p>If SIN is not 9 digits or fails Luhn checksum.</p> Example <p>SIN(value=\"046454286\").value '046-454-286'</p> Source code in <code>src\\eva_core\\domain\\value_objects\\sin.py</code> <pre><code>@field_validator(\"value\")\n@classmethod\ndef validate_sin(cls, v: str) -&gt; str:\n    \"\"\"Validate SIN format (9 digits, Luhn checksum).\n\n    Args:\n        v: SIN string (can include dashes/spaces).\n\n    Returns:\n        Formatted SIN: xxx-xxx-xxx.\n\n    Raises:\n        ValueError: If SIN is not 9 digits or fails Luhn checksum.\n\n    Example:\n        &gt;&gt;&gt; SIN(value=\"046454286\").value\n        '046-454-286'\n    \"\"\"\n    # Remove all non-digit characters\n    digits = re.sub(r\"\\D\", \"\", v)\n\n    # Must be exactly 9 digits\n    if len(digits) != 9:\n        raise ValueError(\"SIN must be 9 digits\")\n\n    # Luhn checksum validation (CRA algorithm)\n    # Multiply every other digit by 2, sum all digits\n    checksum = 0\n    for i, d in enumerate(digits):\n        digit = int(d)\n        if i % 2 == 0:\n            # Even position (0-indexed): use digit as-is\n            checksum += digit\n        else:\n            # Odd position: multiply by 2, then sum digits of result\n            doubled = digit * 2\n            checksum += doubled // 10 + doubled % 10\n\n    # Checksum must be divisible by 10\n    if checksum % 10 != 0:\n        raise ValueError(\"Invalid SIN checksum\")\n\n    return f\"{digits[:3]}-{digits[3:6]}-{digits[6:]}\"\n</code></pre>"},{"location":"api/value-objects/#eva_core.domain.value_objects.sin.SIN.mask","title":"<code>mask()</code>","text":"<p>Mask SIN for logging: 046-454-286 \u2192 --286.</p> <p>Returns:</p> Type Description <code>str</code> <p>Masked SIN string with last 3 digits visible.</p> Example <p>SIN(value=\"046454286\").mask() '--286'</p> Source code in <code>src\\eva_core\\domain\\value_objects\\sin.py</code> <pre><code>def mask(self) -&gt; str:\n    \"\"\"Mask SIN for logging: 046-454-286 \u2192 ***-***-286.\n\n    Returns:\n        Masked SIN string with last 3 digits visible.\n\n    Example:\n        &gt;&gt;&gt; SIN(value=\"046454286\").mask()\n        '***-***-286'\n    \"\"\"\n    return f\"***-***{self.value[-4:]}\"\n</code></pre>"},{"location":"development/contributing/","title":"Contributing","text":"<p>Thank you for considering contributing to EVA Core!</p>"},{"location":"development/contributing/#development-setup","title":"Development Setup","text":"<ol> <li>Clone the repository</li> </ol> <pre><code>git clone https://github.com/MarcoPolo483/eva-core.git\ncd eva-core\n</code></pre> <ol> <li>Install dependencies</li> </ol> <pre><code>poetry install\n</code></pre> <ol> <li>Install pre-commit hooks</li> </ol> <pre><code>poetry run pre-commit install\n</code></pre>"},{"location":"development/contributing/#development-workflow","title":"Development Workflow","text":""},{"location":"development/contributing/#1-create-a-branch","title":"1. Create a branch","text":"<pre><code>git checkout -b feature/my-feature\n</code></pre>"},{"location":"development/contributing/#2-make-changes","title":"2. Make changes","text":"<p>Follow the project structure:</p> <pre><code>src/eva_core/domain/\n\u251c\u2500\u2500 entities/       # Domain entities\n\u251c\u2500\u2500 value_objects/  # Immutable value types\n\u251c\u2500\u2500 events/         # Domain events\n\u2514\u2500\u2500 repositories/   # Data access interfaces\n</code></pre>"},{"location":"development/contributing/#3-write-tests","title":"3. Write tests","text":"<ul> <li>Every new feature needs tests</li> <li>Maintain 100% coverage</li> <li>Use pytest for unit tests</li> <li>Use Hypothesis for property tests</li> </ul> <pre><code>pytest tests/\n</code></pre>"},{"location":"development/contributing/#4-type-check","title":"4. Type check","text":"<pre><code>mypy src/\n</code></pre>"},{"location":"development/contributing/#5-lint","title":"5. Lint","text":"<pre><code>ruff check src/ tests/\n</code></pre>"},{"location":"development/contributing/#6-format","title":"6. Format","text":"<pre><code>ruff format src/ tests/\n</code></pre>"},{"location":"development/contributing/#7-run-all-checks","title":"7. Run all checks","text":"<pre><code>pre-commit run --all-files\n</code></pre>"},{"location":"development/contributing/#code-standards","title":"Code Standards","text":""},{"location":"development/contributing/#type-hints","title":"Type Hints","text":"<p>All code must have full type hints:</p> <pre><code>def process_user(user: User, tenant_id: str) -&gt; dict[str, Any]:\n    \"\"\"Process user data.\"\"\"\n    ...\n</code></pre>"},{"location":"development/contributing/#docstrings","title":"Docstrings","text":"<p>Use Google-style docstrings:</p> <pre><code>def create_space(name: str, owner_id: str) -&gt; Space:\n    \"\"\"Create a new space.\n\n    Args:\n        name: Space display name\n        owner_id: ID of the space owner\n\n    Returns:\n        The newly created Space entity\n\n    Raises:\n        ValidationError: If name is invalid\n    \"\"\"\n    ...\n</code></pre>"},{"location":"development/contributing/#testing","title":"Testing","text":"<ul> <li>100% coverage required</li> <li>Test edge cases</li> <li>Use descriptive test names</li> </ul> <pre><code>def test_user_cannot_access_space_in_different_tenant():\n    \"\"\"Test tenant isolation in access control.\"\"\"\n    ...\n</code></pre>"},{"location":"development/contributing/#pull-request-process","title":"Pull Request Process","text":"<ol> <li>Update tests - Add tests for new features</li> <li>Update docs - Update relevant documentation</li> <li>Run checks - Ensure all tests and lints pass</li> <li>Write changelog - Describe your changes</li> <li>Submit PR - Create pull request with clear description</li> </ol>"},{"location":"development/contributing/#pr-checklist","title":"PR Checklist","text":"<ul> <li>[ ] Tests added/updated</li> <li>[ ] Documentation updated</li> <li>[ ] Type hints added</li> <li>[ ] All tests pass</li> <li>[ ] Coverage at 100%</li> <li>[ ] mypy passes</li> <li>[ ] ruff passes</li> <li>[ ] Changelog updated</li> </ul>"},{"location":"development/contributing/#code-review","title":"Code Review","text":"<ul> <li>Be respectful and constructive</li> <li>Focus on code quality and design</li> <li>Suggest improvements, don't demand</li> <li>Explain your reasoning</li> </ul>"},{"location":"development/contributing/#questions","title":"Questions?","text":"<ul> <li>Open an issue for bugs</li> <li>Start a discussion for features</li> <li>Ask in pull requests for clarification</li> </ul>"},{"location":"development/contributing/#license","title":"License","text":"<p>By contributing, you agree that your contributions will be licensed under the MIT License.</p>"},{"location":"development/testing/","title":"Testing","text":""},{"location":"development/testing/#overview","title":"Overview","text":"<p>EVA Core has 100% test coverage with 157+ tests using pytest, Hypothesis, and pytest-asyncio.</p>"},{"location":"development/testing/#running-tests","title":"Running Tests","text":"<pre><code># Run all tests\npytest\n\n# With coverage\npytest --cov=eva_core\n\n# Specific test file\npytest tests/test_entities/test_user.py\n\n# Specific test\npytest tests/test_entities/test_user.py::TestUser::test_user_creation_minimal\n</code></pre>"},{"location":"development/testing/#test-structure","title":"Test Structure","text":"<pre><code>tests/\n\u251c\u2500\u2500 test_entities/          # Entity tests\n\u2502   \u251c\u2500\u2500 test_user.py\n\u2502   \u251c\u2500\u2500 test_all_entities.py\n\u2502   \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 test_value_objects/     # Value object tests\n\u251c\u2500\u2500 test_domain_events.py   # Event system tests\n\u251c\u2500\u2500 test_business_rules.py  # Business logic tests\n\u251c\u2500\u2500 test_repositories.py    # Repository tests\n\u2514\u2500\u2500 test_coverage.py        # Edge case coverage\n</code></pre>"},{"location":"development/testing/#writing-tests","title":"Writing Tests","text":""},{"location":"development/testing/#entity-tests","title":"Entity Tests","text":"<pre><code>import pytest\nfrom eva_core.domain.entities.user import User, UserRole\n\ndef test_user_creation():\n    user = User(\n        tenant_id=\"tenant-123\",\n        email=\"test@example.com\",\n        name=\"Test User\",\n        auth_provider=\"entra_id\",\n        auth_sub=\"auth0|123\",\n        created_by=\"system\"\n    )\n\n    assert user.email == \"test@example.com\"\n    assert user.role == UserRole.MEMBER  # Default\n</code></pre>"},{"location":"development/testing/#async-repository-tests","title":"Async Repository Tests","text":"<pre><code>import pytest\nfrom eva_core.domain.repositories.memory import InMemoryUserRepository\n\n@pytest.mark.asyncio\nasync def test_user_save_and_get():\n    repo = InMemoryUserRepository()\n\n    user = User(...)\n    await repo.save(user)\n\n    retrieved = await repo.get(user.id)\n    assert retrieved.id == user.id\n</code></pre>"},{"location":"development/testing/#property-based-tests","title":"Property-Based Tests","text":"<pre><code>from hypothesis import given, strategies as st\nfrom eva_core.domain.value_objects.email import Email\n\n@given(st.emails())\ndef test_email_accepts_valid_emails(email: str):\n    \"\"\"Property test: all valid emails should be accepted.\"\"\"\n    email_obj = Email(value=email)\n    assert \"@\" in email_obj.value\n</code></pre>"},{"location":"development/testing/#validation-tests","title":"Validation Tests","text":"<pre><code>import pytest\nfrom pydantic import ValidationError\nfrom eva_core.domain.entities.user import User\n\ndef test_user_invalid_email():\n    with pytest.raises(ValidationError):\n        User(\n            tenant_id=\"tenant-123\",\n            email=\"not-an-email\",  # Invalid\n            name=\"Test\",\n            auth_provider=\"entra_id\",\n            auth_sub=\"123\",\n            created_by=\"system\"\n        )\n</code></pre>"},{"location":"development/testing/#test-fixtures","title":"Test Fixtures","text":"<pre><code>@pytest.fixture\ndef tenant():\n    return Tenant(\n        name=\"Test Org\",\n        slug=\"test-org\",\n        created_by=\"admin\"\n    )\n\n@pytest.fixture\ndef user(tenant):\n    return User(\n        tenant_id=tenant.id,\n        email=\"test@example.com\",\n        name=\"Test User\",\n        auth_provider=\"entra_id\",\n        auth_sub=\"auth0|123\",\n        created_by=\"system\"\n    )\n</code></pre>"},{"location":"development/testing/#coverage-requirements","title":"Coverage Requirements","text":"<p>EVA Core maintains 100% test coverage:</p> <pre><code># Fail if coverage &lt; 100%\npytest --cov=eva_core --cov-fail-under=100\n</code></pre>"},{"location":"development/testing/#type-checking","title":"Type Checking","text":"<pre><code># Run mypy strict\nmypy src/\n</code></pre>"},{"location":"development/testing/#linting","title":"Linting","text":"<pre><code># Run ruff\nruff check src/ tests/\n\n# Auto-fix issues\nruff check --fix src/ tests/\n</code></pre>"},{"location":"development/testing/#pre-commit-hooks","title":"Pre-commit Hooks","text":"<pre><code># Install hooks\npre-commit install\n\n# Run manually\npre-commit run --all-files\n</code></pre>"},{"location":"development/testing/#continuous-integration","title":"Continuous Integration","text":"<p>Tests run automatically on: - Every push - Every pull request - Using GitHub Actions</p> <p>See <code>.github/workflows/ci.yml</code> for the full CI pipeline.</p>"},{"location":"development/testing/#performance-tests","title":"Performance Tests","text":"<pre><code># Run benchmark tests\npytest tests/test_performance.py --benchmark-only\n</code></pre>"},{"location":"development/testing/#see-also","title":"See Also","text":"<ul> <li>Contributing</li> <li>API Reference</li> </ul>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#requirements","title":"Requirements","text":"<ul> <li>Python 3.11 or higher</li> <li>pip or Poetry package manager</li> </ul>"},{"location":"getting-started/installation/#install-from-pypi","title":"Install from PyPI","text":"<pre><code>pip install eva-core\n</code></pre>"},{"location":"getting-started/installation/#install-from-source","title":"Install from source","text":"<pre><code>git clone https://github.com/MarcoPolo483/eva-core.git\ncd eva-core\npip install -e .\n</code></pre>"},{"location":"getting-started/installation/#using-poetry","title":"Using Poetry","text":"<pre><code>poetry add eva-core\n</code></pre>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":"<pre><code>from eva_core import User, Tenant, Space\n\nprint(\"EVA Core installed successfully!\")\n</code></pre>"},{"location":"getting-started/installation/#development-installation","title":"Development Installation","text":"<p>For contributing to EVA Core:</p> <pre><code>git clone https://github.com/MarcoPolo483/eva-core.git\ncd eva-core\npoetry install\npoetry run pre-commit install\n</code></pre> <p>This installs all development dependencies including:</p> <ul> <li>pytest for testing</li> <li>mypy for type checking</li> <li>ruff for linting</li> <li>mkdocs for documentation</li> </ul>"},{"location":"getting-started/quick-start/","title":"Quick Start","text":""},{"location":"getting-started/quick-start/#basic-usage","title":"Basic Usage","text":""},{"location":"getting-started/quick-start/#creating-a-tenant","title":"Creating a Tenant","text":"<pre><code>from eva_core.domain.entities.tenant import Tenant\n\ntenant = Tenant(\n    name=\"Acme Corp\",\n    slug=\"acme-corp\",\n    created_by=\"admin@acme.com\"\n)\nprint(f\"Created tenant: {tenant.name} ({tenant.id})\")\n</code></pre>"},{"location":"getting-started/quick-start/#creating-a-user","title":"Creating a User","text":"<pre><code>from eva_core.domain.entities.user import User, UserRole\n\nuser = User(\n    tenant_id=tenant.id,\n    email=\"alice@acme.com\",\n    name=\"Alice Smith\",\n    auth_provider=\"entra_id\",\n    auth_sub=\"auth0|12345\",\n    role=UserRole.ADMIN,\n    created_by=\"system\"\n)\n</code></pre>"},{"location":"getting-started/quick-start/#creating-a-space","title":"Creating a Space","text":"<pre><code>from eva_core.domain.entities.space import Space, SpaceVisibility\n\nspace = Space(\n    tenant_id=tenant.id,\n    name=\"Engineering Docs\",\n    owner_id=user.id,\n    visibility=SpaceVisibility.PRIVATE\n)\n</code></pre>"},{"location":"getting-started/quick-start/#adding-a-document","title":"Adding a Document","text":"<pre><code>from eva_core.domain.entities.document import Document\n\ndocument = Document(\n    tenant_id=tenant.id,\n    space_id=space.id,\n    filename=\"api-spec.pdf\",\n    content_type=\"application/pdf\",\n    content_hash=\"abc123...\",\n    blob_url=\"https://storage.example.com/docs/api-spec.pdf\",\n    size_bytes=1024000,\n    uploaded_by=user.id\n)\n</code></pre>"},{"location":"getting-started/quick-start/#creating-a-query","title":"Creating a Query","text":"<pre><code>from eva_core.domain.entities.query import Query\n\nquery = Query(\n    tenant_id=tenant.id,\n    space_id=space.id,\n    user_id=user.id,\n    query_text=\"What are the API authentication methods?\",\n    conversation_id=\"conv-123\"\n)\n\n# Mark as completed\nquery.mark_as_completed(\n    response_text=\"Our API supports OAuth 2.0 and API keys...\",\n    sources_count=3,\n    tokens_used=150\n)\n</code></pre>"},{"location":"getting-started/quick-start/#using-value-objects","title":"Using Value Objects","text":""},{"location":"getting-started/quick-start/#email-with-pii-masking","title":"Email with PII Masking","text":"<pre><code>from eva_core.domain.value_objects.email import Email\n\nemail = Email(value=\"alice@example.com\")\nprint(email.mask())  # Output: \"a****@e******.com\"\n</code></pre>"},{"location":"getting-started/quick-start/#phone-number","title":"Phone Number","text":"<pre><code>from eva_core.domain.value_objects.phone_number import PhoneNumber\n\nphone = PhoneNumber(value=\"5551234567\")\nprint(phone.mask())  # Output: \"*****34567\"\n</code></pre>"},{"location":"getting-started/quick-start/#domain-events","title":"Domain Events","text":"<pre><code># Spaces emit events when documents are added\nspace.emit_document_added(\n    document_id=document.id,\n    filename=document.filename,\n    size_bytes=document.size_bytes,\n    uploaded_by=user.id\n)\n\n# Collect all events\nevents = space.collect_events()\nfor event in events:\n    print(f\"Event: {event.event_type} at {event.timestamp}\")\n</code></pre>"},{"location":"getting-started/quick-start/#repository-pattern","title":"Repository Pattern","text":"<pre><code>from eva_core.domain.repositories.memory import InMemoryUserRepository\n\n# Create repository\nuser_repo = InMemoryUserRepository()\n\n# Save user\nawait user_repo.save(user)\n\n# Retrieve by ID\nretrieved = await user_repo.get(user.id)\n\n# Query by email\nfound = await user_repo.get_by_email(\"alice@acme.com\", tenant.id)\n\n# List users in tenant\nusers = await user_repo.list_by_tenant(tenant.id)\n</code></pre>"},{"location":"getting-started/quick-start/#next-steps","title":"Next Steps","text":"<ul> <li>Explore Entity Documentation</li> <li>Learn about Domain Events</li> <li>Read the API Reference</li> </ul>"},{"location":"usage/domain-events/","title":"Domain Events","text":"<p>Domain events represent significant occurrences in the business domain.</p>"},{"location":"usage/domain-events/#event-system","title":"Event System","text":"<p>EVA Core uses an in-memory event system where entities emit events that can be collected and processed.</p>"},{"location":"usage/domain-events/#base-event","title":"Base Event","text":"<p>All events extend <code>DomainEvent</code>:</p> <pre><code>from eva_core.domain.events.base import DomainEvent\n\nclass MyEvent(DomainEvent):\n    event_type: str = \"my_event\"\n    entity_id: str\n</code></pre>"},{"location":"usage/domain-events/#space-events","title":"Space Events","text":""},{"location":"usage/domain-events/#spacecreated","title":"SpaceCreated","text":"<p>Emitted when a new space is created.</p> <pre><code>from eva_core.domain.events.space_events import SpaceCreated\n\nevent = SpaceCreated(\n    space_id=\"space-123\",\n    tenant_id=\"tenant-456\",\n    name=\"Engineering\",\n    owner_id=\"user-789\"\n)\n</code></pre>"},{"location":"usage/domain-events/#documentadded","title":"DocumentAdded","text":"<p>Emitted when a document is uploaded to a space.</p> <pre><code>from eva_core.domain.events.space_events import DocumentAdded\n\nevent = DocumentAdded(\n    space_id=\"space-123\",\n    document_id=\"doc-456\",\n    filename=\"api-spec.pdf\",\n    size_bytes=1024000,\n    uploaded_by=\"user-789\"\n)\n</code></pre>"},{"location":"usage/domain-events/#memberadded","title":"MemberAdded","text":"<p>Emitted when a user is added to a space.</p> <pre><code>from eva_core.domain.events.space_events import MemberAdded\n\nevent = MemberAdded(\n    space_id=\"space-123\",\n    user_id=\"user-456\",\n    added_by=\"user-789\"\n)\n</code></pre>"},{"location":"usage/domain-events/#query-events","title":"Query Events","text":""},{"location":"usage/domain-events/#queryexecuted","title":"QueryExecuted","text":"<p>Emitted when a query starts processing.</p> <pre><code>from eva_core.domain.events.query_events import QueryExecuted\n\nevent = QueryExecuted(\n    query_id=\"query-123\",\n    space_id=\"space-456\",\n    user_id=\"user-789\",\n    query_text=\"What are the API limits?\"\n)\n</code></pre>"},{"location":"usage/domain-events/#querycompleted","title":"QueryCompleted","text":"<p>Emitted when a query finishes successfully.</p> <pre><code>from eva_core.domain.events.query_events import QueryCompleted\n\nevent = QueryCompleted(\n    query_id=\"query-123\",\n    sources_count=3,\n    tokens_used=150,\n    processing_time_ms=250\n)\n</code></pre>"},{"location":"usage/domain-events/#queryfailed","title":"QueryFailed","text":"<p>Emitted when a query fails.</p> <pre><code>from eva_core.domain.events.query_events import QueryFailed\n\nevent = QueryFailed(\n    query_id=\"query-123\",\n    error_message=\"Timeout connecting to index\",\n    error_code=\"TIMEOUT\"\n)\n</code></pre>"},{"location":"usage/domain-events/#using-events","title":"Using Events","text":""},{"location":"usage/domain-events/#collecting-events","title":"Collecting Events","text":"<pre><code># Entity emits events\nspace.emit_document_added(\n    document_id=\"doc-123\",\n    filename=\"spec.pdf\",\n    size_bytes=1024,\n    uploaded_by=\"user-456\"\n)\n\n# Collect all events\nevents = space.collect_events()\nfor event in events:\n    print(f\"{event.event_type} at {event.timestamp}\")\n</code></pre>"},{"location":"usage/domain-events/#event-metadata","title":"Event Metadata","text":"<p>All events include:</p> <pre><code>event = SpaceCreated(...)\nprint(event.event_id)      # Unique ID\nprint(event.event_type)    # \"space_created\"\nprint(event.timestamp)     # ISO 8601 timestamp\nprint(event.metadata)      # Optional dict\n</code></pre>"},{"location":"usage/domain-events/#event-processing","title":"Event Processing","text":"<pre><code>from eva_core.domain.events.base import DomainEvent\n\ndef process_event(event: DomainEvent) -&gt; None:\n    if event.event_type == \"document_added\":\n        # Trigger indexing\n        start_indexing(event.document_id)\n    elif event.event_type == \"query_completed\":\n        # Log analytics\n        log_query_metrics(event.query_id, event.tokens_used)\n\n# Process collected events\nfor event in space.collect_events():\n    process_event(event)\n</code></pre>"},{"location":"usage/domain-events/#event-immutability","title":"Event Immutability","text":"<p>Events are immutable once created:</p> <pre><code>event = SpaceCreated(...)\n# event.space_id = \"other\"  # Raises Pydantic ValidationError\n</code></pre>"},{"location":"usage/domain-events/#see-also","title":"See Also","text":"<ul> <li>Entities</li> <li>API Reference</li> </ul>"},{"location":"usage/entities/","title":"Entities","text":""},{"location":"usage/entities/#overview","title":"Overview","text":"<p>EVA Core provides 7 core domain entities that model the business logic of a multi-tenant RAG system.</p>"},{"location":"usage/entities/#entity-hierarchy","title":"Entity Hierarchy","text":"<pre><code>Tenant\n\u251c\u2500\u2500 User\n\u251c\u2500\u2500 Space\n\u2502   \u251c\u2500\u2500 Document\n\u2502   \u2514\u2500\u2500 Query\n\u2514\u2500\u2500 Conversation\n    \u2514\u2500\u2500 Query\n</code></pre>"},{"location":"usage/entities/#tenant","title":"Tenant","text":"<p>The top-level entity representing an organization or customer.</p> <p>Key Features: - URL-safe slug for routing - Quota management (storage, users, spaces) - Status tracking (active, suspended, trial)</p> <p>Example: <pre><code>from eva_core.domain.entities.tenant import Tenant\n\ntenant = Tenant(\n    name=\"Acme Corp\",\n    slug=\"acme-corp\",\n    created_by=\"admin\"\n)\n</code></pre></p>"},{"location":"usage/entities/#user","title":"User","text":"<p>Represents authenticated users with role-based access control.</p> <p>Key Features: - Multi-provider authentication (Entra ID, Auth0, etc.) - Role system (admin, member, viewer) - PII masking for email and name - Preference management</p> <p>Example: <pre><code>from eva_core.domain.entities.user import User, UserRole\n\nuser = User(\n    tenant_id=\"tenant-123\",\n    email=\"alice@example.com\",\n    name=\"Alice Smith\",\n    auth_provider=\"entra_id\",\n    auth_sub=\"auth0|12345\",\n    role=UserRole.ADMIN,\n    created_by=\"system\"\n)\n</code></pre></p>"},{"location":"usage/entities/#space","title":"Space","text":"<p>A container for documents with member-based access control.</p> <p>Key Features: - Visibility control (private, shared, public) - Member management with roles - Document quota enforcement - Member addition events</p> <p>Example: <pre><code>from eva_core.domain.entities.space import Space, SpaceMember\n\nspace = Space(\n    tenant_id=\"tenant-123\",\n    name=\"Engineering Docs\",\n    owner_id=\"user-456\"\n)\n\n# Add member\nspace.members.append(\n    SpaceMember(user_id=\"user-789\", added_by=\"user-456\")\n)\n</code></pre></p>"},{"location":"usage/entities/#document","title":"Document","text":"<p>Represents uploaded files in a space.</p> <p>Key Features: - Content hash for deduplication - Status tracking (pending, indexed, failed) - Metadata storage (filename, MIME type, size) - Indexing lifecycle management</p> <p>Example: <pre><code>from eva_core.domain.entities.document import Document\n\ndocument = Document(\n    tenant_id=\"tenant-123\",\n    space_id=\"space-456\",\n    filename=\"api-spec.pdf\",\n    content_type=\"application/pdf\",\n    content_hash=\"sha256:abc123...\",\n    blob_url=\"https://storage/docs/api-spec.pdf\",\n    size_bytes=1024000,\n    uploaded_by=\"user-789\"\n)\n\n# Mark as indexed\ndocument.mark_as_indexed(index_id=\"idx-123\")\n</code></pre></p>"},{"location":"usage/entities/#query","title":"Query","text":"<p>Represents a user question to the RAG system.</p> <p>Key Features: - Status lifecycle (pending, completed, failed) - Citation tracking - Token usage metrics - Processing time tracking</p> <p>Example: <pre><code>from eva_core.domain.entities.query import Query, Citation\n\nquery = Query(\n    tenant_id=\"tenant-123\",\n    space_id=\"space-456\",\n    user_id=\"user-789\",\n    query_text=\"What are the API rate limits?\",\n    conversation_id=\"conv-abc\"\n)\n\n# Complete with response\nquery.mark_as_completed(\n    response_text=\"The API rate limit is 1000 requests per hour...\",\n    citations=[\n        Citation(document_id=\"doc-1\", page_number=5, snippet=\"Rate limit: 1000/hr\")\n    ],\n    sources_count=1,\n    tokens_used=150,\n    processing_time_ms=250\n)\n</code></pre></p>"},{"location":"usage/entities/#conversation","title":"Conversation","text":"<p>Groups related queries in a thread.</p> <p>Key Features: - Query history tracking - Metadata storage for UI state - Query addition with ordering</p> <p>Example: <pre><code>from eva_core.domain.entities.conversation import Conversation\n\nconversation = Conversation(\n    tenant_id=\"tenant-123\",\n    space_id=\"space-456\",\n    user_id=\"user-789\",\n    title=\"API Questions\"\n)\n\n# Add query\nconversation.add_query(query.id)\n</code></pre></p>"},{"location":"usage/entities/#common-patterns","title":"Common Patterns","text":""},{"location":"usage/entities/#tenant-isolation","title":"Tenant Isolation","text":"<p>All entities include <code>tenant_id</code> for multi-tenancy:</p> <pre><code># Always filter by tenant_id\nuser = await user_repo.get_by_email(\"alice@example.com\", tenant_id=\"tenant-123\")\n</code></pre>"},{"location":"usage/entities/#access-control","title":"Access Control","text":"<pre><code># Check if user can access space\nif user.can_access_space(space, tenant_id):\n    # Allow access\n    pass\n</code></pre>"},{"location":"usage/entities/#event-emission","title":"Event Emission","text":"<pre><code># Entities emit domain events\nspace.emit_document_added(doc.id, doc.filename, doc.size_bytes, user.id)\nevents = space.collect_events()\n</code></pre>"},{"location":"usage/entities/#see-also","title":"See Also","text":"<ul> <li>Domain Events</li> <li>Repositories</li> <li>API Reference</li> </ul>"},{"location":"usage/repositories/","title":"Repositories","text":"<p>The Repository pattern provides abstract interfaces for data access.</p>"},{"location":"usage/repositories/#overview","title":"Overview","text":"<p>EVA Core defines repository interfaces for each entity type. You implement these interfaces with your chosen persistence layer (PostgreSQL, MongoDB, etc.).</p>"},{"location":"usage/repositories/#base-repository","title":"Base Repository","text":"<p>All repositories extend <code>Repository[T]</code>:</p> <pre><code>from eva_core.domain.repositories.base import Repository\nfrom eva_core.domain.entities.user import User\n\nclass MyUserRepository(Repository[User]):\n    async def get(self, id: str) -&gt; User | None:\n        # Your implementation\n        pass\n</code></pre>"},{"location":"usage/repositories/#repository-interfaces","title":"Repository Interfaces","text":""},{"location":"usage/repositories/#userrepository","title":"UserRepository","text":"<pre><code>from eva_core.domain.repositories.user_repository import UserRepository\n\nclass PostgresUserRepository(UserRepository):\n    async def get_by_email(self, email: str, tenant_id: str) -&gt; User | None:\n        # Query database\n        pass\n\n    async def get_by_auth_sub(self, auth_sub: str, auth_provider: str) -&gt; User | None:\n        # Query by auth subject\n        pass\n\n    async def list_by_tenant(\n        self, tenant_id: str, skip: int = 0, limit: int = 100\n    ) -&gt; list[User]:\n        # List with pagination\n        pass\n</code></pre>"},{"location":"usage/repositories/#tenantrepository","title":"TenantRepository","text":"<pre><code>from eva_core.domain.repositories.tenant_repository import TenantRepository\n\nclass PostgresTenantRepository(TenantRepository):\n    async def get_by_slug(self, slug: str) -&gt; Tenant | None:\n        # Find by URL slug\n        pass\n\n    async def list_active(\n        self, skip: int = 0, limit: int = 100\n    ) -&gt; list[Tenant]:\n        # List active tenants\n        pass\n</code></pre>"},{"location":"usage/repositories/#spacerepository","title":"SpaceRepository","text":"<pre><code>from eva_core.domain.repositories.space_repository import SpaceRepository\n\nclass PostgresSpaceRepository(SpaceRepository):\n    async def list_by_tenant(\n        self, tenant_id: str, skip: int = 0, limit: int = 100\n    ) -&gt; list[Space]:\n        pass\n\n    async def list_by_owner(\n        self, owner_id: str, tenant_id: str, skip: int = 0, limit: int = 100\n    ) -&gt; list[Space]:\n        pass\n\n    async def list_by_member(\n        self, user_id: str, tenant_id: str, skip: int = 0, limit: int = 100\n    ) -&gt; list[Space]:\n        pass\n</code></pre>"},{"location":"usage/repositories/#documentrepository","title":"DocumentRepository","text":"<pre><code>from eva_core.domain.repositories.document_repository import DocumentRepository\n\nclass PostgresDocumentRepository(DocumentRepository):\n    async def list_by_space(\n        self, space_id: str, tenant_id: str, skip: int = 0, limit: int = 100\n    ) -&gt; list[Document]:\n        pass\n\n    async def get_by_content_hash(\n        self, content_hash: str, tenant_id: str\n    ) -&gt; Document | None:\n        # Deduplication check\n        pass\n\n    async def list_pending_indexing(\n        self, tenant_id: str, limit: int = 100\n    ) -&gt; list[Document]:\n        # Find unindexed documents\n        pass\n</code></pre>"},{"location":"usage/repositories/#queryrepository","title":"QueryRepository","text":"<pre><code>from eva_core.domain.repositories.query_repository import QueryRepository\n\nclass PostgresQueryRepository(QueryRepository):\n    async def list_by_space(\n        self, space_id: str, tenant_id: str, skip: int = 0, limit: int = 100\n    ) -&gt; list[Query]:\n        pass\n\n    async def list_by_user(\n        self, user_id: str, tenant_id: str, skip: int = 0, limit: int = 100\n    ) -&gt; list[Query]:\n        pass\n\n    async def list_by_conversation(\n        self, conversation_id: str, tenant_id: str, skip: int = 0, limit: int = 100\n    ) -&gt; list[Query]:\n        pass\n</code></pre>"},{"location":"usage/repositories/#in-memory-implementations","title":"In-Memory Implementations","text":"<p>EVA Core provides in-memory implementations for testing:</p> <pre><code>from eva_core.domain.repositories.memory import (\n    InMemoryUserRepository,\n    InMemoryTenantRepository,\n    InMemorySpaceRepository,\n    InMemoryDocumentRepository,\n    InMemoryQueryRepository,\n)\n\n# Use in tests\nasync def test_user_creation():\n    repo = InMemoryUserRepository()\n\n    user = User(...)\n    await repo.save(user)\n\n    retrieved = await repo.get(user.id)\n    assert retrieved.email == user.email\n</code></pre>"},{"location":"usage/repositories/#usage-patterns","title":"Usage Patterns","text":""},{"location":"usage/repositories/#crud-operations","title":"CRUD Operations","text":"<pre><code># Create\nuser = User(...)\nawait repo.save(user)\n\n# Read\nuser = await repo.get(user_id)\n\n# Update\nuser.name = \"New Name\"\nawait repo.save(user)\n\n# Delete\ndeleted = await repo.delete(user_id)\n</code></pre>"},{"location":"usage/repositories/#querying","title":"Querying","text":"<pre><code># By unique field\nuser = await user_repo.get_by_email(\"alice@example.com\", tenant_id)\n\n# List with pagination\nusers = await user_repo.list_by_tenant(tenant_id, skip=0, limit=10)\n\n# Custom queries\npending = await doc_repo.list_pending_indexing(tenant_id)\n</code></pre>"},{"location":"usage/repositories/#tenant-isolation","title":"Tenant Isolation","text":"<p>Always filter by <code>tenant_id</code>:</p> <pre><code># Correct\nspaces = await space_repo.list_by_tenant(tenant_id)\n\n# Also correct - enforces tenant isolation\nuser = await user_repo.get_by_email(email, tenant_id)\n</code></pre>"},{"location":"usage/repositories/#implementing-your-repository","title":"Implementing Your Repository","text":"<pre><code>from sqlalchemy.ext.asyncio import AsyncSession\nfrom eva_core.domain.repositories.user_repository import UserRepository\nfrom eva_core.domain.entities.user import User\n\nclass SQLAlchemyUserRepository(UserRepository):\n    def __init__(self, session: AsyncSession):\n        self.session = session\n\n    async def get(self, id: str) -&gt; User | None:\n        result = await self.session.execute(\n            select(UserModel).where(UserModel.id == id)\n        )\n        model = result.scalar_one_or_none()\n        return model.to_entity() if model else None\n\n    async def save(self, entity: User) -&gt; User:\n        model = UserModel.from_entity(entity)\n        self.session.add(model)\n        await self.session.commit()\n        return entity\n\n    # ... implement other methods\n</code></pre>"},{"location":"usage/repositories/#see-also","title":"See Also","text":"<ul> <li>Entities</li> <li>API Reference</li> <li>Testing</li> </ul>"},{"location":"usage/value-objects/","title":"Value Objects","text":"<p>Value objects are immutable types that represent descriptive aspects of the domain with no conceptual identity.</p>"},{"location":"usage/value-objects/#email","title":"Email","text":"<p>Email addresses with validation and PII masking.</p> <p>Features: - RFC 5322 validation - Automatic lowercasing - PII-safe masking</p> <p>Example: <pre><code>from eva_core.domain.value_objects.email import Email\n\nemail = Email(value=\"alice.smith@example.com\")\nprint(email.value)  # \"alice.smith@example.com\"\nprint(email.mask())  # \"a****.s****@e******.com\"\n</code></pre></p>"},{"location":"usage/value-objects/#phonenumber","title":"PhoneNumber","text":"<p>North American phone numbers with validation and masking.</p> <p>Features: - 10-digit validation - Format normalization - Last 5 digits masking</p> <p>Example: <pre><code>from eva_core.domain.value_objects.phone_number import PhoneNumber\n\nphone = PhoneNumber(value=\"555-123-4567\")\nprint(phone.value)  # \"5551234567\"\nprint(phone.mask())  # \"*****34567\"\n</code></pre></p>"},{"location":"usage/value-objects/#sin-social-insurance-number","title":"SIN (Social Insurance Number)","text":"<p>Canadian Social Insurance Numbers with Luhn checksum validation.</p> <p>Features: - 9-digit validation - Luhn algorithm checksum - Last 3 digits masking</p> <p>Example: <pre><code>from eva_core.domain.value_objects.sin import SIN\n\nsin = SIN(value=\"046-454-286\")\nprint(sin.value)  # \"046454286\"\nprint(sin.mask())  # \"******286\"\n</code></pre></p>"},{"location":"usage/value-objects/#immutability","title":"Immutability","text":"<p>Value objects are immutable by design:</p> <pre><code>email = Email(value=\"alice@example.com\")\n# Cannot modify\n# email.value = \"bob@example.com\"  # Raises error\n</code></pre>"},{"location":"usage/value-objects/#equality","title":"Equality","text":"<p>Value objects compare by value, not identity:</p> <pre><code>email1 = Email(value=\"alice@example.com\")\nemail2 = Email(value=\"alice@example.com\")\nassert email1 == email2  # True - same value\nassert email1 is not email2  # True - different objects\n</code></pre>"},{"location":"usage/value-objects/#pii-masking","title":"PII Masking","text":"<p>All value objects provide masking for privacy:</p> <pre><code>user = User(\n    email=\"alice@example.com\",\n    name=\"Alice Smith\",\n    # ...\n)\n\nmasked = user.mask_pii()\nprint(masked[\"email\"])  # \"a****@e******.com\"\nprint(masked[\"name\"])   # \"A**** S****\"\n</code></pre>"},{"location":"usage/value-objects/#see-also","title":"See Also","text":"<ul> <li>Entities</li> <li>API Reference</li> </ul>"}]}